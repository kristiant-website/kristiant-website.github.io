(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[246],{7872:function(t,e,n){var r=n(4155);!function(t){"use strict";try{(function(){function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=e(t),o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var a=function(){return(a=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function u(t,e,n,r){return new(n=n||Promise)((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):((e=t.value)instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))}function c(t,e){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,(s=i?[2&s[0],i.value]:s)[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(a){s=[6,a],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function h(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t}var l={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],s=i+1<t.length,a=s?t[i+1]:0,u=i+2<t.length,c=(15&a)<<2|(h=u?t[i+2]:0)>>6,h=63&h;u||(h=64,s||(c=64)),r.push(n[o>>2],n[(3&o)<<4|a>>4],n[c],n[h])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i,o,s,a=t[n++];a<128?e[r++]=String.fromCharCode(a):191<a&&a<224?(o=t[n++],e[r++]=String.fromCharCode((31&a)<<6|63&o)):239<a&&a<365?(i=((7&a)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536,e[r++]=String.fromCharCode(55296+(i>>10)),e[r++]=String.fromCharCode(56320+(1023&i))):(o=t[n++],s=t[n++],e[r++]=String.fromCharCode((15&a)<<12|(63&o)<<6|63&s))}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],s=i<t.length?n[t.charAt(i)]:0,a=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==s||null==a||null==u)throw Error();r.push(o<<2|s>>4),64!==a&&(r.push(s<<4&240|a>>2),64!==u&&r.push(a<<6&192|u))}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};function f(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var d,p="FirebaseError",y=(s(g,d=Error),g);function g(t,e,n){return(e=d.call(this,e)||this).code=t,e.customData=n,e.name=p,Object.setPrototypeOf(e,g.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,m.prototype.create),e}var m=(v.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r,i=e[0]||{},o=this.service+"/"+t;return t=(t=this.errors[t])?(r=i,t.replace(b,(function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"}))):"Error",t=this.serviceName+": "+t+" ("+o+").",new y(o,t,i)},v);function v(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var w,b=/\{\$([^}]+)}/g;function E(t){return t&&t._delegate?t._delegate:t}function T(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=S[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,h(["["+i+"]  "+t.name+":"],n))}}(k=w=w||{})[k.DEBUG=0]="DEBUG",k[k.VERBOSE=1]="VERBOSE",k[k.INFO=2]="INFO",k[k.WARN=3]="WARN",k[k.ERROR=4]="ERROR",k[k.SILENT=5]="SILENT";var I={debug:w.DEBUG,verbose:w.VERBOSE,info:w.INFO,warn:w.WARN,error:w.ERROR,silent:w.SILENT},_=w.INFO,S=((Se={})[w.DEBUG]="log",Se[w.VERBOSE]="log",Se[w.INFO]="info",Se[w.WARN]="warn",Se[w.ERROR]="error",Se),A=(Object.defineProperty(D.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in w))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),D.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?I[t]:t},Object.defineProperty(D.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),D.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,h([this,w.DEBUG],t)),this._logHandler.apply(this,h([this,w.DEBUG],t))},D.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,h([this,w.VERBOSE],t)),this._logHandler.apply(this,h([this,w.VERBOSE],t))},D.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,h([this,w.INFO],t)),this._logHandler.apply(this,h([this,w.INFO],t))},D.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,h([this,w.WARN],t)),this._logHandler.apply(this,h([this,w.WARN],t))},D.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,h([this,w.ERROR],t)),this._logHandler.apply(this,h([this,w.ERROR],t))},D);function D(t){this.name=t,this._logLevel=_,this._logHandler=T,this._userLogHandler=null}var N=function(t,e){return(N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function C(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&r>=t.length?void 0:t)&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var k,R="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:{},x={},O=R||self;function L(){}function P(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function M(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var F="closure_uid_"+(1e9*Math.random()>>>0),V=0;function U(t,e,n){return t.call.apply(t.bind,arguments)}function q(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function B(t,e,n){return(B=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?U:q).apply(null,arguments)}function j(t){var e=Array.prototype.slice.call(arguments,1);return function(){var n=e.slice();return n.push.apply(n,arguments),t.apply(this,n)}}function K(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,(t.prototype.constructor=t).Vb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function G(){this.s=this.s,this.o=this.o}G.prototype.s=!1,G.prototype.na=function(){var t;!this.s&&(this.s=!0,this.M(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,F)&&t[F]||(t[F]=++V))},G.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var H=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},z=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function Q(){return Array.prototype.concat.apply([],arguments)}function W(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Y(t){return/^[\s\xa0]*$/.test(t)}var X,$=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function J(t,e){return-1!=t.indexOf(e)}function Z(t,e){return t<e?-1:e<t?1:0}var tt=O.navigator;function et(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function nt(t){var e,n={};for(e in t)n[e]=t[e];return n}X=tt&&(tt=tt.userAgent)?tt:"";var rt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function it(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<rt.length;i++)e=rt[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function ot(t){return ot[" "](t),t}ot[" "]=L;var st,at=J(X,"Opera"),ut=J(X,"Trident")||J(X,"MSIE"),ct=J(X,"Edge"),ht=ct||ut,lt=J(X,"Gecko")&&!(J(X.toLowerCase(),"webkit")&&!J(X,"Edge"))&&!(J(X,"Trident")||J(X,"MSIE"))&&!J(X,"Edge"),ft=J(X.toLowerCase(),"webkit")&&!J(X,"Edge");function dt(){var t=O.document;return t?t.documentMode:void 0}var pt="",yt=(yt=X,lt?/rv:([^\);]+)(\)|;)/.exec(yt):ct?/Edge\/([\d\.]+)/.exec(yt):ut?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(yt):ft?/WebKit\/(\S+)/.exec(yt):at?/(?:Version)[ \/]?(\S+)/.exec(yt):void 0);yt&&(pt=yt?yt[1]:""),st=ut&&null!=(yt=dt())&&yt>parseFloat(pt)?String(yt):pt;var gt={};function mt(){return t=function(){for(var t=0,e=$(String(st)).split("."),n=$("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++)for(var o=e[i]||"",s=n[i]||"";o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],(0!=o[0].length||0!=s[0].length)&&(t=Z(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||Z(0==o[2].length,0==s[2].length)||Z(o[2],s[2]),o=o[3],s=s[3],0==t););return 0<=t},e=gt,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9);var t,e}var vt=O.document&&ut&&(dt()||parseInt(st,10))||void 0,wt=function(){if(!O.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{O.addEventListener("test",L,e),O.removeEventListener("test",L,e)}catch(t){}return t}();function bt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function Et(t,e){if(bt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(lt){t:{try{ot(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Tt[t.pointerType]||"",this.state=t.state,(this.i=t).defaultPrevented&&Et.Z.h.call(this)}}bt.prototype.h=function(){this.defaultPrevented=!0},K(Et,bt);var Tt={2:"touch",3:"pen",4:"mouse"};Et.prototype.h=function(){Et.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var It="closure_listenable_"+(1e6*Math.random()|0),_t=0;function St(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++_t,this.ca=this.fa=!1}function At(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function Dt(t){this.src=t,this.g={},this.h=0}function Nt(t,e){var n,r,i,o=e.type;o in t.g&&(n=t.g[o],(i=0<=(r=H(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(At(e),0==t.g[o].length&&(delete t.g[o],t.h--)))}function Ct(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}Dt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=Ct(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new St(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var kt="closure_lm_"+(1e6*Math.random()|0),Rt={};function xt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Ut(r),e&&e[It]?e.O(n,r,M(i)?!!i.capture:!!i,o):Ot(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)xt(t,e[o],n,r,i);return null}return n=Ut(n),t&&t[It]?t.N(e,n,M(r)?!!r.capture:!!r,i):Ot(t,e,n,!1,r,i)}function Ot(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s,a=M(i)?!!i.capture:!!i,u=Ft(t);if(u||(t[kt]=u=new Dt(t)),(n=u.add(e,n,r,a,o)).proxy)return n;if(s=Mt,(n.proxy=r=function t(e){return s.call(t.src,t.listener,e)}).src=t,r.listener=n,t.addEventListener)void 0===(i=wt?i:a)&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Pt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Lt(t){var e,n,r;"number"!=typeof t&&t&&!t.ca&&((e=t.src)&&e[It]?Nt(e.i,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Pt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ft(e))?(Nt(n,t),0==n.h&&(n.src=null,e[kt]=null)):At(t)))}function Pt(t){return t in Rt?Rt[t]:Rt[t]="on"+t}function Mt(t,e){var n,r;return!!t.ca||(e=new Et(e,this),n=t.listener,r=t.ia||t.src,t.fa&&Lt(t),n.call(r,e))}function Ft(t){return(t=t[kt])instanceof Dt?t:null}var Vt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ut(t){return"function"==typeof t?t:(t[Vt]||(t[Vt]=function(e){return t.handleEvent(e)}),t[Vt])}function qt(){G.call(this),this.i=new Dt(this),(this.P=this).I=null}function Bt(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e?e=new bt(e,t):e instanceof bt?e.target=e.target||t:(s=e,it(e=new bt(r,t),s)),s=!0,n)for(var i=n.length-1;0<=i;i--)var o=e.g=n[i],s=jt(o,r,!0,e)&&s;if(s=jt(o=e.g=t,r,!0,e)&&s,s=jt(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=jt(o=e.g=n[i],r,!1,e)&&s}function jt(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,a,u=e[o];u&&!u.ca&&u.capture==n&&(s=u.listener,a=u.ia||u.src,u.fa&&Nt(t.i,u),i=!1!==s.call(a,r)&&i)}return i&&!r.defaultPrevented}K(qt,G),qt.prototype[It]=!0,qt.prototype.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=M(i)?!!i.capture:!!i,r=Ut(r),e&&e[It]?(e=e.i,(n=String(n).toString())in e.g&&-1<(r=Ct(s=e.g[n],r,i,o))&&(At(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.g[n],e.h--))):(e=e&&Ft(e))&&(n=e.g[n.toString()],(r=(e=-1)<(e=n?Ct(n,r,i,o):e)?n[e]:null)&&Lt(r))}(this,t,e,n,r)},qt.prototype.M=function(){if(qt.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)At(n[r]);delete e.g[t],e.h--}}this.I=null},qt.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},qt.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Kt=O.JSON.stringify,Gt=(Ht.prototype.add=function(t,e){var n=zt.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},Ht);function Ht(){this.h=this.g=null}var zt=(Qt.prototype.get=function(){var t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t},new Qt((function(){return new Yt}),(function(t){return t.reset()})));function Qt(t,e){this.i=t,this.j=e,this.h=0,this.g=null}var Wt,Yt=(Xt.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},Xt.prototype.reset=function(){this.next=this.g=this.h=null},Xt);function Xt(){this.next=this.g=this.h=null}function $t(t,e){var n;Wt||(n=O.Promise.resolve(void 0),Wt=function(){n.then(te)}),Jt||(Wt(),Jt=!0),Zt.add(t,e)}var Jt=!1,Zt=new Gt;function te(){for(var t;e=t=void 0,e=null,(t=Zt).g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(t){!function(t){O.setTimeout((function(){throw t}),0)}(t)}var e=zt;e.j(t),e.h<100&&(e.h++,t.next=e.g,e.g=t)}Jt=!1}function ee(t,e){qt.call(this),this.h=t||1,this.g=e||O,this.j=B(this.kb,this),this.l=Date.now()}function ne(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function re(t,e,n){if("function"==typeof t)n&&(t=B(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=B(t.handleEvent,t)}return 2147483647<Number(e)?-1:O.setTimeout(t,e||0)}K(ee,qt),(k=ee.prototype).da=!1,k.S=null,k.kb=function(){var t;this.da&&(0<(t=Date.now()-this.l)&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Bt(this,"tick"),this.da&&(ne(this),this.start())))},k.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},k.M=function(){ee.Z.M.call(this),ne(this),delete this.g};var ie,oe,se,ae=(N(oe=ce,se=ie=G),oe.prototype=null===se?Object.create(se):(ue.prototype=se.prototype,new ue),ce.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:function t(e){e.g=re((function(){e.g=null,e.i&&(e.i=!1,t(e))}),e.j);var n=e.h;e.h=null,e.m.apply(null,n)}(this)},ce.prototype.M=function(){ie.prototype.M.call(this),this.g&&(O.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},ce);function ue(){this.constructor=oe}function ce(t,e){var n=ie.call(this)||this;return n.m=t,n.j=e,n.h=null,n.i=!1,n.g=null,n}function he(t){G.call(this),this.h=t,this.g={}}K(he,G);var le=[];function fe(t,e,n,r){Array.isArray(n)||(n&&(le[0]=n.toString()),n=le);for(var i=0;i<n.length;i++){var o=xt(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function de(t){et(t.g,(function(t,e){this.g.hasOwnProperty(e)&&Lt(t)}),t),t.g={}}function pe(){this.g=!0}function ye(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Kt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}he.prototype.M=function(){he.Z.M.call(this),de(this)},he.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},pe.prototype.Aa=function(){this.g=!1},pe.prototype.info=function(){};var ge={},me=null;function ve(){return me=me||new qt}function we(t){bt.call(this,ge.Ma,t)}function be(){var t=ve();Bt(t,new we(t))}function Ee(t,e){bt.call(this,ge.STAT_EVENT,t),this.stat=e}function Te(t){var e=ve();Bt(e,new Ee(e,t))}function Ie(t,e){bt.call(this,ge.Na,t),this.size=e}function _e(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return O.setTimeout((function(){t()}),e)}ge.Ma="serverreachability",K(we,bt),ge.STAT_EVENT="statevent",K(Ee,bt),ge.Na="timingevent",K(Ie,bt);var Se={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9};function Ae(){}function De(t){return t.h||(t.h=t.i())}function Ne(){}function Ce(){bt.call(this,"d")}function ke(){bt.call(this,"c")}function Re(){}function xe(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new he(this),this.P=Pe,this.W=new ee(t=ht?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Oe}function Oe(){this.i=null,this.g="",this.h=!1}R={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"},Ae.prototype.h=null,Gt={OPEN:"a",pb:"b",Ka:"c",Bb:"d"},K(Ce,bt),K(ke,bt),K(Re,Ae),Re.prototype.g=function(){return new XMLHttpRequest},Re.prototype.i=function(){return{}};var Le=new Re,Pe=45e3,Me={},Fe={};function Ve(t,e,n){t.K=1,t.v=an(tn(e)),t.s=n,t.U=!0,Ue(t,null)}function Ue(t,e){t.F=Date.now(),je(t),t.A=tn(t.v);var n,r,i,o,s,a,u=t.A,c=t.X;Array.isArray(c)||(c=[String(c)]),bn(u.h,"t",c),t.C=0,u=t.l.H,t.h=new Oe,t.g=Er(t.l,u?e:null,!t.s),0<t.O&&(t.L=new ae(B(t.Ia,t,t.g),t.O)),fe(t.V,t.g,"readystatechange",t.gb),e=t.H?nt(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),be(),n=t.j,r=t.u,i=t.A,o=t.m,s=t.X,a=t.s,n.info((function(){if(n.g)if(a)for(var t="",e=a.split("&"),u=0;u<e.length;u++){var c,h,l=e[u].split("=");1<l.length&&(c=l[0],l=l[1],t=2<=(h=c.split("_")).length&&"type"==h[1]?t+(c+"=")+l+"&":t+(c+"=redacted&"))}else t=null;else t=a;return"XMLHTTP REQ ("+o+") [attempt "+s+"]: "+r+"\n"+i+"\n"+t}))}function qe(t){return t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function Be(t,e,n){for(var r,i,o,s,a,u=!0;!t.I&&t.C<n.length;){if(o=n,a=s=void 0,s=(i=t).C,(r=-1==(a=o.indexOf("\n",s))?Fe:(s=Number(o.substring(s,a)),isNaN(s)?Me:(a+=1)+s>o.length?Fe:(o=o.substr(a,s),i.C=a+s,o)))==Fe){4==e&&(t.o=4,Te(14),u=!1),ye(t.j,t.m,null,"[Incomplete Response]");break}if(r==Me){t.o=4,Te(15),ye(t.j,t.m,n,"[Invalid Chunk]"),u=!1;break}ye(t.j,t.m,r,null),Qe(t,r)}qe(t)&&r!=Fe&&r!=Me&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,Te(16),u=!1),t.i=t.i&&u,u?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),dr(e),e.L=!0,Te(11))):(ye(t.j,t.m,n,"[Invalid Chunked Response]"),ze(t),He(t))}function je(t){t.Y=Date.now()+t.P,Ke(t,t.P)}function Ke(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=_e(B(t.eb,t),e)}function Ge(t){t.B&&(O.clearTimeout(t.B),t.B=null)}function He(t){0==t.l.G||t.I||gr(t.l,t)}function ze(t){Ge(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,ne(t.W),de(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Qe(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||Nn(n.i,t)))if(n.I=t.N,!t.J&&Nn(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(y){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;yr(n),ir(n)}fr(n),Te(18)}}else n.ta=i[1],0<n.ta-n.U&&i[2]<37500&&n.N&&0==n.A&&!n.v&&(n.v=_e(B(n.ab,n),6e3));if(Dn(n.i)<=1&&n.ka){try{n.ka()}catch(y){}n.ka=void 0}}else vr(n,11)}else if(!t.J&&n.g!=t||yr(n),!Y(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o,s,a,u,c,h,l,f,d,p,y=i[e];n.U=y[0],y=y[1],2==n.G?"c"==y[0]?(n.J=y[1],n.la=y[2],null!=(o=y[3])&&(n.ma=o,n.h.info("VER="+n.ma)),null!=(s=y[4])&&(n.za=s,n.h.info("SVER="+n.za)),null!=(a=y[5])&&"number"==typeof a&&0<a&&(r=1.5*a,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n,(u=t.g)&&(!(c=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null)||!(h=r.i).g&&(J(c,"spdy")||J(c,"quic")||J(c,"h2"))&&(h.j=h.l,h.g=new Set,h.h&&(Cn(h,h.h),h.h=null)),!r.D||(l=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.sa=l,sn(r.F,r.D,l))),n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms")),f=t,(r=n).oa=br(r,r.H?r.la:null,r.W),f.J?(kn(r.i,f),d=f,(p=r.K)&&d.setTimeout(p),d.B&&(Ge(d),je(d)),r.g=f):lr(r),0<n.l.length&&ar(n)):"stop"!=y[0]&&"close"!=y[0]||vr(n,7):3==n.G&&("stop"==y[0]||"close"==y[0]?"stop"==y[0]?vr(n,7):rr(n):"noop"!=y[0]&&n.j&&n.j.wa(y),n.A=0)}be()}catch(y){}}function We(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(P(t)||"string"==typeof t)z(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(P(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(P(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ye(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ye)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Xe(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];$e(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)$e(i,r=t.g[e])||(i[t.g[n++]=r]=1),e++;t.g.length=n}}function $e(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(k=xe.prototype).setTimeout=function(t){this.P=t},k.gb=function(t){t=t.target;var e=this.L;e&&3==Jn(t)?e.l():this.Ia(t)},k.Ia=function(t){try{if(t==this.g)t:{var e=Jn(this.g),n=this.g.Da();if(this.g.ba(),!(e<3)&&(3!=e||ht||this.g&&(this.h.h||this.g.ga()||Zn(this.g)))){this.I||4!=e||7==n||be(),Ge(this);var r=this.g.ba();this.N=r;e:if(qe(this)){var i=Zn(this.g);t="";var o=i.length,s=4==Jn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){ze(this),He(this);var a="";break e}this.h.i=new O.TextDecoder}for(n=0;n<o;n++)this.h.h=!0,t+=this.h.i.decode(i[n],{stream:s&&n==o-1});i.splice(0,o),this.h.g+=t,this.C=0,a=this.h.g}else a=this.g.ga();if(this.i=200==r,l=this.j,f=this.u,d=this.A,p=this.m,y=this.X,g=e,m=r,l.info((function(){return"XMLHTTP RESP ("+p+") [ attempt "+y+"]: "+f+"\n"+d+"\n"+g+" "+m})),this.i){if(this.$&&!this.J){e:{if(this.g){var u,c=this.g;if((u=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Y(u)){var h=u;break e}}h=null}if(!(r=h)){this.i=!1,this.o=3,Te(12),ze(this),He(this);break t}ye(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Qe(this,r)}this.U?(Be(this,e,a),ht&&this.i&&3==e&&(fe(this.V,this.W,"tick",this.fb),this.W.start())):(ye(this.j,this.m,a,null),Qe(this,a)),4==e&&ze(this),this.i&&!this.I&&(4==e?gr(this.l,this):(this.i=!1,je(this)))}else 400==r&&0<a.indexOf("Unknown SID")?(this.o=3,Te(12)):(this.o=0,Te(13)),ze(this),He(this)}}}catch(e){}var l,f,d,p,y,g,m},k.fb=function(){var t,e;this.g&&(t=Jn(this.g),e=this.g.ga(),this.C<e.length&&(Ge(this),Be(this,t,e),this.i&&4!=t&&je(this)))},k.cancel=function(){this.I=!0,ze(this)},k.eb=function(){this.B=null;var t,e,n=Date.now();0<=n-this.Y?(t=this.j,e=this.A,t.info((function(){return"TIMEOUT: "+e})),2!=this.K&&(be(),Te(17)),ze(this),this.o=2,He(this)):Ke(this,this.Y-n)},(k=Ye.prototype).R=function(){Xe(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},k.T=function(){return Xe(this),this.g.concat()},k.get=function(t,e){return $e(this.h,t)?this.h[t]:e},k.set=function(t,e){$e(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},k.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Je=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ze(t,e){var n;this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof Ze?(this.g=void 0!==e?e:t.g,en(this,t.j),this.s=t.s,nn(this,t.i),rn(this,t.m),this.l=t.l,e=t.h,(n=new gn).i=e.i,e.g&&(n.g=new Ye(e.g),n.h=e.h),on(this,n),this.o=t.o):t&&(n=String(t).match(Je))?(this.g=!!e,en(this,n[1]||"",!0),this.s=un(n[2]||""),nn(this,n[3]||"",!0),rn(this,n[4]),this.l=un(n[5]||"",!0),on(this,n[6]||"",!0),this.o=un(n[7]||"")):(this.g=!!e,this.h=new gn(null,this.g))}function tn(t){return new Ze(t)}function en(t,e,n){t.j=n?un(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function nn(t,e,n){t.i=n?un(e,!0):e}function rn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.m=e}else t.m=null}function on(t,e,n){var r,i;e instanceof gn?(t.h=e,r=t.h,(i=t.g)&&!r.j&&(mn(r),r.i=null,r.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(vn(this,e),bn(this,n,t))}),r)),r.j=i):(n||(e=cn(e,pn)),t.h=new gn(e,t.g))}function sn(t,e,n){t.h.set(e,n)}function an(t){return sn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function un(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function cn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,hn),t=n?t.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):t):null}function hn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ze.prototype.toString=function(){var t=[],e=this.j;e&&t.push(cn(e,ln,!0),":");var n=this.i;return!n&&"file"!=e||(t.push("//"),(e=this.s)&&t.push(cn(e,ln,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(cn(n,"/"==n.charAt(0)?dn:fn,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",cn(n,yn)),t.join("")};var ln=/[#\/\?@]/g,fn=/[#\?:]/g,dn=/[#\?]/g,pn=/[#\?@]/g,yn=/#/g;function gn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function mn(t){t.g||(t.g=new Ye,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),o=null;0<=i?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function vn(t,e){mn(t),e=En(t,e),$e(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,$e((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&Xe(t)))}function wn(t,e){return mn(t),e=En(t,e),$e(t.g.h,e)}function bn(t,e,n){vn(t,e),0<n.length&&(t.i=null,t.g.set(En(t,e),W(n)),t.h+=n.length)}function En(t,e){return e=String(e),t.j?e.toLowerCase():e}(k=gn.prototype).add=function(t,e){mn(this),this.i=null,t=En(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},k.forEach=function(t,e){mn(this),this.g.forEach((function(n,r){z(n,(function(n){t.call(e,n,r,this)}),this)}),this)},k.T=function(){mn(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},k.R=function(t){mn(this);var e=[];if("string"==typeof t)wn(this,t)&&(e=Q(e,this.g.get(En(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=Q(e,t[n])}return e},k.set=function(t,e){return mn(this),this.i=null,wn(this,t=En(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},k.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},k.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),o=(r=this.R(r),0);o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.i=t.join("&")};var Tn=function(t,e){this.h=t,this.g=e};function In(t){this.l=t||Sn,t=O.PerformanceNavigationTiming?0<(t=O.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(O.g&&O.g.Ea&&O.g.Ea()&&O.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var _n,Sn=10;function An(t){return t.h||t.g&&t.g.size>=t.j}function Dn(t){return t.h?1:t.g?t.g.size:0}function Nn(t,e){return t.h?t.h==e:t.g&&t.g.has(e)}function Cn(t,e){t.g?t.g.add(e):t.h=e}function kn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Rn(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return W(t.i);var r=t.i;try{for(var i=C(t.g.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.D)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function xn(){}function On(){this.g=new xn}function Ln(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}function Pn(t){this.l=t.$b||null,this.j=t.ib||!1}function Mn(t,e){qt.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Fn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}In.prototype.cancel=function(){var t,e;if(this.i=Rn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=C(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},xn.prototype.stringify=function(t){return O.JSON.stringify(t,void 0)},xn.prototype.parse=function(t){return O.JSON.parse(t,void 0)},K(Pn,Ae),Pn.prototype.g=function(){return new Mn(this.l,this.j)},Pn.prototype.i=(_n={},function(){return _n}),K(Mn,qt);var Fn=0;function Vn(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function Un(t){t.readyState=4,t.l=null,t.j=null,t.A=null,qn(t)}function qn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(k=Mn.prototype).open=function(t,e){if(this.readyState!=Fn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,qn(this)},k.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||O).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},k.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Un(this)),this.readyState=Fn},k.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,qn(this)),this.g&&(this.readyState=3,qn(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==O.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Vn(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},k.Sa=function(t){var e;this.g&&(this.u&&t.value?this.response.push(t.value):this.u||(e=t.value||new Uint8Array(0),(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)),(t.done?Un:qn)(this),3==this.readyState&&Vn(this))},k.Ua=function(t){this.g&&(this.response=this.responseText=t,Un(this))},k.Ta=function(t){this.g&&(this.response=t,Un(this))},k.ha=function(){this.g&&Un(this)},k.setRequestHeader=function(t,e){this.v.append(t,e)},k.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},k.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Mn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Bn=O.JSON.parse;function jn(t){qt.call(this),this.headers=new Ye,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Kn,this.K=this.L=!1}K(jn,qt);var Kn="",Gn=/^https?$/i,Hn=["POST","PUT"];function zn(t){return"content-type"==t.toLowerCase()}function Qn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Wn(t),Xn(t)}function Wn(t){t.D||(t.D=!0,Bt(t,"complete"),Bt(t,"error"))}function Yn(t){if(t.h&&void 0!==x&&(!t.C[1]||4!=Jn(t)||2!=t.ba()))if(t.v&&4==Jn(t))re(t.Fa,0,t);else if(Bt(t,"readystatechange"),4==Jn(t)){t.h=!1;try{var e,n,r,i,o=t.ba();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.H).match(Je)[1]||null)&&O.self&&O.self.location&&(i=(r=O.self.location.protocol).substr(0,r.length-1)),n=!Gn.test(i?i.toLowerCase():"")),e=n),e)Bt(t,"complete"),Bt(t,"success");else{t.m=6;try{var a=2<Jn(t)?t.g.statusText:""}catch(t){a=""}t.j=a+" ["+t.ba()+"]",Wn(t)}}finally{Xn(t)}}}function Xn(t,e){if(t.g){$n(t);var n=t.g,r=t.C[0]?L:null;t.g=null,t.C=null,e||Bt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function $n(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(O.clearTimeout(t.A),t.A=null)}function Jn(t){return t.g?t.g.readyState:0}function Zn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Kn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function tr(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",et(n,(function(t,e){i+=e,i+=":",i+=t,i+="\r\n"})),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):sn(t,e,n))}function er(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function nr(t){this.za=0,this.l=[],this.h=new pe,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=er("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=er("baseRetryDelayMs",5e3,t),this.$a=er("retryDelaySeedMs",1e4,t),this.Ya=er("forwardChannelMaxRetries",2,t),this.ra=er("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new In(t&&t.concurrentRequestLimit),this.Ca=new On,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function rr(t){var e,n;or(t),3==t.G&&(e=t.V++,sn(n=tn(t.F),"SID",t.J),sn(n,"RID",e),sn(n,"TYPE","terminate"),cr(t,n),(e=new xe(t,t.h,e,void 0)).K=2,e.v=an(tn(n)),n=!1,!(n=O.navigator&&O.navigator.sendBeacon?O.navigator.sendBeacon(e.v.toString(),""):n)&&O.Image&&((new Image).src=e.v,n=!0),n||(e.g=Er(e.l,null),e.g.ea(e.v)),e.F=Date.now(),je(e)),wr(t)}function ir(t){t.g&&(dr(t),t.g.cancel(),t.g=null)}function or(t){ir(t),t.u&&(O.clearTimeout(t.u),t.u=null),yr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&O.clearTimeout(t.m),t.m=null)}function sr(t,e){t.l.push(new Tn(t.Za++,e)),3==t.G&&ar(t)}function ar(t){An(t.i)||t.m||(t.m=!0,$t(t.Ha,t),t.C=0)}function ur(t,e){var n=e?e.m:t.V++,r=tn(t.F);sn(r,"SID",t.J),sn(r,"RID",n),sn(r,"AID",t.U),cr(t,r),t.o&&t.s&&tr(r,t.o,t.s),n=new xe(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=hr(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),Cn(t.i,n),Ve(n,r,e)}function cr(t,e){t.j&&We({},(function(t,n){sn(e,n,t)}))}function hr(t,e,n){n=Math.min(t.l.length,n);var r=t.j?B(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].h,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if((c-=o)<0)o=Math.max(0,i[u].h-100),a=!1;else try{!function(t,e,n){var r=n||"";try{We(t,(function(t,n){var i=t;M(t)&&(i=Kt(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function lr(t){t.g||t.u||(t.Y=1,$t(t.Ga,t),t.A=0)}function fr(t){return!(t.g||t.u||3<=t.A)&&(t.Y++,t.u=_e(B(t.Ga,t),mr(t,t.A)),t.A++,1)}function dr(t){null!=t.B&&(O.clearTimeout(t.B),t.B=null)}function pr(t){t.g=new xe(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=tn(t.oa);sn(e,"RID","rpc"),sn(e,"SID",t.J),sn(e,"CI",t.N?"0":"1"),sn(e,"AID",t.U),cr(t,e),sn(e,"TYPE","xmlhttp"),t.o&&t.s&&tr(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=an(tn(e)),n.s=null,n.U=!0,Ue(n,t)}function yr(t){null!=t.v&&(O.clearTimeout(t.v),t.v=null)}function gr(t,e){var n,r,i,o=null;if(t.g==e){yr(t),dr(t),t.g=null;var s=2}else{if(!Nn(t.i,e))return;o=e.D,kn(t.i,e),s=1}if(t.I=e.N,0!=t.G)if(e.i)1==s?(o=e.s?e.s.length:0,e=Date.now()-e.F,n=t.C,Bt(s=ve(),new Ie(s,o)),ar(t)):lr(t);else if(3==(n=e.o)||0==n&&0<t.I||(1!=s||(i=e,Dn((r=t).i)>=r.i.j-(r.m?1:0)||(r.m?(r.l=i.D.concat(r.l),0):1==r.G||2==r.G||r.C>=(r.Xa?0:r.Ya)||(r.m=_e(B(r.Ha,r,i),mr(r,r.C)),r.C++,0))))&&(2!=s||!fr(t)))switch(o&&0<o.length&&(e=t.i,e.i=e.i.concat(o)),n){case 1:vr(t,5);break;case 4:vr(t,10);break;case 3:vr(t,6);break;default:vr(t,2)}}function mr(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function vr(t,e){var n,r,i,o;t.h.info("Error code "+e),2==e?(r=null,t.j&&(r=null),o=B(t.jb,t),r||(r=new Ze("//www.google.com/images/cleardot.gif"),O.location&&"http"==O.location.protocol||en(r,"https"),an(r)),n=r.toString(),r=o,o=new pe,O.Image?((i=new Image).onload=j(Ln,o,i,"TestLoadImage: loaded",!0,r),i.onerror=j(Ln,o,i,"TestLoadImage: error",!1,r),i.onabort=j(Ln,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=j(Ln,o,i,"TestLoadImage: timeout",!1,r),O.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=n):r(!1)):Te(2),t.G=0,t.j&&t.j.va(e),wr(t),or(t)}function wr(t){t.G=0,t.I=-1,t.j&&(0==Rn(t.i).length&&0==t.l.length||(t.i.i.length=0,W(t.l),t.l.length=0),t.j.ua())}function br(t,e,n){var r,i,o,s,a,u=(s=n)instanceof Ze?tn(s):new Ze(s,void 0);return""!=u.i?(e&&nn(u,e+"."+u.i),rn(u,u.m)):(r=(a=O.location).protocol,i=e?e+"."+a.hostname:a.hostname,o=+a.port,s=n,a=new Ze(null,void 0),r&&en(a,r),i&&nn(a,i),o&&rn(a,o),s&&(a.l=s),u=a),t.aa&&et(t.aa,(function(t,e){sn(u,e,t)})),e=t.D,n=t.sa,e&&n&&sn(u,e,n),sn(u,"VER",t.ma),cr(t,u),u}function Er(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ba&&!t.qa?new jn(new Pn({ib:!0})):new jn(t.qa)).L=t.H,e}function Tr(){}function Ir(){if(ut&&!(10<=Number(vt)))throw Error("Environmental error: no available transport.")}function _r(t,e){qt.call(this),this.g=new nr(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!Y(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Y(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Dr(this)}function Sr(t){Ce.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Ar(){ke.call(this),this.status=1}function Dr(t){this.g=t}(k=jn.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||Le).g(),this.C=this.u?De(this.u):De(Le),this.g.onreadystatechange=B(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void Qn(this,t)}t=n||"";var i,o=new Ye(this.headers);r&&We(r,(function(t,e){o.set(e,t)})),r=function(t){t:{for(var e=zn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.T()),n=O.FormData&&t instanceof O.FormData,0<=H(Hn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{$n(this),0<this.B&&((this.K=(i=this.g,ut&&mt()&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=B(this.pa,this)):this.A=re(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Qn(this,t)}},k.pa=function(){void 0!==x&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Bt(this,"timeout"),this.abort(8))},k.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Bt(this,"complete"),Bt(this,"abort"),Xn(this))},k.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Xn(this,!0)),jn.Z.M.call(this)},k.Fa=function(){this.s||(this.F||this.v||this.l?Yn(this):this.cb())},k.cb=function(){Yn(this)},k.ba=function(){try{return 2<Jn(this)?this.g.status:-1}catch(e){return-1}},k.ga=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},k.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Bn(e)}},k.Da=function(){return this.m},k.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(k=nr.prototype).ma=8,k.G=1,k.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(t){}},k.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new xe(this,this.h,t,void 0),n=this.s;if(this.P&&(n?it(n=nt(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=hr(this,e,r),sn(i=tn(this.F),"RID",t),sn(i,"CVER",22),this.D&&sn(i,"X-HTTP-Session-Id",this.D),cr(this,i),this.o&&n&&tr(i,this.o,n),Cn(this.i,e),this.Ra&&sn(i,"TYPE","init"),this.ja?(sn(i,"$req",r),sn(i,"SID","null"),e.$=!0,Ve(e,i,null)):Ve(e,i,r),this.G=2}}else 3==this.G&&(t?ur(this,t):0==this.l.length||An(this.i)||ur(this))},k.Ga=function(){var t;this.u=null,pr(this),this.$&&!(this.L||null==this.g||this.O<=0)&&(t=2*this.O,this.h.info("BP detection timer enabled: "+t),this.B=_e(B(this.bb,this),t))},k.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,Te(10),ir(this),pr(this))},k.ab=function(){null!=this.v&&(this.v=null,ir(this),fr(this),Te(19))},k.jb=function(t){t?(this.h.info("Successfully pinged google.com"),Te(2)):(this.h.info("Failed to ping google.com"),Te(1))},(k=Tr.prototype).xa=function(){},k.wa=function(){},k.va=function(){},k.ua=function(){},k.Oa=function(){},Ir.prototype.g=function(t,e){return new _r(t,e)},K(_r,qt),_r.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),$t(B(t.hb,t,e))),Te(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=br(t,null,t.W),ar(t)},_r.prototype.close=function(){rr(this.g)},_r.prototype.u=function(t){var e;"string"==typeof t?((e={}).__data__=t,sr(this.g,e)):this.v?((e={}).__data__=Kt(t),sr(this.g,e)):sr(this.g,t)},_r.prototype.M=function(){this.g.j=null,delete this.j,rr(this.g),delete this.g,_r.Z.M.call(this)},K(Sr,Ce),K(Ar,ke),K(Dr,Tr),Dr.prototype.xa=function(){Bt(this.g,"a")},Dr.prototype.wa=function(t){Bt(this.g,new Sr(t))},Dr.prototype.va=function(t){Bt(this.g,new Ar)},Dr.prototype.ua=function(){Bt(this.g,"b")},Ir.prototype.createWebChannel=Ir.prototype.g,_r.prototype.send=_r.prototype.u,_r.prototype.open=_r.prototype.m,Se.NO_ERROR=0,Se.TIMEOUT=8,Se.HTTP_ERROR=6,R.COMPLETE="complete",(Ne.EventType=Gt).OPEN="a",Gt.CLOSE="b",Gt.ERROR="c",Gt.MESSAGE="d",qt.prototype.listen=qt.prototype.N,jn.prototype.listenOnce=jn.prototype.O,jn.prototype.getLastError=jn.prototype.La,jn.prototype.getLastErrorCode=jn.prototype.Da,jn.prototype.getStatus=jn.prototype.ba,jn.prototype.getResponseJson=jn.prototype.Qa,jn.prototype.getResponseText=jn.prototype.ga,jn.prototype.send=jn.prototype.ea;var Nr=ve,Cr=Se,kr=R,Rr=ge,xr=10,Or=11,Lr=Pn,Pr=Ne,Mr=jn,Fr=(Vr.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Vr.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},Vr);function Vr(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}Fr.o=-1;var Ur,qr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Br=(s(Kr,Ur=Error),Kr),jr=new A("@firebase/firestore");function Kr(t,e){var n=this;return(n=Ur.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Gr(){return jr.logLevel}function Hr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];jr.logLevel<=w.DEBUG&&(e=n.map(Wr),jr.debug.apply(jr,h(["Firestore (8.6.8): "+t],e)))}function zr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];jr.logLevel<=w.ERROR&&(e=n.map(Wr),jr.error.apply(jr,h(["Firestore (8.6.8): "+t],e)))}function Qr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];jr.logLevel<=w.WARN&&(e=n.map(Wr),jr.warn.apply(jr,h(["Firestore (8.6.8): "+t],e)))}function Wr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function Yr(t){throw zr(t="FIRESTORE (8.6.8) INTERNAL ASSERTION FAILED: "+(t=void 0===t?"Unexpected state":t)),new Error(t)}function Xr(t){t||Yr()}var $r=(Jr.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Jr);function Jr(){}function Zr(t,e){return t<e?-1:e<t?1:0}function ti(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function ei(t){return t+"\0"}var ni=(oi.now=function(){return oi.fromMillis(Date.now())},oi.fromDate=function(t){return oi.fromMillis(t.getTime())},oi.fromMillis=function(t){var e=Math.floor(t/1e3);return new oi(e,Math.floor(1e6*(t-1e3*e)))},oi.prototype.toDate=function(){return new Date(this.toMillis())},oi.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},oi.prototype._compareTo=function(t){return this.seconds===t.seconds?Zr(this.nanoseconds,t.nanoseconds):Zr(this.seconds,t.seconds)},oi.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},oi.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},oi.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},oi.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},oi),ri=(ii.fromTimestamp=function(t){return new ii(t)},ii.min=function(){return new ii(new ni(0,0))},ii.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},ii.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},ii.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},ii.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},ii.prototype.toTimestamp=function(){return this.timestamp},ii);function ii(t){this.timestamp=t}function oi(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Br(qr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Br(qr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Br(qr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Br(qr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function si(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function ai(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ui(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}Object.defineProperty(bi.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),bi.prototype.isEqual=function(t){return 0===bi.comparator(this,t)},bi.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof bi?t.forEach((function(t){e.push(t)})):e.push(t),this.construct(e)},bi.prototype.limit=function(){return this.offset+this.length},bi.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},bi.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},bi.prototype.firstSegment=function(){return this.segments[this.offset]},bi.prototype.lastSegment=function(){return this.get(this.length-1)},bi.prototype.get=function(t){return this.segments[this.offset+t]},bi.prototype.isEmpty=function(){return 0===this.length},bi.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},bi.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},bi.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},bi.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},bi.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0};var ci,hi,li=(s(wi,hi=R=bi),wi.prototype.construct=function(t,e,n){return new wi(t,e,n)},wi.prototype.canonicalString=function(){return this.toArray().join("/")},wi.prototype.toString=function(){return this.canonicalString()},wi.fromString=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new Br(qr.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter((function(t){return 0<t.length})))}return new wi(n)},wi.emptyPath=function(){return new wi([])},wi),fi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,di=(s(vi,ci=R),vi.prototype.construct=function(t,e,n){return new vi(t,e,n)},vi.isValidIdentifier=function(t){return fi.test(t)},vi.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),vi.isValidIdentifier(t)?t:"`"+t+"`"})).join(".")},vi.prototype.toString=function(){return this.canonicalString()},vi.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},vi.keyField=function(){return new vi(["__name__"])},vi.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Br(qr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Br(qr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[r+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new Br(qr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=a,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Br(qr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new vi(e)},vi.emptyPath=function(){return new vi([])},vi),pi=(mi.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},mi.prototype.isEqual=function(t){return ti(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},mi),yi=(gi.fromBase64String=function(t){return new gi(atob(t))},gi.fromUint8Array=function(t){return new gi(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},gi.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},gi.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},gi.prototype.approximateByteSize=function(){return 2*this.binaryString.length},gi.prototype.compareTo=function(t){return Zr(this.binaryString,t.binaryString)},gi.prototype.isEqual=function(t){return this.binaryString===t.binaryString},gi);function gi(t){this.binaryString=t}function mi(t){(this.fields=t).sort(di.comparator)}function vi(){return null!==ci&&ci.apply(this,arguments)||this}function wi(){return null!==hi&&hi.apply(this,arguments)||this}function bi(t,e,n){void 0===e?e=0:e>t.length&&Yr(),void 0===n?n=t.length-e:n>t.length-e&&Yr(),this.segments=t,this.offset=e,this.len=n}yi.EMPTY_BYTE_STRING=new yi("");var Ei=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ti(t){if(Xr(!!t),"string"!=typeof t)return{seconds:Ii(t.seconds),nanos:Ii(t.nanos)};var e=0,n=Ei.exec(t);return Xr(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n)),t=new Date(t),{seconds:Math.floor(t.getTime()/1e3),nanos:e}}function Ii(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function _i(t){return"string"==typeof t?yi.fromBase64String(t):yi.fromUint8Array(t)}function Si(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Ai(t){return t=Ti(t.mapValue.fields.__local_write_time__.timestampValue),new ni(t.seconds,t.nanos)}function Di(t){return null==t}function Ni(t){return 0===t&&1/t==-1/0}function Ci(t){return"number"==typeof t&&Number.isInteger(t)&&!Ni(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var ki=(Ri.fromPath=function(t){return new Ri(li.fromString(t))},Ri.fromName=function(t){return new Ri(li.fromString(t).popFirst(5))},Ri.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Ri.prototype.isEqual=function(t){return null!==t&&0===li.comparator(this.path,t.path)},Ri.prototype.toString=function(){return this.path.toString()},Ri.comparator=function(t,e){return li.comparator(t.path,e.path)},Ri.isDocumentKey=function(t){return t.length%2==0},Ri.fromSegments=function(t){return new Ri(new li(t.slice()))},Ri);function Ri(t){this.path=t}function xi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Si(t)?4:10:Yr()}function Oi(t,e){var n,r,i=xi(t);if(i!==xi(e))return!1;switch(i){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Ai(t).isEqual(Ai(e));case 3:return function(e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Ti(t.timestampValue);return e=Ti(e.timestampValue),n.seconds===e.seconds&&n.nanos===e.nanos}(e);case 5:return t.stringValue===e.stringValue;case 6:return r=e,_i(t.bytesValue).isEqual(_i(r.bytesValue));case 7:return t.referenceValue===e.referenceValue;case 8:return n=e,Ii((r=t).geoPointValue.latitude)===Ii(n.geoPointValue.latitude)&&Ii(r.geoPointValue.longitude)===Ii(n.geoPointValue.longitude);case 2:return function(t,e){return"integerValue"in t&&"integerValue"in e?Ii(t.integerValue)===Ii(e.integerValue):"doubleValue"in t&&"doubleValue"in e&&((t=Ii(t.doubleValue))===(e=Ii(e.doubleValue))?Ni(t)===Ni(e):isNaN(t)&&isNaN(e))}(t,e);case 9:return ti(t.arrayValue.values||[],e.arrayValue.values||[],Oi);case 10:return function(){var n,r=t.mapValue.fields||{},i=e.mapValue.fields||{};if(si(r)!==si(i))return!1;for(n in r)if(r.hasOwnProperty(n)&&(void 0===i[n]||!Oi(r[n],i[n])))return!1;return!0}();default:return Yr()}}function Li(t,e){return void 0!==(t.values||[]).find((function(t){return Oi(t,e)}))}function Pi(t,e){var n,r,i,o=xi(t),s=xi(e);if(o!==s)return Zr(o,s);switch(o){case 0:return 0;case 1:return Zr(t.booleanValue,e.booleanValue);case 2:return r=e,(i=Ii(t.integerValue||t.doubleValue))<(r=Ii(r.integerValue||r.doubleValue))?-1:r<i?1:i===r?0:isNaN(i)?isNaN(r)?0:-1:1;case 3:return Mi(t.timestampValue,e.timestampValue);case 4:return Mi(Ai(t),Ai(e));case 5:return Zr(t.stringValue,e.stringValue);case 6:return function(t,e){return t=_i(t),e=_i(e),t.compareTo(e)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Zr(n[i],r[i]);if(0!==o)return o}return Zr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,i=e.geoPointValue,0!==(r=Zr(Ii(n.latitude),Ii(i.latitude)))?r:Zr(Ii(n.longitude),Ii(i.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Pi(n[i],r[i]);if(o)return o}return Zr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Zr(r[s],o[s]);if(0!==a)return a;if(0!==(a=Pi(n[r[s]],i[o[s]])))return a}return Zr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Yr()}}function Mi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Zr(t,e);var n=Ti(t);return t=Ti(e),0!==(e=Zr(n.seconds,t.seconds))?e:Zr(n.nanos,t.nanos)}function Fi(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){return"time("+(t=Ti(t)).seconds+","+t.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?_i(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,ki.fromName(n).toString()):"geoPointValue"in e?"geo("+(n=e.geoPointValue).latitude+","+n.longitude+")":"arrayValue"in e?function(e){for(var n="[",r=!0,i=0,o=e.values||[];i<o.length;i++)r?r=!1:n+=",",n+=t(o[i]);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var n="{",r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=s+":"+t(e.fields[s])}return n+"}"}(e.mapValue):Yr();var n}(t)}function Vi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Ui(t){return t&&"integerValue"in t}function qi(t){return!!t&&"arrayValue"in t}function Bi(t){return t&&"nullValue"in t}function ji(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ki(t){return t&&"mapValue"in t}function Gi(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue)return{timestampValue:Object.assign({},Ti(t.timestampValue))};if(t.mapValue){var e={mapValue:{fields:{}}};return ai(t.mapValue.fields,(function(t,n){return e.mapValue.fields[t]=Gi(n)})),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Gi(t.arrayValue.values[r]);return n}return Object.assign({},t)}var Hi=(zi.empty=function(){return new zi({mapValue:{}})},zi.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!Ki(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},zi.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Gi(e)},zi.prototype.setAll=function(t){var e=this,n=di.emptyPath(),r={},i=[];t.forEach((function(t,o){var s;n.isImmediateParentOf(o)||(s=e.getFieldsMap(n),e.applyChanges(s,r,i),r={},i=[],n=o.popLast()),t?r[o.lastSegment()]=Gi(t):i.push(o.lastSegment())})),t=this.getFieldsMap(n),this.applyChanges(t,r,i)},zi.prototype.delete=function(t){var e=this.field(t.popLast());Ki(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},zi.prototype.isEqual=function(t){return Oi(this.value,t.value)},zi.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];Ki(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},zi.prototype.applyChanges=function(t,e,n){ai(e,(function(e,n){return t[e]=n}));for(var r=0,i=n;r<i.length;r++){var o=i[r];delete t[o]}},zi.prototype.clone=function(){return new zi(Gi(this.value))},zi);function zi(t){this.value=t}var Qi=(Yi.newInvalidDocument=function(t){return new Yi(t,0,ri.min(),Hi.empty(),0)},Yi.newFoundDocument=function(t,e,n){return new Yi(t,1,e,n,0)},Yi.newNoDocument=function(t,e){return new Yi(t,2,e,Hi.empty(),0)},Yi.newUnknownDocument=function(t,e){return new Yi(t,3,e,Hi.empty(),2)},Yi.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},Yi.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Hi.empty(),this.documentState=0,this},Yi.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Hi.empty(),this.documentState=2,this},Yi.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},Yi.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(Yi.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(Yi.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(Yi.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),Yi.prototype.isValidDocument=function(){return 0!==this.documentType},Yi.prototype.isFoundDocument=function(){return 1===this.documentType},Yi.prototype.isNoDocument=function(){return 2===this.documentType},Yi.prototype.isUnknownDocument=function(){return 3===this.documentType},Yi.prototype.isEqual=function(t){return t instanceof Yi&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)},Yi.prototype.clone=function(){return new Yi(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},Yi.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},Yi),Wi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Yi(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}function Xi(t,e,n,r,i,o,s){return new Wi(t,e=void 0===e?null:e,n=void 0===n?[]:n,r=void 0===r?[]:r,i=void 0===i?null:i,o=void 0===o?null:o,s=void 0===s?null:s)}function $i(t){var e=t;return null===e.h&&(t=e.path.canonicalString(),null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((function(t){return(t=t).field.canonicalString()+t.op.toString()+Fi(t.value)})).join(","),t+="|ob:",t+=e.orderBy.map((function(t){return(t=t).field.canonicalString()+t.dir})).join(","),Di(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=Do(e.startAt)),e.endAt&&(t+="|ub:",t+=Do(e.endAt)),e.h=t),e.h}function Ji(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,a=0;a<t.filters.length;a++)if(o=t.filters[a],s=e.filters[a],o.op!==s.op||!o.field.isEqual(s.field)||!Oi(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ko(t.startAt,e.startAt)&&ko(t.endAt,e.endAt)}function Zi(t){return ki.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var to,eo=(s(no,to=function(){}),no.create=function(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.l(t,e,n):new so(t,e,n):"array-contains"===e?new vo(t,n):"in"===e?new wo(t,n):"not-in"===e?new bo(t,n):"array-contains-any"===e?new Eo(t,n):new no(t,e,n)},no.l=function(t,e,n){return new("in"===e?ao:uo)(t,n)},no.prototype.matches=function(t){return t=t.data.field(this.field),"!="===this.op?null!==t&&this.m(Pi(t,this.value)):null!==t&&xi(this.value)===xi(t)&&this.m(Pi(t,this.value))},no.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return Yr()}},no.prototype.g=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},no);function no(t,e,n){var r=this;return(r=to.call(this)||this).field=t,r.op=e,r.value=n,r}var ro,io,oo,so=(s(lo,oo=eo),lo.prototype.matches=function(t){return t=ki.comparator(t.key,this.key),this.m(t)},lo),ao=(s(ho,io=eo),ho.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},ho),uo=(s(co,ro=eo),co.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},co);function co(t,e){var n=this;return(n=ro.call(this,t,"not-in",e)||this).keys=fo(0,e),n}function ho(t,e){var n=this;return(n=io.call(this,t,"in",e)||this).keys=fo(0,e),n}function lo(t,e,n){var r=this;return(r=oo.call(this,t,e,n)||this).key=ki.fromName(n.referenceValue),r}function fo(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map((function(t){return ki.fromName(t.referenceValue)}))}var po,yo,go,mo,vo=(s(Ao,mo=eo),Ao.prototype.matches=function(t){return qi(t=t.data.field(this.field))&&Li(t.arrayValue,this.value)},Ao),wo=(s(So,go=eo),So.prototype.matches=function(t){return null!==(t=t.data.field(this.field))&&Li(this.value.arrayValue,t)},So),bo=(s(_o,yo=eo),_o.prototype.matches=function(t){return!Li(this.value.arrayValue,{nullValue:"NULL_VALUE"})&&null!==(t=t.data.field(this.field))&&!Li(this.value.arrayValue,t)},_o),Eo=(s(Io,po=eo),Io.prototype.matches=function(t){var e=this;return!(!qi(t=t.data.field(this.field))||!t.arrayValue.values)&&t.arrayValue.values.some((function(t){return Li(e.value.arrayValue,t)}))},Io),To=function(t,e){this.position=t,this.before=e};function Io(t,e){return po.call(this,t,"array-contains-any",e)||this}function _o(t,e){return yo.call(this,t,"not-in",e)||this}function So(t,e){return go.call(this,t,"in",e)||this}function Ao(t,e){return mo.call(this,t,"array-contains",e)||this}function Do(t){return(t.before?"b":"a")+":"+t.position.map(Fi).join(",")}var No=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Co(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?ki.comparator(ki.fromName(s.referenceValue),n.key):Pi(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function ko(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Oi(t.position[n],e.position[n]))return!1;return!0}var Ro=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function xo(t,e,n,r,i,o,s,a){return new Ro(t,e,n,r,i,o,s,a)}function Oo(t){return new Ro(t)}function Lo(t){return!Di(t.limit)&&"F"===t.limitType}function Po(t){return!Di(t.limit)&&"L"===t.limitType}function Mo(t){return 0<t.explicitOrderBy.length?t.explicitOrderBy[0].field:null}function Fo(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Vo(t){return null!==t.collectionGroup}function Uo(t){var e=t;if(null===e.p){e.p=[];var n=Fo(e);if(t=Mo(e),null!==n&&null===t)n.isKeyField()||e.p.push(new No(n)),e.p.push(new No(di.keyField(),"asc"));else{for(var r=!1,i=0,o=e.explicitOrderBy;i<o.length;i++){var s=o[i];e.p.push(s),s.field.isKeyField()&&(r=!0)}r||(n=0<e.explicitOrderBy.length?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",e.p.push(new No(di.keyField(),n)))}}return e.p}function qo(t){var e=t;if(!e.T)if("F"===e.limitType)e.T=Xi(e.path,e.collectionGroup,Uo(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Uo(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new No(o.field,s))}var a=e.endAt?new To(e.endAt.position,!e.endAt.before):null;t=e.startAt?new To(e.startAt.position,!e.startAt.before):null,e.T=Xi(e.path,e.collectionGroup,n,e.filters,e.limit,a,t)}return e.T}function Bo(t,e,n){return new Ro(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function jo(t,e){return Ji(qo(t),qo(e))&&t.limitType===e.limitType}function Ko(t){return $i(qo(t))+"|lt:"+t.limitType}function Go(t){return"Query(target="+(n=(e=qo(t)).path.canonicalString(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map((function(t){return(t=t).field.canonicalString()+" "+t.op+" "+Fi(t.value)})).join(", ")+"]"),Di(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map((function(t){return(t=t).field.canonicalString()+" ("+t.dir+")"})).join(", ")+"]"),e.startAt&&(n+=", startAt: "+Do(e.startAt)),e.endAt&&(n+=", endAt: "+Do(e.endAt)),"Target("+n+"); limitType=")+t.limitType+")";var e,n}function Ho(t,e){return e.isFoundDocument()&&(n=t,r=e.key.path,null!==n.collectionGroup?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(r):ki.isDocumentKey(n.path)?n.path.isEqual(r):n.path.isImmediateParentOf(r))&&function(e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return}return 1}(e)&&function(e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return;return 1}(e)&&(r=e,(!(e=t).startAt||Co(e.startAt,Uo(e),r))&&(!e.endAt||!Co(e.endAt,Uo(e),r)));var n,r}function zo(t){return function(e,n){for(var r=!1,i=0,o=Uo(t);i<o.length;i++){var s=o[i],a=function(t,e,n){var r=t.field.isKeyField()?ki.comparator(e.key,n.key):function(t,n){var r=e.data.field(t);return t=n.data.field(t),null!==r&&null!==t?Pi(r,t):Yr()}(t.field,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Yr()}}(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function Qo(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ni(e)?"-0":e}}function Wo(t){return{integerValue:""+t}}function Yo(t,e){return Ci(e)?Wo(e):Qo(t,e)}function Xo(t,e){return t instanceof cs?Ui(t=e)||t&&"doubleValue"in t?e:{integerValue:0}:null}var $o,Jo,Zo=(s(ns,Jo=A=function(){this._=void 0}),ns),ts=(s(es,$o=A),es);function es(t){var e=this;return(e=$o.call(this)||this).elements=t,e}function ns(){return null!==Jo&&Jo.apply(this,arguments)||this}function rs(t,e){for(var n=fs(e),r=0,i=t.elements;r<i.length;r++)!function(t){n.some((function(e){return Oi(e,t)}))||n.push(t)}(i[r]);return{arrayValue:{values:n}}}var is,os=(s(ss,is=A),ss);function ss(t){var e=this;return(e=is.call(this)||this).elements=t,e}function as(t,e){for(var n=fs(e),r=0,i=t.elements;r<i.length;r++)!function(t){n=n.filter((function(e){return!Oi(e,t)}))}(i[r]);return{arrayValue:{values:n}}}var us,cs=(s(hs,us=A),hs);function hs(t,e){var n=this;return(n=us.call(this)||this).R=t,n.A=e,n}function ls(t){return Ii(t.integerValue||t.doubleValue)}function fs(t){return qi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function ds(t,e){this.version=t,this.transformResults=e}var ps=function(t,e){this.field=t,this.transform=e},ys=(gs.none=function(){return new gs},gs.exists=function(t){return new gs(void 0,t)},gs.updateTime=function(t){return new gs(t)},Object.defineProperty(gs.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),gs.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},gs);function gs(t,e){this.updateTime=t,this.exists=e}function ms(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}function vs(t,e,n){var r,i,o,s;t instanceof Is?(i=e,o=n,ms((r=t).precondition,i)&&(s=r.value.clone(),o=Cs(r.fieldTransforms,o,i),s.setAll(o),i.convertToFoundDocument(bs(i),s).setHasLocalMutations())):t instanceof _s?(o=e,i=n,ms((s=t).precondition,o)&&(n=Cs(s.fieldTransforms,i,o),(i=o.data).setAll(Ds(s)),i.setAll(n),o.convertToFoundDocument(bs(o),i).setHasLocalMutations())):(e=e,ms(t.precondition,e)&&e.convertToNoDocument(ri.min()))}function ws(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&ti(n,r,(function(t,e){return e=e,(t=t).field.isEqual(e.field)&&(t=t.transform,e=e.transform,t instanceof ts&&e instanceof ts||t instanceof os&&e instanceof os?ti(t.elements,e.elements,Oi):t instanceof cs&&e instanceof cs?Oi(t.A,e.A):t instanceof Zo&&e instanceof Zo)}))))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask));var n,r}function bs(t){return t.isFoundDocument()?t.version:ri.min()}var Es,Ts,Is=(s(As,Ts=R=function(){}),As),_s=(s(Ss,Es=R),Ss);function Ss(t,e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=Es.call(this)||this).key=t,o.data=e,o.fieldMask=n,o.precondition=r,o.fieldTransforms=i,o.type=1,o}function As(t,e,n,r){void 0===r&&(r=[]);var i=this;return(i=Ts.call(this)||this).key=t,i.value=e,i.precondition=n,i.fieldTransforms=r,i.type=0,i}function Ds(t){var e=new Map;return t.fieldMask.fields.forEach((function(n){var r;n.isEmpty()||(r=t.data.field(n),e.set(n,r))})),e}function Ns(t,e,n){var r=new Map;Xr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,(o=s,s=a,a=n[i],o instanceof ts?rs(o,s):o instanceof os?as(o,s):a))}return r}function Cs(t,e,n){for(var r,i=new Map,o=0,s=t;o<s.length;o++){var a=s[o],u=a.transform,c=n.data.field(a.field);i.set(a.field,(r=c,a=e,c=void 0,(u=u)instanceof Zo?(c={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}},r&&(c.fields.__previous_value__=r),{mapValue:c}):u instanceof ts?rs(u,r):u instanceof os?as(u,r):(r=ls(u=Xo(c=u,r))+ls(c.A),Ui(u)&&Ui(c.A)?Wo(r):Qo(c.R,r))))}return i}function ks(t){this.count=t}var Rs,xs,Os,Ls=(s(Fs,Os=R),Fs),Ps=(s(Ms,xs=R),Ms);function Ms(t,e){var n=this;return(n=xs.call(this)||this).key=t,n.precondition=e,n.type=3,n.fieldTransforms=[],n}function Fs(t,e){var n=this;return(n=Os.call(this)||this).key=t,n.precondition=e,n.type=2,n.fieldTransforms=[],n}function Vs(t){switch(t){case qr.OK:return Yr(),0;case qr.CANCELLED:case qr.UNKNOWN:case qr.DEADLINE_EXCEEDED:case qr.RESOURCE_EXHAUSTED:case qr.INTERNAL:case qr.UNAVAILABLE:case qr.UNAUTHENTICATED:return;case qr.INVALID_ARGUMENT:case qr.NOT_FOUND:case qr.ALREADY_EXISTS:case qr.PERMISSION_DENIED:case qr.FAILED_PRECONDITION:case qr.ABORTED:case qr.OUT_OF_RANGE:case qr.UNIMPLEMENTED:case qr.DATA_LOSS:return 1;default:return Yr(),0}}function Us(t){if(void 0===t)return zr("GRPC error has no .code"),qr.UNKNOWN;switch(t){case Rs.OK:return qr.OK;case Rs.CANCELLED:return qr.CANCELLED;case Rs.UNKNOWN:return qr.UNKNOWN;case Rs.DEADLINE_EXCEEDED:return qr.DEADLINE_EXCEEDED;case Rs.RESOURCE_EXHAUSTED:return qr.RESOURCE_EXHAUSTED;case Rs.INTERNAL:return qr.INTERNAL;case Rs.UNAVAILABLE:return qr.UNAVAILABLE;case Rs.UNAUTHENTICATED:return qr.UNAUTHENTICATED;case Rs.INVALID_ARGUMENT:return qr.INVALID_ARGUMENT;case Rs.NOT_FOUND:return qr.NOT_FOUND;case Rs.ALREADY_EXISTS:return qr.ALREADY_EXISTS;case Rs.PERMISSION_DENIED:return qr.PERMISSION_DENIED;case Rs.FAILED_PRECONDITION:return qr.FAILED_PRECONDITION;case Rs.ABORTED:return qr.ABORTED;case Rs.OUT_OF_RANGE:return qr.OUT_OF_RANGE;case Rs.UNIMPLEMENTED:return qr.UNIMPLEMENTED;case Rs.DATA_LOSS:return qr.DATA_LOSS;default:return Yr()}}(A=Rs=Rs||{})[A.OK=0]="OK",A[A.CANCELLED=1]="CANCELLED",A[A.UNKNOWN=2]="UNKNOWN",A[A.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",A[A.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",A[A.NOT_FOUND=5]="NOT_FOUND",A[A.ALREADY_EXISTS=6]="ALREADY_EXISTS",A[A.PERMISSION_DENIED=7]="PERMISSION_DENIED",A[A.UNAUTHENTICATED=16]="UNAUTHENTICATED",A[A.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",A[A.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",A[A.ABORTED=10]="ABORTED",A[A.OUT_OF_RANGE=11]="OUT_OF_RANGE",A[A.UNIMPLEMENTED=12]="UNIMPLEMENTED",A[A.INTERNAL=13]="INTERNAL",A[A.UNAVAILABLE=14]="UNAVAILABLE",A[A.DATA_LOSS=15]="DATA_LOSS";var qs=(Hs.prototype.insert=function(t,e){return new Hs(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,js.BLACK,null,null))},Hs.prototype.remove=function(t){return new Hs(this.comparator,this.root.remove(t,this.comparator).copy(null,null,js.BLACK,null,null))},Hs.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Hs.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Hs.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(Hs.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),Hs.prototype.minKey=function(){return this.root.minKey()},Hs.prototype.maxKey=function(){return this.root.maxKey()},Hs.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},Hs.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},Hs.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},Hs.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},Hs.prototype.getIterator=function(){return new Bs(this.root,null,this.comparator,!1)},Hs.prototype.getIteratorFrom=function(t){return new Bs(this.root,t,this.comparator,!1)},Hs.prototype.getReverseIterator=function(){return new Bs(this.root,null,this.comparator,!0)},Hs.prototype.getReverseIteratorFrom=function(t){return new Bs(this.root,t,this.comparator,!0)},Hs),Bs=(Gs.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},Gs.prototype.hasNext=function(){return 0<this.nodeStack.length},Gs.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},Gs),js=(Ks.prototype.copy=function(t,e,n,r,i){return new Ks(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Ks.prototype.isEmpty=function(){return!1},Ks.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},Ks.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},Ks.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},Ks.prototype.minKey=function(){return this.min().key},Ks.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},Ks.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},Ks.prototype.removeMin=function(){if(this.left.isEmpty())return Ks.EMPTY;var t=this;return(t=(t=t.left.isRed()||t.left.left.isRed()?t:t.moveRedLeft()).copy(null,null,null,t.left.removeMin(),null)).fixUp()},Ks.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r=(r=r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()?r:r.moveRedLeft()).copy(null,null,null,r.left.remove(t,e),null);else{if(0===e(t,(r=(r=r.left.isRed()?r.rotateRight():r).right.isEmpty()||r.right.isRed()||r.right.left.isRed()?r:r.moveRedRight()).key)){if(r.right.isEmpty())return Ks.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},Ks.prototype.isRed=function(){return this.color},Ks.prototype.fixUp=function(){var t=this;return(t=(t=t.right.isRed()&&!t.left.isRed()?t.rotateLeft():t).left.isRed()&&t.left.left.isRed()?t.rotateRight():t).left.isRed()&&t.right.isRed()?t.colorFlip():t},Ks.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()?(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip():t},Ks.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()?(t=t.rotateRight()).colorFlip():t},Ks.prototype.rotateLeft=function(){var t=this.copy(null,null,Ks.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Ks.prototype.rotateRight=function(){var t=this.copy(null,null,Ks.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Ks.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Ks.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},Ks.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Yr();if(this.right.isRed())throw Yr();var t=this.left.check();if(t!==this.right.check())throw Yr();return t+(this.isRed()?0:1)},Ks);function Ks(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Ks.RED,this.left=null!=r?r:Ks.EMPTY,this.right=null!=i?i:Ks.EMPTY,this.size=this.left.size+1+this.right.size}function Gs(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}function Hs(t,e){this.comparator=t,this.root=e||js.EMPTY}function zs(){this.size=0}js.EMPTY=null,js.RED=!0,js.BLACK=!1,js.EMPTY=(Object.defineProperty(zs.prototype,"key",{get:function(){throw Yr()},enumerable:!1,configurable:!0}),Object.defineProperty(zs.prototype,"value",{get:function(){throw Yr()},enumerable:!1,configurable:!0}),Object.defineProperty(zs.prototype,"color",{get:function(){throw Yr()},enumerable:!1,configurable:!0}),Object.defineProperty(zs.prototype,"left",{get:function(){throw Yr()},enumerable:!1,configurable:!0}),Object.defineProperty(zs.prototype,"right",{get:function(){throw Yr()},enumerable:!1,configurable:!0}),zs.prototype.copy=function(t,e,n,r,i){return this},zs.prototype.insert=function(t,e,n){return new js(t,e)},zs.prototype.remove=function(t,e){return this},zs.prototype.isEmpty=function(){return!0},zs.prototype.inorderTraversal=function(t){return!1},zs.prototype.reverseTraversal=function(t){return!1},zs.prototype.minKey=function(){return null},zs.prototype.maxKey=function(){return null},zs.prototype.isRed=function(){return!1},zs.prototype.checkMaxDepth=function(){return!0},zs.prototype.check=function(){return 0},new zs);var Qs=($s.prototype.has=function(t){return null!==this.data.get(t)},$s.prototype.first=function(){return this.data.minKey()},$s.prototype.last=function(){return this.data.maxKey()},Object.defineProperty($s.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),$s.prototype.indexOf=function(t){return this.data.indexOf(t)},$s.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},$s.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},$s.prototype.forEachWhile=function(t,e){for(var n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},$s.prototype.firstAfterOrEqual=function(t){return(t=this.data.getIteratorFrom(t)).hasNext()?t.getNext().key:null},$s.prototype.getIterator=function(){return new Ws(this.data.getIterator())},$s.prototype.getIteratorFrom=function(t){return new Ws(this.data.getIteratorFrom(t))},$s.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},$s.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},$s.prototype.isEmpty=function(){return this.data.isEmpty()},$s.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},$s.prototype.isEqual=function(t){if(!(t instanceof $s))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},$s.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},$s.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},$s.prototype.copy=function(t){var e=new $s(this.comparator);return e.data=t,e},$s),Ws=(Xs.prototype.getNext=function(){return this.iter.getNext().key},Xs.prototype.hasNext=function(){return this.iter.hasNext()},Xs),Ys=new qs(ki.comparator);function Xs(t){this.iter=t}function $s(t){this.comparator=t,this.data=new qs(this.comparator)}var Js=new qs(ki.comparator),Zs=new qs(ki.comparator),ta=new Qs(ki.comparator);function ea(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=ta,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var na=new Qs(Zr),ra=(da.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n=new Map;return n.set(t,ia.createSynthesizedTargetChangeForCurrentChange(t,e)),new da(ri.min(),n,na,Ys,ea())},da),ia=(fa.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new fa(yi.EMPTY_BYTE_STRING,e,ea(),ea(),ea())},fa),oa=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},sa=function(t,e){this.targetId=t,this.V=e},aa=function(t,e,n,r){void 0===n&&(n=yi.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},ua=(Object.defineProperty(la.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(la.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(la.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(la.prototype,"$",{get:function(){return this.F},enumerable:!1,configurable:!0}),la.prototype.O=function(t){0<t.approximateByteSize()&&(this.F=!0,this.C=t)},la.prototype.M=function(){var t=ea(),e=ea(),n=ea();return this.D.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Yr()}})),new ia(this.C,this.N,t,e,n)},la.prototype.L=function(){this.F=!1,this.D=ya()},la.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},la.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},la.prototype.U=function(){this.S+=1},la.prototype.K=function(){--this.S},la.prototype.j=function(){this.F=!0,this.N=!0},la),ca=(ha.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},ha.prototype.et=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:Yr()}}))},ha.prototype.forEachTarget=function(t,e){var n=this;0<t.targetIds.length?t.targetIds.forEach(e):this.G.forEach((function(t,r){n.st(r)&&e(r)}))},ha.prototype.rt=function(t){var e=t.targetId,n=t.V.count;(t=this.ot(e))&&(Zi(t=t.target)?0===n?(t=new ki(t.path),this.tt(e,t,Qi.newNoDocument(t,ri.min()))):Xr(1===n):this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e)))},ha.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach((function(r,i){var o=e.ot(i);o&&(r.current&&Zi(o.target)&&(o=new ki(o.target.path),null!==e.H.get(o)||e.at(i,o)||e.tt(i,o,Qi.newNoDocument(o,t))),r.$&&(n.set(i,r.M()),r.L()))}));var r=ea();this.J.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){return!(t=e.ot(t))||2===t.purpose||(i=!1)})),i&&(r=r.add(t))}));var i=new ra(t,n,this.Y,this.H,r);return this.H=Ys,this.J=pa(),this.Y=new Qs(Zr),i},ha.prototype.Z=function(t,e){var n;this.st(t)&&(n=this.at(t,e.key)?2:0,this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t)))},ha.prototype.tt=function(t,e,n){var r;this.st(t)&&(r=this.nt(t),this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n)))},ha.prototype.removeTarget=function(t){this.G.delete(t)},ha.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},ha.prototype.U=function(t){this.nt(t).U()},ha.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new ua,this.G.set(t,e)),e},ha.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Qs(Zr),this.J=this.J.insert(t,e)),e},ha.prototype.st=function(t){var e=null!==this.ot(t);return e||Hr("WatchChangeAggregator","Detected inactive target",t),e},ha.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},ha.prototype.it=function(t){var e=this;this.G.set(t,new ua),this.W.getRemoteKeysForTarget(t).forEach((function(n){e.tt(t,n,null)}))},ha.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},ha);function ha(t){this.W=t,this.G=new Map,this.H=Ys,this.J=pa(),this.Y=new Qs(Zr)}function la(){this.S=0,this.D=ya(),this.C=yi.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}function fa(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}function da(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}function pa(){return new qs(ki.comparator)}function ya(){return new qs(ki.comparator)}var ga={asc:"ASCENDING",desc:"DESCENDING"},ma={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},va=function(t,e){this.databaseId=t,this.I=e};function wa(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ba(t,e){return t.I?e.toBase64():e.toUint8Array()}function Ea(t){return Xr(!!t),ri.fromTimestamp((t=Ti(t),new ni(t.seconds,t.nanos)))}function Ta(t,e){return new li(["projects",t.projectId,"databases",t.database]).child("documents").child(e).canonicalString()}function Ia(t){return Xr(Ka(t=li.fromString(t))),t}function _a(t,e){return Ta(t.databaseId,e.path)}function Sa(t,e){if((e=Ia(e)).get(1)!==t.databaseId.projectId)throw new Br(qr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+t.databaseId.projectId);if(e.get(3)!==t.databaseId.database)throw new Br(qr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+t.databaseId.database);return new ki(Ca(e))}function Aa(t,e){return Ta(t.databaseId,e)}function Da(t){return 4===(t=Ia(t)).length?li.emptyPath():Ca(t)}function Na(t){return new li(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Ca(t){return Xr(4<t.length&&"documents"===t.get(4)),t.popFirst(5)}function ka(t,e,n){return{name:_a(t,e),fields:n.value.mapValue.fields}}function Ra(t,e,n){var r=Sa(t,e.name);return t=Ea(e.updateTime),e=new Hi({mapValue:{fields:e.fields}}),e=Qi.newFoundDocument(r,t,e),n&&e.setHasCommittedMutations(),n?e.setHasCommittedMutations():e}function xa(t,e){var n,r,i;if(e instanceof Is)n={update:ka(t,e.key,e.value)};else if(e instanceof Ls)n={delete:_a(t,e.key)};else if(e instanceof _s)n={update:ka(t,e.key,e.data),updateMask:(r=e.fieldMask,i=[],r.fields.forEach((function(t){return i.push(t.canonicalString())})),{fieldPaths:i})};else{if(!(e instanceof Ps))return Yr();n={verify:_a(t,e.key)}}return 0<e.fieldTransforms.length&&(n.updateTransforms=e.fieldTransforms.map((function(t){var e=t.transform;if(e instanceof Zo)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(e instanceof ts)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:e.elements}};if(e instanceof os)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:e.elements}};if(e instanceof cs)return{fieldPath:t.field.canonicalString(),increment:e.A};throw Yr()}))),e.precondition.isNone||(n.currentDocument=void 0!==(e=e.precondition).updateTime?{updateTime:wa(t,e.updateTime.toTimestamp())}:void 0!==e.exists?{exists:e.exists}:Yr()),n}function Oa(t,e){var n=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?ys.updateTime(Ea(s.updateTime)):void 0!==s.exists?ys.exists(s.exists):ys.none():ys.none(),r=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n,r=null;return"setToServerValue"in e?(Xr("REQUEST_TIME"===e.setToServerValue),r=new Zo):"appendMissingElements"in e?(n=e.appendMissingElements.values||[],r=new ts(n)):"removeAllFromArray"in e?(n=e.removeAllFromArray.values||[],r=new os(n)):"increment"in e?r=new cs(t,e.increment):Yr(),e=di.fromServerFormat(e.fieldPath),new ps(e,r)}(t,e)})):[];if(e.update){e.update.name;var i=Sa(t,e.update.name),o=new Hi({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=(s=e.updateMask.fieldPaths||[],new pi(s.map((function(t){return di.fromServerFormat(t)}))));return new _s(i,o,s,n,r)}return new Is(i,o,n,r)}return e.delete?(r=Sa(t,e.delete),new Ls(r,n)):e.verify?(e=Sa(t,e.verify),new Ps(e,n)):Yr()}function La(t,e){return{documents:[Aa(t,e.path)]}}function Pa(t,e){var n={structuredQuery:{}},r=e.path;return null!==e.collectionGroup?(n.parent=Aa(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Aa(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),(r=function(t){if(0!==t.length)return 1===(t=t.map((function(t){if("=="===t.op){if(ji(t.value))return{unaryFilter:{field:Ua(t.field),op:"IS_NAN"}};if(Bi(t.value))return{unaryFilter:{field:Ua(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(ji(t.value))return{unaryFilter:{field:Ua(t.field),op:"IS_NOT_NAN"}};if(Bi(t.value))return{unaryFilter:{field:Ua(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ua(t.field),op:(e=t.op,ma[e]),value:t.value}};var e}))).length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(e.filters))&&(n.structuredQuery.where=r),(r=function(t){if(0!==t.length)return t.map((function(t){return{field:Ua((t=t).field),direction:(t=t.dir,ga[t])}}))}(e.orderBy))&&(n.structuredQuery.orderBy=r),r=e.limit,null!==(r=t.I||Di(r)?r:{value:r})&&(n.structuredQuery.limit=r),e.startAt&&(n.structuredQuery.startAt=Fa(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Fa(e.endAt)),n}function Ma(t){var e=Da(t.parent),n=t.structuredQuery,r=null;0<(s=n.from?n.from.length:0)&&(Xr(1===s),(a=n.from[0]).allDescendants?r=a.collectionId:e=e.child(a.collectionId));var i=[];n.where&&(i=function t(e){return e?void 0!==e.unaryFilter?[ja(e)]:void 0!==e.fieldFilter?[Ba(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e)})).reduce((function(t,e){return t.concat(e)})):Yr():[]}(n.where));var o=[],s=(t=null,null),a=null;return xo(e,r,o=n.orderBy?n.orderBy.map((function(t){return new No(qa((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e})):o,i,t=n.limit?Di(i="object"==typeof(i=n.limit)?i.value:i)?null:i:t,"F",s=n.startAt?Va(n.startAt):s,a=n.endAt?Va(n.endAt):a)}function Fa(t){return{before:t.before,values:t.position}}function Va(t){var e=!!t.before;return t=t.values||[],new To(t,e)}function Ua(t){return{fieldPath:t.canonicalString()}}function qa(t){return di.fromServerFormat(t.fieldPath)}function Ba(t){return eo.create(qa(t.fieldFilter.field),function(){switch(t.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Yr()}}(),t.fieldFilter.value)}function ja(t){switch(t.unaryFilter.op){case"IS_NAN":var e=qa(t.unaryFilter.field);return eo.create(e,"==",{doubleValue:NaN});case"IS_NULL":return e=qa(t.unaryFilter.field),eo.create(e,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=qa(t.unaryFilter.field);return eo.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":return n=qa(t.unaryFilter.field),eo.create(n,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Yr()}}function Ka(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function Ga(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Ha(e)),e=function(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}(t.get(n),e);return Ha(e)}function Ha(t){return t+"\x01\x01"}function za(t){var e=t.length;if(Xr(2<=e),2===e)return Xr("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),li.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||n<s)&&Yr(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:Yr()}o=s+2}return new li(r)}function Qa(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var Wa=function(t,e){this.seconds=t,this.nanoseconds=e};function Ya(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}function Xa(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}Qa.store="owner",Qa.key="owner",Ya.store="mutationQueues",Ya.keyPath="userId",Xa.store="mutations",Xa.keyPath="batchId",Xa.userMutationsIndex="userMutationsIndex",Xa.userMutationsKeyPath=["userId","batchId"];var $a=(Ja.prefixForUser=function(t){return[t]},Ja.prefixForPath=function(t,e){return[t,Ga(e)]},Ja.key=function(t,e,n){return[t,Ga(e),n]},Ja);function Ja(){}function Za(t,e){this.path=t,this.readTime=e}function tu(t,e){this.path=t,this.version=e}$a.store="documentMutations",$a.PLACEHOLDER=new $a;var eu=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};function nu(t){this.byteSize=t}function ru(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s}eu.store="remoteDocuments",eu.readTimeIndex="readTimeIndex",eu.readTimeIndexPath="readTime",eu.collectionReadTimeIndex="collectionReadTimeIndex",eu.collectionReadTimeIndexPath=["parentPath","readTime"],nu.store="remoteDocumentGlobal",nu.key="remoteDocumentGlobalKey",ru.store="targets",ru.keyPath="targetId",ru.queryTargetsIndexName="queryTargetsIndex",ru.queryTargetsKeyPath=["canonicalId","targetId"];var iu=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};function ou(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}function su(t,e){this.collectionId=t,this.parent=e}function au(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}function uu(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}function cu(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}iu.store="targetDocuments",iu.keyPath=["targetId","path"],iu.documentTargetsIndex="documentTargetsIndex",iu.documentTargetsKeyPath=["path","targetId"],ou.key="targetGlobalKey",ou.store="targetGlobal",su.store="collectionParents",su.keyPath=["collectionId","parent"],au.store="clientMetadata",au.keyPath="clientId",uu.store="bundles",uu.keyPath="bundleId",cu.store="namedQueries",cu.keyPath="name";var hu,lu=h(h([],h(h([],h(h([],h(h([],[Ya.store,Xa.store,$a.store,eu.store,ru.store,Qa.store,ou.store,iu.store]),[au.store])),[nu.store])),[su.store])),[uu.store,cu.store]),fu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",du=(_u.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},_u.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},R=_u,function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}),pu=(Iu.prototype.catch=function(t){return this.next(void 0,t)},Iu.prototype.next=function(t,e){var n=this;return this.callbackAttached&&Yr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Iu((function(r,i){n.nextCallback=function(e){n.wrapSuccess(t,e).next(r,i)},n.catchCallback=function(t){n.wrapFailure(e,t).next(r,i)}}))},Iu.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},Iu.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof Iu?e:Iu.resolve(e)}catch(t){return Iu.reject(t)}},Iu.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction((function(){return t(e)})):Iu.resolve(e)},Iu.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction((function(){return t(e)})):Iu.reject(e)},Iu.resolve=function(t){return new Iu((function(e,n){e(t)}))},Iu.reject=function(t){return new Iu((function(e,n){n(t)}))},Iu.waitFor=function(t){return new Iu((function(e,n){var r=0,i=0,o=!1;t.forEach((function(t){++r,t.next((function(){++i,o&&i===r&&e()}),(function(t){return n(t)}))})),o=!0,i===r&&e()}))},Iu.or=function(t){for(var e=Iu.resolve(!1),n=0,r=t;n<r.length;n++)!function(t){e=e.next((function(e){return e?Iu.resolve(e):t()}))}(r[n]);return e},Iu.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},Iu),yu=(Tu.open=function(t,e,n,r){try{return new Tu(e,t.transaction(r,n))}catch(t){throw new vu(e,t)}},Object.defineProperty(Tu.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),Tu.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(Hr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Tu.prototype.store=function(t){return t=this.transaction.objectStore(t),new Au(t)},Tu),gu=(Eu.delete=function(t){return Hr("SimpleDb","Removing database:",t),Nu(window.indexedDB.deleteDatabase(t)).toPromise()},Eu.yt=function(){if("undefined"==typeof indexedDB)return!1;if(Eu.gt())return!0;var t=f(),e=0<(n=Eu._t(t))&&n<10,n=0<(n=Eu.Et(t))&&n<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||e||n)},Eu.gt=function(){var t;return"undefined"!=typeof r&&"YES"===(null===(t=r.env)||void 0===t?void 0:t.Tt)},Eu.It=function(t,e){return t.store(e)},Eu._t=function(t){return t=(t=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i))?t[1].split("_").slice(0,2).join("."):"-1",Number(t)},Eu.Et=function(t){return t=(t=t.match(/Android ([\d.]+)/i))?t[1].split(".").slice(0,2).join("."):"-1",Number(t)},Eu.prototype.At=function(t){return u(this,void 0,void 0,(function(){var e,n=this;return c(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(Hr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){t=t.target.result,e(t)},i.onblocked=function(){r(new vu(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){"VersionError"===(e=e.target.error).name?r(new Br(qr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new vu(t,e))},i.onupgradeneeded=function(t){Hr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.wt.Rt(e,i.transaction,t.oldVersion,n.version).next((function(){Hr("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}}))}))},Eu.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},Eu.prototype.runTransaction=function(t,e,n,r){return u(this,void 0,void 0,(function(){var i,o,s,a;return c(this,(function(u){switch(u.label){case 0:i="readonly"===e,o=0,a=function(){var e,a,u;return c(this,(function(c){switch(c.label){case 0:++o,c.label=1;case 1:return c.trys.push([1,4,,5]),[4,s.At(t)];case 2:return s.db=c.sent(),e=yu.open(s.db,t,i?"readonly":"readwrite",n),a=r(e).catch((function(t){return e.abort(t),pu.reject(t)})).toPromise(),u={},a.catch((function(){})),[4,e.dt];case 3:return[2,(u.value=(c.sent(),a),u)];case 4:return a=c.sent(),u="FirebaseError"!==a.name&&o<3,Hr("SimpleDb","Transaction failed with error:",a.message,"Retrying:",u),s.close(),u?[3,5]:[2,{value:Promise.reject(a)}];case 5:return[2]}}))},s=this,u.label=1;case 1:return[5,a()];case 2:if("object"==typeof(a=u.sent()))return[2,a.value];u.label=3;case 3:return[3,1];case 4:return[2]}}))}))},Eu.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},Eu),mu=(Object.defineProperty(bu.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(bu.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(bu.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),bu.prototype.done=function(){this.Vt=!0},bu.prototype.Ct=function(t){this.St=t},bu.prototype.delete=function(){return Nu(this.Pt.delete())},bu),vu=(s(wu,hu=Br),wu);function wu(t,e){var n=this;return(n=hu.call(this,qr.UNAVAILABLE,"IndexedDB transaction '"+t+"' failed: "+e)||this).name="IndexedDbTransactionError",n}function bu(t){this.Pt=t,this.Vt=!1,this.St=null}function Eu(t,e,n){this.name=t,this.version=e,this.wt=n,12.2===Eu._t(f())&&zr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Tu(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new du,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new vu(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){e=ku(e.target.error),n.ft.reject(new vu(t,e))}}function Iu(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}function _u(){this.onCommittedListeners=[]}function Su(t){return"IndexedDbTransactionError"===t.name}var Au=(Du.prototype.put=function(t,e){return Nu(t=void 0!==e?(Hr("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Hr("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Du.prototype.add=function(t){return Hr("SimpleDb","ADD",this.store.name,t,t),Nu(this.store.add(t))},Du.prototype.get=function(t){var e=this;return Nu(this.store.get(t)).next((function(n){return Hr("SimpleDb","GET",e.store.name,t,n=void 0===n?null:n),n}))},Du.prototype.delete=function(t){return Hr("SimpleDb","DELETE",this.store.name,t),Nu(this.store.delete(t))},Du.prototype.count=function(){return Hr("SimpleDb","COUNT",this.store.name),Nu(this.store.count())},Du.prototype.Nt=function(t,e){e=this.cursor(this.options(t,e));var n=[];return this.xt(e,(function(t,e){n.push(e)})).next((function(){return n}))},Du.prototype.Ft=function(t,e){return Hr("SimpleDb","DELETE ALL",this.store.name),(e=this.options(t,e)).kt=!1,e=this.cursor(e),this.xt(e,(function(t,e,n){return n.delete()}))},Du.prototype.$t=function(t,e){e?n=t:(n={},e=t);var n=this.cursor(n);return this.xt(n,e)},Du.prototype.Ot=function(t){var e=this.cursor({});return new pu((function(n,r){e.onerror=function(t){t=ku(t.target.error),r(t)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},Du.prototype.xt=function(t,e){var n=[];return new pu((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i,o=t.target.result;o?(i=new mu(o),(t=e(o.primaryKey,o.value,i))instanceof pu&&(t=t.catch((function(t){return i.done(),pu.reject(t)})),n.push(t)),i.isDone?r():null===i.Dt?o.continue():o.continue(i.Dt)):r()}})).next((function(){return pu.waitFor(n)}))},Du.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},Du.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Du);function Du(t){this.store=t}function Nu(t){return new pu((function(e,n){t.onsuccess=function(t){t=t.target.result,e(t)},t.onerror=function(t){t=ku(t.target.error),n(t)}}))}var Cu=!1;function ku(t){var e=gu._t(f());if(12.2<=e&&e<13&&(e="An internal error was encountered in the Indexed Database server",0<=t.message.indexOf(e))){var n=new Br("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+e+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Cu||(Cu=!0,setTimeout((function(){throw n}),0)),n}return t}var Ru,xu=(s(Ou,Ru=R),Ou);function Ou(t,e){var n=this;return(n=Ru.call(this)||this).Mt=t,n.currentSequenceNumber=e,n}function Lu(t,e){return gu.It(t.Mt,e)}var Pu=(Bu.prototype.applyToRemoteDocument=function(t,e){for(var n,r,i,o,s,a,u=e.mutationResults,c=0;c<this.mutations.length;c++){var h=this.mutations[c];h.key.isEqual(t.key)&&(n=h,r=t,i=u[c],h=a=s=o=void 0,n instanceof Is?(s=r,a=i,h=(o=n).value.clone(),o=Ns(o.fieldTransforms,s,a.transformResults),h.setAll(o),s.convertToFoundDocument(a.version,h).setHasCommittedMutations()):n instanceof _s?(o=r,s=i,ms((a=n).precondition,o)?(h=Ns(a.fieldTransforms,o,s.transformResults),(n=o.data).setAll(Ds(a)),n.setAll(h),o.convertToFoundDocument(s.version,n).setHasCommittedMutations()):o.convertToUnknownDocument(s.version)):r.convertToNoDocument(i.version).setHasCommittedMutations())}},Bu.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(r=n[e]).key.isEqual(t.key)&&vs(r,t,this.localWriteTime);for(var r,i=0,o=this.mutations;i<o.length;i++)(r=o[i]).key.isEqual(t.key)&&vs(r,t,this.localWriteTime)},Bu.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach((function(n){var r=t.get(n.key);n=r,e.applyToLocalView(n),r.isValidDocument()||n.convertToNoDocument(ri.min())}))},Bu.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),ea())},Bu.prototype.isEqual=function(t){return this.batchId===t.batchId&&ti(this.mutations,t.mutations,ws)&&ti(this.baseMutations,t.baseMutations,ws)},Bu),Mu=(qu.from=function(t,e,n){Xr(t.mutations.length===n.length);for(var r=Zs,i=t.mutations,o=0;o<i.length;o++)r=r.insert(i[o].key,n[o].version);return new qu(t,e,n,r)},qu),Fu=(Uu.prototype.withSequenceNumber=function(t){return new Uu(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Uu.prototype.withResumeToken=function(t,e){return new Uu(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Uu.prototype.withLastLimboFreeSnapshotVersion=function(t){return new Uu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},Uu),Vu=function(t){this.Lt=t};function Uu(t,e,n,r,i,o,s){void 0===i&&(i=ri.min()),void 0===o&&(o=ri.min()),void 0===s&&(s=yi.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function qu(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}function Bu(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}function ju(t,e){if(e.document)return Ra(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=ki.fromSegments(e.noDocument.path),r=Qu(e.noDocument.readTime);return n=Qi.newNoDocument(n,r),e.hasCommittedMutations?n.setHasCommittedMutations():n}return e.unknownDocument?(n=ki.fromSegments(e.unknownDocument.path),r=Qu(e.unknownDocument.version),Qi.newUnknownDocument(n,r)):Yr()}function Ku(t,e,n){var r=Gu(n);if(n=e.key.path.popLast().toArray(),e.isFoundDocument()){var i={name:_a(o=t.Lt,(s=e).key),fields:s.data.value.mapValue.fields,updateTime:wa(o,s.version.toTimestamp())},o=e.hasCommittedMutations;return new eu(null,null,i,o,r,n)}if(e.isNoDocument()){var s=e.key.path.toArray();return i=zu(e.version),o=e.hasCommittedMutations,new eu(null,new Za(s,i),null,o,r,n)}return e.isUnknownDocument()?(o=e.key.path.toArray(),e=zu(e.version),new eu(new tu(o,e),null,null,!0,r,n)):Yr()}function Gu(t){return[(t=t.toTimestamp()).seconds,t.nanoseconds]}function Hu(t){return t=new ni(t[0],t[1]),ri.fromTimestamp(t)}function zu(t){return t=t.toTimestamp(),new Wa(t.seconds,t.nanoseconds)}function Qu(t){return t=new ni(t.seconds,t.nanoseconds),ri.fromTimestamp(t)}function Wu(t,e){for(var n=(e.baseMutations||[]).map((function(e){return Oa(t.Lt,e)})),r=0;r<e.mutations.length-1;++r){var i,o=e.mutations[r];r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(i=e.mutations[r+1],o.updateTransforms=i.transform.fieldTransforms,e.mutations.splice(r+1,1),++r)}var s=e.mutations.map((function(e){return Oa(t.Lt,e)})),a=ni.fromMillis(e.localWriteTimeMs);return new Pu(e.batchId,a,n,s)}function Yu(t){var e=Qu(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?Qu(t.lastLimboFreeSnapshotVersion):ri.min(),r=void 0!==t.query.documents?(Xr(1===(r=t.query).documents.length),qo(Oo(Da(r.documents[0])))):qo(Ma(t.query));return new Fu(r,t.targetId,0,t.lastListenSequenceNumber,e,n,yi.fromBase64String(t.resumeToken))}function Xu(t,e){var n=zu(e.snapshotVersion),r=zu(e.lastLimboFreeSnapshotVersion),i=(Zi(e.target)?La:Pa)(t.Lt,e.target);return t=e.resumeToken.toBase64(),new ru(e.targetId,$i(e.target),n,t,e.sequenceNumber,r,i)}function $u(t){var e=Ma({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Bo(e,e.limit,"L"):e}var Ju=(Zu.prototype.getBundleMetadata=function(t,e){return tc(t).get(e).next((function(t){if(t)return{id:(t=t).bundleId,createTime:Qu(t.createTime),version:t.version}}))},Zu.prototype.saveBundleMetadata=function(t,e){return tc(t).put({bundleId:(e=e).id,createTime:zu(Ea(e.createTime)),version:e.version})},Zu.prototype.getNamedQuery=function(t,e){return ec(t).get(e).next((function(t){if(t)return{name:(t=t).name,query:$u(t.bundledQuery),readTime:Qu(t.readTime)}}))},Zu.prototype.saveNamedQuery=function(t,e){return ec(t).put({name:(e=e).name,readTime:zu(Ea(e.readTime)),bundledQuery:e.bundledQuery})},Zu);function Zu(){}function tc(t){return Lu(t,uu.store)}function ec(t){return Lu(t,cu.store)}var nc=(ac.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),pu.resolve()},ac.prototype.getCollectionParents=function(t,e){return pu.resolve(this.Bt.getEntries(e))},ac),rc=(sc.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Qs(li.comparator);return t=!r.has(n),this.index[e]=r.add(n),t},sc.prototype.has=function(t){var e=t.lastSegment();return t=t.popLast(),(e=this.index[e])&&e.has(t)},sc.prototype.getEntries=function(t){return(this.index[t]||new Qs(li.comparator)).toArray()},sc),ic=(oc.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(this.qt.has(e))return pu.resolve();var r=e.lastSegment(),i=e.popLast();return t.addOnCommittedListener((function(){n.qt.add(e)})),i={collectionId:r,parent:Ga(i)},uc(t).put(i)},oc.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[ei(e),""],!1,!0);return uc(t).Nt(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(za(o.parent))}return n}))},oc);function oc(){this.qt=new rc}function sc(){this.index={}}function ac(){this.Bt=new rc}function uc(t){return Lu(t,su.store)}var cc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},hc=(lc.withCacheSize=function(t){return new lc(t,lc.DEFAULT_COLLECTION_PERCENTILE,lc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},lc);function lc(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}function fc(t,e,n){var r=t.store(Xa.store),i=t.store($a.store),o=[],s=(t=IDBKeyRange.only(n.batchId),0);t=r.$t({range:t},(function(t,e,n){return s++,n.delete()})),o.push(t.next((function(){Xr(1===s)})));for(var a=[],u=0,c=n.mutations;u<c.length;u++){var h=c[u],l=$a.key(e,h.key.path,n.batchId);o.push(i.delete(l)),a.push(h.key)}return pu.waitFor(o).next((function(){return a}))}function dc(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Yr();e=t.noDocument}return JSON.stringify(e).length}hc.DEFAULT_COLLECTION_PERCENTILE=10,hc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,hc.DEFAULT=new hc(41943040,hc.DEFAULT_COLLECTION_PERCENTILE,hc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),hc.DISABLED=new hc(-1,0,0);var pc=(yc.Kt=function(t,e,n,r){return Xr(""!==t.uid),new yc(t.isAuthenticated()?t.uid:"",e,n,r)},yc.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return mc(t).$t({index:Xa.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},yc.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=vc(t),s=mc(t);return s.add({}).next((function(a){Xr("number"==typeof a);for(var u,c,h,l,f,d=new Pu(a,e,n,r),p=(u=i.R,c=i.userId,l=(h=d).baseMutations.map((function(t){return xa(u.Lt,t)})),f=h.mutations.map((function(t){return xa(u.Lt,t)})),new Xa(c,h.batchId,h.localWriteTime.toMillis(),l,f)),y=[],g=new Qs((function(t,e){return Zr(t.canonicalString(),e.canonicalString())})),m=0,v=r;m<v.length;m++){var w=v[m],b=$a.key(i.userId,w.key.path,a);g=g.add(w.key.path.popLast()),y.push(s.put(p)),y.push(o.put(b,$a.PLACEHOLDER))}return g.forEach((function(e){y.push(i.Ut.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.Qt[a]=d.keys()})),pu.waitFor(y).next((function(){return d}))}))},yc.prototype.lookupMutationBatch=function(t,e){var n=this;return mc(t).get(e).next((function(t){return t?(Xr(t.userId===n.userId),Wu(n.R,t)):null}))},yc.prototype.jt=function(t,e){var n=this;return this.Qt[e]?pu.resolve(this.Qt[e]):this.lookupMutationBatch(t,e).next((function(t){return t?(t=t.keys(),n.Qt[e]=t):null}))},yc.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=(e=IDBKeyRange.lowerBound([this.userId,r]),null);return mc(t).$t({index:Xa.userMutationsIndex,range:e},(function(t,e,o){e.userId===n.userId&&(Xr(e.batchId>=r),i=Wu(n.R,e)),o.done()})).next((function(){return i}))},yc.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return mc(t).$t({index:Xa.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},yc.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return mc(t).Nt(Xa.userMutationsIndex,n).next((function(t){return t.map((function(t){return Wu(e.R,t)}))}))},yc.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=$a.prefixForPath(this.userId,e.path),i=(r=IDBKeyRange.lowerBound(r),[]);return vc(t).$t({range:r},(function(r,o,s){var a=r[0],u=r[1];if(r=r[2],u=za(u),a===n.userId&&e.path.isEqual(u))return mc(t).get(r).next((function(t){if(!t)throw Yr();Xr(t.userId===n.userId),i.push(Wu(n.R,t))}));s.done()})).next((function(){return i}))},yc.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Qs(Zr),i=[];return e.forEach((function(e){var o=$a.prefixForPath(n.userId,e.path);o=IDBKeyRange.lowerBound(o),o=vc(t).$t({range:o},(function(t,i,o){var s=t[0],a=t[1];t=t[2],a=za(a),s===n.userId&&e.path.isEqual(a)?r=r.add(t):o.done()})),i.push(o)})),pu.waitFor(i).next((function(){return n.Wt(t,r)}))},yc.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=(e=$a.prefixForPath(this.userId,r),e=IDBKeyRange.lowerBound(e),new Qs(Zr));return vc(t).$t({range:e},(function(t,e,s){var a=t[0],u=t[1];t=t[2],u=za(u),a===n.userId&&r.isPrefixOf(u)?u.length===i&&(o=o.add(t)):s.done()})).next((function(){return n.Wt(t,o)}))},yc.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(mc(t).get(e).next((function(t){if(null===t)throw Yr();Xr(t.userId===n.userId),r.push(Wu(n.R,t))})))})),pu.waitFor(i).next((function(){return r}))},yc.prototype.removeMutationBatch=function(t,e){var n=this;return fc(t.Mt,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.Gt(e.batchId)})),pu.forEach(r,(function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)}))}))},yc.prototype.Gt=function(t){delete this.Qt[t]},yc.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return pu.resolve();n=IDBKeyRange.lowerBound($a.prefixForUser(e.userId));var r=[];return vc(t).$t({range:n},(function(t,n,i){t[0]===e.userId?(t=za(t[1]),r.push(t)):i.done()})).next((function(){Xr(0===r.length)}))}))},yc.prototype.containsKey=function(t,e){return gc(t,this.userId,e)},yc.prototype.zt=function(t){var e=this;return wc(t).get(this.userId).next((function(t){return t||new Ya(e.userId,-1,"")}))},yc);function yc(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Qt={}}function gc(t,e,n){var r=(n=$a.prefixForPath(e,n.path))[1],i=(n=IDBKeyRange.lowerBound(n),!1);return vc(t).$t({range:n,kt:!0},(function(t,n,o){var s=t[0],a=t[1];t[2],s===e&&a===r&&(i=!0),o.done()})).next((function(){return i}))}function mc(t){return Lu(t,Xa.store)}function vc(t){return Lu(t,$a.store)}function wc(t){return Lu(t,Ya.store)}var bc=(Ic.prototype.next=function(){return this.Ht+=2,this.Ht},Ic.Jt=function(){return new Ic(0)},Ic.Yt=function(){return new Ic(-1)},Ic),Ec=(Tc.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next((function(n){var r=new bc(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next((function(){return n.highestTargetId}))}))},Tc.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next((function(t){return ri.fromTimestamp(new ni(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},Tc.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next((function(t){return t.highestListenSequenceNumber}))},Tc.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)}))},Tc.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next((function(){return n.Xt(t).next((function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)}))}))},Tc.prototype.updateTargetData=function(t,e){return this.te(t,e)},Tc.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return _c(t).delete(e.targetId)})).next((function(){return n.Xt(t)})).next((function(e){return Xr(0<e.targetCount),--e.targetCount,n.Zt(t,e)}))},Tc.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return _c(t).$t((function(s,a){(a=Yu(a)).sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r.removeTargetData(t,a)))})).next((function(){return pu.waitFor(o)})).next((function(){return i}))},Tc.prototype.forEachTarget=function(t,e){return _c(t).$t((function(t,n){n=Yu(n),e(n)}))},Tc.prototype.Xt=function(t){return Sc(t).get(ou.key).next((function(t){return Xr(null!==t),t}))},Tc.prototype.Zt=function(t,e){return Sc(t).put(ou.key,e)},Tc.prototype.te=function(t,e){return _c(t).put(Xu(this.R,e))},Tc.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Tc.prototype.getTargetCount=function(t){return this.Xt(t).next((function(t){return t.targetCount}))},Tc.prototype.getTargetData=function(t,e){var n=$i(e),r=(n=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),null);return _c(t).$t({range:n,index:ru.queryTargetsIndexName},(function(t,n,i){n=Yu(n),Ji(e,n.target)&&(r=n,i.done())})).next((function(){return r}))},Tc.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Ac(t);return e.forEach((function(e){var s=Ga(e.path);i.push(o.put(new iu(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))})),pu.waitFor(i)},Tc.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Ac(t);return pu.forEach(e,(function(e){var o=Ga(e.path);return pu.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])}))},Tc.prototype.removeMatchingKeysForTargetId=function(t,e){return t=Ac(t),e=IDBKeyRange.bound([e],[e+1],!1,!0),t.delete(e)},Tc.prototype.getMatchingKeysForTargetId=function(t,e){e=IDBKeyRange.bound([e],[e+1],!1,!0),t=Ac(t);var n=ea();return t.$t({range:e,kt:!0},(function(t,e,r){t=za(t[1]),t=new ki(t),n=n.add(t)})).next((function(){return n}))},Tc.prototype.containsKey=function(t,e){e=Ga(e.path),e=IDBKeyRange.bound([e],[ei(e)],!1,!0);var n=0;return Ac(t).$t({index:iu.documentTargetsIndex,kt:!0,range:e},(function(t,e,r){var i=t[0];t[1],0!==i&&(n++,r.done())})).next((function(){return 0<n}))},Tc.prototype.lt=function(t,e){return _c(t).get(e).next((function(t){return t?Yu(t):null}))},Tc);function Tc(t,e){this.referenceDelegate=t,this.R=e}function Ic(t){this.Ht=t}function _c(t){return Lu(t,ru.store)}function Sc(t){return Lu(t,ou.store)}function Ac(t){return Lu(t,iu.store)}function Dc(t){return u(this,void 0,void 0,(function(){return c(this,(function(e){if(t.code!==qr.FAILED_PRECONDITION||t.message!==fu)throw t;return Hr("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}function Nc(t,e){var n=t[0],r=t[1];return t=e[0],e=e[1],0===(t=Zr(n,t))?Zr(r,e):t}var Cc=(Mc.prototype.ie=function(){return++this.se},Mc.prototype.re=function(t){var e=[t,this.ie()];this.buffer.size<this.ne?this.buffer=this.buffer.add(e):Nc(e,t=this.buffer.last())<0&&(this.buffer=this.buffer.delete(t).add(e))},Object.defineProperty(Mc.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),Mc),kc=(Pc.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},Pc.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(Pc.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),Pc.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;Hr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(function(){return u(e,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return Su(e=n.sent())?(Hr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Dc(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}}))}))}))},Pc),Rc=(Lc.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next((function(t){return Math.floor(e/100*t)}))},Lc.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return pu.resolve(Fr.o);var r=new Cc(e);return this.ae.forEachTarget(t,(function(t){return r.re(t.sequenceNumber)})).next((function(){return n.ae.le(t,(function(t){return r.re(t)}))})).next((function(){return r.maxValue}))},Lc.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},Lc.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},Lc.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Hr("LruGarbageCollector","Garbage collection skipped; disabled"),pu.resolve(cc)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(Hr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),cc):n.fe(t,e)}))},Lc.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},Lc.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return r=e>c.params.maximumSequenceNumbersToCollect?(Hr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),c.params.maximumSequenceNumbersToCollect):e,o=Date.now(),c.nthSequenceNumber(t,r)})).next((function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)})).next((function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)})).next((function(t){return u=Date.now(),Gr()<=w.DEBUG&&Hr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),pu.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})}))},Lc),xc=(Oc.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},Oc.prototype.de=function(t){var e=0;return this.le(t,(function(t){e++})).next((function(){return e}))},Oc.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},Oc.prototype.le=function(t,e){return this.we(t,(function(t,n){return e(n)}))},Oc.prototype.addReference=function(t,e,n){return Fc(t,n)},Oc.prototype.removeReference=function(t,e,n){return Fc(t,n)},Oc.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},Oc.prototype.markPotentiallyOrphaned=Fc,Oc.prototype._e=function(t,e){return r=e,i=!1,wc(n=t).Ot((function(t){return gc(n,t,r).next((function(t){return t&&(i=!0),pu.resolve(!t)}))})).next((function(){return i}));var n,r,i},Oc.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,(function(s,a){a<=e&&(a=n._e(t,s).next((function(e){if(!e)return o++,r.getEntry(t,s).next((function(){return r.removeEntry(s),Ac(t).delete([0,Ga(s.path)])}))})),i.push(a))})).next((function(){return pu.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},Oc.prototype.removeTarget=function(t,e){return e=e.withSequenceNumber(t.currentSequenceNumber),this.db.getTargetCache().updateTargetData(t,e)},Oc.prototype.updateLimboDocument=Fc,Oc.prototype.we=function(t,e){t=Ac(t);var n,r=Fr.o;return t.$t({index:iu.documentTargetsIndex},(function(t,i){var o=t[0];t[1],t=i.path,i=i.sequenceNumber,0===o?(r!==Fr.o&&e(new ki(za(n)),r),r=i,n=t):r=Fr.o})).next((function(){r!==Fr.o&&e(new ki(za(n)),r)}))},Oc.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},Oc);function Oc(t,e){this.db=t,this.garbageCollector=new Rc(this,e)}function Lc(t,e){this.ae=t,this.params=e}function Pc(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}function Mc(t){this.ne=t,this.buffer=new Qs(Nc),this.se=0}function Fc(t,e){return Ac(t).put((t=t.currentSequenceNumber,new iu(0,Ga(e.path),t)))}var Vc,Uc=(Hc.prototype.get=function(t){var e=this.mapKeyFn(t);if(void 0!==(e=this.inner[e]))for(var n=0,r=e;n<r.length;n++){var i=(o=r[n])[0],o=o[1];if(this.equalsFn(i,t))return o}},Hc.prototype.has=function(t){return void 0!==this.get(t)},Hc.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},Hc.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},Hc.prototype.forEach=function(t){ai(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=(s=i[r])[0],s=s[1];t(o,s)}}))},Hc.prototype.isEmpty=function(){return ui(this.inner)},Hc),qc=(Gc.prototype.getReadTime=function(t){return(t=this.changes.get(t))?t.readTime:ri.min()},Gc.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},Gc.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:Qi.newInvalidDocument(t),readTime:e})},Gc.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?pu.resolve(n.document):this.getFromCache(t,e)},Gc.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},Gc.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},Gc.prototype.assertNotApplied=function(){},A=Gc,Kc.prototype.addEntry=function(t,e,n){return Qc(t).put(Wc(e),n)},Kc.prototype.removeEntry=function(t,e){return t=Qc(t),e=Wc(e),t.delete(e)},Kc.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.me(t,r)}))},Kc.prototype.getEntry=function(t,e){var n=this;return Qc(t).get(Wc(e)).next((function(t){return n.ye(e,t)}))},Kc.prototype.ge=function(t,e){var n=this;return Qc(t).get(Wc(e)).next((function(t){return{document:n.ye(e,t),size:dc(t)}}))},Kc.prototype.getEntries=function(t,e){var n=this,r=Ys;return this.pe(t,e,(function(t,e){e=n.ye(t,e),r=r.insert(t,e)})).next((function(){return r}))},Kc.prototype.Ee=function(t,e){var n=this,r=Ys,i=new qs(ki.comparator);return this.pe(t,e,(function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,dc(e))})).next((function(){return{documents:r,Te:i}}))},Kc.prototype.pe=function(t,e,n){if(e.isEmpty())return pu.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Qc(t).$t({range:r},(function(t,e,r){for(var s=ki.fromSegments(t);o&&ki.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},Kc.prototype.getDocumentsMatchingQuery=function(t,e,n){var r,i=this,o=Ys,s=e.path.length+1,a={};return n.isEqual(ri.min())?(r=e.path.toArray(),a.range=IDBKeyRange.lowerBound(r)):(r=e.path.toArray(),n=Gu(n),a.range=IDBKeyRange.lowerBound([r,n],!0),a.index=eu.collectionReadTimeIndex),Qc(t).$t(a,(function(t,n,r){t.length===s&&(n=ju(i.R,n),e.path.isPrefixOf(n.key.path)?Ho(e,n)&&(o=o.insert(n.key,n)):r.done())})).next((function(){return o}))},Kc.prototype.newChangeBuffer=function(t){return new Bc(this,!!t&&t.trackRemovals)},Kc.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},Kc.prototype.getMetadata=function(t){return zc(t).get(nu.key).next((function(t){return Xr(!!t),t}))},Kc.prototype.me=function(t,e){return zc(t).put(nu.key,e)},Kc.prototype.ye=function(t,e){return!e||(e=ju(this.R,e)).isNoDocument()&&e.version.isEqual(ri.min())?Qi.newInvalidDocument(t):e},Kc),Bc=(s(jc,Vc=A),jc.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Qs((function(t,e){return Zr(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,s){var a,u=e.Ae.get(o);s.document.isValidDocument()?(a=Ku(e.Ie.R,s.document,e.getReadTime(o)),i=i.add(o.path.popLast()),s=dc(a),r+=s-u,n.push(e.Ie.addEntry(t,o,a))):(r-=u,e.trackRemovals?(u=Ku(e.Ie.R,Qi.newNoDocument(o,ri.min()),e.getReadTime(o)),n.push(e.Ie.addEntry(t,o,u))):n.push(e.Ie.removeEntry(t,o)))})),i.forEach((function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))})),n.push(this.Ie.updateMetadata(t,r)),pu.waitFor(n)},jc.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next((function(t){return n.Ae.set(e,t.size),t.document}))},jc.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next((function(t){var e=t.documents;return t.Te.forEach((function(t,e){n.Ae.set(t,e)})),e}))},jc);function jc(t,e){var n=this;return(n=Vc.call(this)||this).Ie=t,n.trackRemovals=e,n.Ae=new Uc((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),n}function Kc(t,e){this.R=t,this.Ut=e}function Gc(){this.changes=new Uc((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.changesApplied=!1}function Hc(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}function zc(t){return Lu(t,nu.store)}function Qc(t){return Lu(t,eu.store)}function Wc(t){return t.path.toArray()}var Yc=(Xc.prototype.Rt=function(t,e,n,r){var i=this;Xr(n<r&&0<=n&&r<=11);var o=new yu("createOrUpgrade",e);n<1&&1<=r&&(t.createObjectStore(Qa.store),(s=t).createObjectStore(Ya.store,{keyPath:Ya.keyPath}),s.createObjectStore(Xa.store,{keyPath:Xa.keyPath,autoIncrement:!0}).createIndex(Xa.userMutationsIndex,Xa.userMutationsKeyPath,{unique:!0}),s.createObjectStore($a.store),$c(t),t.createObjectStore(eu.store));var s,a=pu.resolve();return n<3&&3<=r&&(0!==n&&((s=t).deleteObjectStore(iu.store),s.deleteObjectStore(ru.store),s.deleteObjectStore(ou.store),$c(t)),a=a.next((function(){return t=o.store(ou.store),e=new ou(0,0,ri.min().toTimestamp(),0),t.put(ou.key,e);var t,e}))),n<4&&4<=r&&(a=(a=0!==n?a.next((function(){return e=t,(n=o).store(Xa.store).Nt().next((function(t){e.deleteObjectStore(Xa.store),e.createObjectStore(Xa.store,{keyPath:Xa.keyPath,autoIncrement:!0}).createIndex(Xa.userMutationsIndex,Xa.userMutationsKeyPath,{unique:!0});var r=n.store(Xa.store);return t=t.map((function(t){return r.put(t)})),pu.waitFor(t)}));var e,n})):a).next((function(){t.createObjectStore(au.store,{keyPath:au.keyPath})}))),n<5&&5<=r&&(a=a.next((function(){return i.Re(o)}))),n<6&&6<=r&&(a=a.next((function(){return t.createObjectStore(nu.store),i.be(o)}))),n<7&&7<=r&&(a=a.next((function(){return i.ve(o)}))),n<8&&8<=r&&(a=a.next((function(){return i.Pe(t,o)}))),n<9&&9<=r&&(a=a.next((function(){var n;(n=t).objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges"),(n=e.objectStore(eu.store)).createIndex(eu.readTimeIndex,eu.readTimeIndexPath,{unique:!1}),n.createIndex(eu.collectionReadTimeIndex,eu.collectionReadTimeIndexPath,{unique:!1})}))),n<10&&10<=r&&(a=a.next((function(){return i.Ve(o)}))),n<11&&11<=r?a.next((function(){t.createObjectStore(uu.store,{keyPath:uu.keyPath}),t.createObjectStore(cu.store,{keyPath:cu.keyPath})})):a},Xc.prototype.be=function(t){var e=0;return t.store(eu.store).$t((function(t,n){e+=dc(n)})).next((function(){var n=new nu(e);return t.store(nu.store).put(nu.key,n)}))},Xc.prototype.Re=function(t){var e=this,n=t.store(Ya.store),r=t.store(Xa.store);return n.Nt().next((function(n){return pu.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(Xa.userMutationsIndex,i).next((function(r){return pu.forEach(r,(function(r){return Xr(r.userId===n.userId),r=Wu(e.R,r),fc(t,n.userId,r).next((function(){}))}))}))}))}))},Xc.prototype.ve=function(t){var e=t.store(iu.store),n=t.store(eu.store);return t.store(ou.store).get(ou.key).next((function(t){var r=[];return n.$t((function(n,i){var o=new li(n);n=[0,Ga(o)],r.push(e.get(n).next((function(n){return n?pu.resolve():e.put(new iu(0,Ga(o),t.highestListenSequenceNumber))})))})).next((function(){return pu.waitFor(r)}))}))},Xc.prototype.Pe=function(t,e){function n(t){if(i.add(t)){var e=t.lastSegment();return t=t.popLast(),r.put({collectionId:e,parent:Ga(t)})}}t.createObjectStore(su.store,{keyPath:su.keyPath});var r=e.store(su.store),i=new rc;return e.store(eu.store).$t({kt:!0},(function(t,e){return n((t=new li(t)).popLast())})).next((function(){return e.store($a.store).$t({kt:!0},(function(t,e){t[0];var r=t[1];return n((t[2],r=za(r)).popLast())}))}))},Xc.prototype.Ve=function(t){var e=this,n=t.store(ru.store);return n.$t((function(t,r){return r=Yu(r),r=Xu(e.R,r),n.put(r)}))},Xc);function Xc(t){this.R=t}function $c(t){t.createObjectStore(iu.store,{keyPath:iu.keyPath}).createIndex(iu.documentTargetsIndex,iu.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(ru.store,{keyPath:ru.keyPath}).createIndex(ru.queryTargetsIndexName,ru.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(ou.store)}var Jc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Zc=(th.prototype.start=function(){var t=this;return this.je().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Br(qr.FAILED_PRECONDITION,Jc);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.qe.getHighestSequenceNumber(e)}))})).then((function(e){t.Ne=new Fr(e,t.De)})).then((function(){t.xe=!0})).catch((function(e){return t.Be&&t.Be.close(),Promise.reject(e)}))},th.prototype.He=function(t){var e=this;return this.Me=function(n){return u(e,void 0,void 0,(function(){return c(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},th.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt((function(n){return u(e,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},th.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((function(){return u(e,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},th.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return nh(e).put(new au(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Je(e).next((function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable((function(){return t.Me(!1)})))}))})).next((function(){return t.Ye(e)})).next((function(n){return t.isPrimary&&!n?t.Xe(e).next((function(){return!1})):!!n&&t.Ze(e).next((function(){return!0}))}))})).catch((function(e){if(Su(e))return Hr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Hr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Se.enqueueRetryable((function(){return t.Me(e)})),t.isPrimary=e}))},th.prototype.Je=function(t){var e=this;return eh(t).get(Qa.key).next((function(t){return pu.resolve(e.tn(t))}))},th.prototype.en=function(t){return nh(t).delete(this.clientId)},th.prototype.nn=function(){return u(this,void 0,void 0,(function(){var t,e,n,r,i=this;return c(this,(function(o){switch(o.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=Lu(t,au.store);return e.Nt().next((function(t){var n=i.rn(t,18e5),r=t.filter((function(t){return-1===n.indexOf(t)}));return pu.forEach(r,(function(t){return e.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(t=o.sent(),this.Ke)for(e=0,n=t;e<n.length;e++)r=n[e],this.Ke.removeItem(this.on(r.clientId));o.label=2;case 2:return[2]}}))}))},th.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.je().then((function(){return t.nn()})).then((function(){return t.ze()}))}))},th.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},th.prototype.Ye=function(t){var e=this;return this.Ce?pu.resolve(!0):eh(t).get(Qa.key).next((function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new Br(qr.FAILED_PRECONDITION,Jc);return!1}}return!(!e.networkEnabled||!e.inForeground)||nh(t).Nt().next((function(t){return void 0===e.rn(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground;if(t=e.networkEnabled===t.networkEnabled,n||r&&t)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&Hr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},th.prototype.shutdown=function(){return u(this,void 0,void 0,(function(){var t=this;return c(this,(function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Qa.store,au.store],(function(e){var n=new xu(e,Fr.o);return t.Xe(n).next((function(){return t.en(n)}))}))];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}}))}))},th.prototype.rn=function(t,e){var n=this;return t.filter((function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)}))},th.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return nh(e).Nt().next((function(e){return t.rn(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(th.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),th.prototype.getMutationQueue=function(t){return pc.Kt(t,this.R,this.Ut,this.referenceDelegate)},th.prototype.getTargetCache=function(){return this.qe},th.prototype.getRemoteDocumentCache=function(){return this.Ue},th.prototype.getIndexManager=function(){return this.Ut},th.prototype.getBundleCache=function(){return this.Qe},th.prototype.runTransaction=function(t,e,n){var r,i=this;return Hr("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",lu,(function(o){return r=new xu(o,i.Ne?i.Ne.next():Fr.o),"readwrite-primary"===e?i.Je(r).next((function(t){return!!t||i.Ye(r)})).next((function(e){if(!e)throw zr("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable((function(){return i.Me(!1)})),new Br(qr.FAILED_PRECONDITION,fu);return n(r)})).next((function(t){return i.Ze(r).next((function(){return t}))})):i.dn(r).next((function(){return n(r)}))})).then((function(t){return r.raiseOnCommittedEvent(),t}))},th.prototype.dn=function(t){var e=this;return eh(t).get(Qa.key).next((function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Br(qr.FAILED_PRECONDITION,Jc)}))},th.prototype.Ze=function(t){var e=new Qa(this.clientId,this.allowTabSynchronization,Date.now());return eh(t).put(Qa.key,e)},th.yt=function(){return gu.yt()},th.prototype.Xe=function(t){var e=this,n=eh(t);return n.get(Qa.key).next((function(t){return e.tn(t)?(Hr("IndexedDbPersistence","Releasing primary lease."),n.delete(Qa.key)):pu.resolve()}))},th.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(zr("Detected an update time that is in the future: "+t+" > "+n),1))},th.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.je()}))},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},th.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},th.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget((function(){return e.shutdown()}))},this.window.addEventListener("pagehide",this.Fe))},th.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("pagehide",this.Fe),this.Fe=null)},th.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Ke)||void 0===e?void 0:e.getItem(this.on(t)));return Hr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return zr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},th.prototype.un=function(){if(this.Ke)try{this.Ke.setItem(this.on(this.clientId),String(Date.now()))}catch(e){zr("Failed to set zombie client id.",e)}},th.prototype.ln=function(){if(this.Ke)try{this.Ke.removeItem(this.on(this.clientId))}catch(e){}},th.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},th);function th(t,e,n,r,i,o,s,a,u,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Se=i,this.window=o,this.document=s,this.De=u,this.Ce=c,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!th.yt())throw new Br(qr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new xc(this,r),this.Le=e+"main",this.R=new Vu(a),this.Be=new gu(this.Le,11,new Yc(this.R)),this.qe=new Ec(this.referenceDelegate,this.R),this.Ut=new ic,this.Ue=(e=this.R,a=this.Ut,new qc(e,a)),this.Qe=new Ju,this.window&&this.window.localStorage?this.Ke=this.window.localStorage:(this.Ke=null,!1===c&&zr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function eh(t){return Lu(t,Qa.store)}function nh(t){return Lu(t,au.store)}function rh(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}function ih(t,e){this.progress=t,this.wn=e}var oh=(fh.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.yn(t,e,r)}))},fh.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next((function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t}))},fh.prototype.gn=function(t,e){t.forEach((function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)}))},fh.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next((function(e){return n.En(t,e).next((function(){return e}))}))},fh.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(t){return n.gn(e,t)}))},fh.prototype.getDocumentsMatchingQuery=function(t,e,n){return r=e,ki.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Tn(t,e.path):Vo(e)?this.In(t,e,n):this.An(t,e,n);var r},fh.prototype.Tn=function(t,e){return this.mn(t,new ki(e)).next((function(t){var e=Js;return t.isFoundDocument()?e.insert(t.key,t):e}))},fh.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=Js;return this.Ut.getCollectionParents(t,i).next((function(s){return pu.forEach(s,(function(s){var a=(a=e,s=s.child(i),new Ro(s,null,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt));return r.An(t,a,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},fh.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return i=e,o.Rn(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=Qi.newInvalidDocument(c),r=r.insert(c,h)),vs(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}}))})).next((function(){return r.forEach((function(t,n){Ho(e,n)||(r=r.remove(t))})),r}))},fh.prototype.Rn=function(t,e,n){for(var r=ea(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof _s&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next((function(t){return t.forEach((function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))})),c}))},fh),sh=(lh.Pn=function(t,e){for(var n=ea(),r=ea(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new lh(t,e.fromCache,n,r)},lh),ah=(hh.prototype.Vn=function(t){this.Sn=t},hh.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())||n.isEqual(ri.min())?this.Dn(t,e):this.Sn.pn(t,r).next((function(o){var s=i.Cn(e,o);return(Lo(e)||Po(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(Gr()<=w.DEBUG&&Hr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Go(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next((function(t){return s.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},hh.prototype.Cn=function(t,e){var n=new Qs(zo(t));return e.forEach((function(e,r){Ho(t,r)&&(n=n.add(r))})),n},hh.prototype.Nn=function(t,e,n,r){return n.size!==e.size||!!(e="F"===t?e.last():e.first())&&(e.hasPendingWrites||0<e.version.compareTo(r))},hh.prototype.Dn=function(t,e){return Gr()<=w.DEBUG&&Hr("QueryEngine","Using full collection scan to execute query:",Go(e)),this.Sn.getDocumentsMatchingQuery(t,e,ri.min())},hh),uh=(ch.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.Fn)}))},ch);function ch(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new qs(Zr),this.kn=new Uc($i,Ji),this.$n=ri.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new oh(this.On,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}function hh(){}function lh(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}function fh(t,e,n){this.Ue=t,this._n=e,this.Ut=n}function dh(t,e,n,r){return new uh(t,e,n,r)}function ph(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o;return c(this,(function(s){switch(s.label){case 0:return r=(n=t)._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var o;return n._n.getAllMutationBatches(t).next((function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new oh(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)})).next((function(e){for(var n=[],r=[],s=ea(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];s=s.add(f.key)}}for(var d=0,p=e;d<p.length;d++){var y=p[d];r.push(y.batchId);for(var g=0,m=y.mutations;g<m.length;g++){var v=m[g];s=s.add(v.key)}}return i.pn(t,s).next((function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}}))}))}))];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}}))}))}function yh(t,e){var n=t;return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r,i,o,s,a,u,c,h=e.batch.keys(),l=n.On.newChangeBuffer({trackRemovals:!0});return r=n,i=t,s=l,u=(a=(o=e).batch).keys(),c=pu.resolve(),u.forEach((function(t){c=c.next((function(){return s.getEntry(i,t)})).next((function(e){var n=o.docVersions.get(t);Xr(null!==n),e.version.compareTo(n)<0&&(a.applyToRemoteDocument(e,o),e.isValidDocument()&&s.addEntry(e,o.commitVersion))}))})),c.next((function(){return r._n.removeMutationBatch(i,a)})).next((function(){return l.apply(t)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,h)}))}))}function gh(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.qe.getLastRemoteSnapshotVersion(t)}))}function mh(t,e){var n=t,r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach((function(e,o){var a,u,c,h=i.get(o);h&&(s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next((function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}))),0<(c=e.resumeToken).approximateByteSize()&&(a=h.withResumeToken(c,r).withSequenceNumber(t.currentSequenceNumber),i=i.insert(o,a),u=h,c=e,Xr(0<(h=a).resumeToken.approximateByteSize()),(0===u.resumeToken.approximateByteSize()||3e8<=h.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()||0<c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size)&&s.push(n.qe.updateTargetData(t,a))))}));var a,u=Ys;return e.documentUpdates.forEach((function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),s.push(vh(t,o,e.documentUpdates,r,void 0).next((function(t){u=t}))),r.isEqual(ri.min())||(a=n.qe.getLastRemoteSnapshotVersion(t).next((function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)})),s.push(a)),pu.waitFor(s).next((function(){return o.apply(t)})).next((function(){return n.Mn.En(t,u)})).next((function(){return u}))})).then((function(t){return n.Fn=i,t}))}function vh(t,e,n,r,i){var o=ea();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=Ys;return n.forEach((function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(ri.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||0<s.version.compareTo(a.version)||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):Hr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)})),o}))}function wh(t,e){var n=t;return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.qe.getTargetData(t,e).next((function(i){return i?(r=i,pu.resolve(r)):n.qe.allocateTargetId(t).next((function(i){return r=new Fu(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.Fn.get(t.targetId);return(null===r||0<t.snapshotVersion.compareTo(r.snapshotVersion))&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t}))}function bh(t,e,n){return u(this,void 0,void 0,(function(){var r,i,o;return c(this,(function(s){switch(s.label){case 0:i=(r=t).Fn.get(e),o=n?"readwrite":"readwrite-primary",s.label=1;case 1:return s.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,(function(t){return r.persistence.referenceDelegate.removeTarget(t,i)}))];case 2:s.sent(),s.label=3;case 3:return[3,5];case 4:if(!Su(o=s.sent()))throw o;return Hr("LocalStore","Failed to update sequence numbers for target "+e+": "+o),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}}))}))}function Eh(t,e,n){var r=t,i=ri.min(),o=ea();return r.persistence.runTransaction("Execute query","readonly",(function(t){return s=r,a=t,u=qo(e),(void 0!==(s=(c=s).kn.get(u))?pu.resolve(c.Fn.get(s)):c.qe.getTargetData(a,u)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:ri.min(),n?o:ea())})).next((function(t){return{documents:t,Bn:o}}));var s,a,u,c}))}function Th(t,e){var n=t,r=n.qe;return(t=n.Fn.get(e))?Promise.resolve(t.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.lt(t,e).next((function(t){return t?t.target:null}))}))}function Ih(t){var e=t;return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return n=e.On,r=t,t=e.$n,i=n,o=Ys,s=Gu(t),t=Qc(r),r=IDBKeyRange.lowerBound(s,!0),t.$t({index:eu.readTimeIndex,range:r},(function(t,e){var n=ju(i.R,e);o=o.insert(n.key,n),s=e.readTime})).next((function(){return{wn:o,readTime:Hu(s)}}));var n,r,i,o,s})).then((function(t){var n=t.wn;return t=t.readTime,e.$n=t,n}))}function _h(t){return u(this,void 0,void 0,(function(){var e;return c(this,(function(n){return[2,(e=t).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return t=Qc(t),e=ri.min(),t.$t({index:eu.readTimeIndex,reverse:!0},(function(t,n,r){n.readTime&&(e=Hu(n.readTime)),r.done()})).next((function(){return e}));var e})).then((function(t){e.$n=t}))]}))}))}var Sh,Ah,Dh=(Wh.prototype.getBundleMetadata=function(t,e){return pu.resolve(this.Kn.get(e))},Wh.prototype.saveBundleMetadata=function(t,e){return this.Kn.set(e.id,{id:e.id,version:e.version,createTime:Ea(e.createTime)}),pu.resolve()},Wh.prototype.getNamedQuery=function(t,e){return pu.resolve(this.jn.get(e))},Wh.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,{name:(e=e).name,query:$u(e.bundledQuery),readTime:Ea(e.readTime)}),pu.resolve()},Wh),Nh=(Qh.prototype.isEmpty=function(){return this.Wn.isEmpty()},Qh.prototype.addReference=function(t,e){e=new Ch(t,e),this.Wn=this.Wn.add(e),this.zn=this.zn.add(e)},Qh.prototype.Jn=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},Qh.prototype.removeReference=function(t,e){this.Yn(new Ch(t,e))},Qh.prototype.Xn=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},Qh.prototype.Zn=function(t){var e=this,n=new ki(new li([])),r=new Ch(n,t),i=(t=new Ch(n,t+1),[]);return this.zn.forEachInRange([r,t],(function(t){e.Yn(t),i.push(t.key)})),i},Qh.prototype.ts=function(){var t=this;this.Wn.forEach((function(e){return t.Yn(e)}))},Qh.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},Qh.prototype.es=function(t){var e=new ki(new li([])),n=new Ch(e,t),r=(t=new Ch(e,t+1),ea());return this.zn.forEachInRange([n,t],(function(t){r=r.add(t.key)})),r},Qh.prototype.containsKey=function(t){var e=new Ch(t,0);return null!==(e=this.Wn.firstAfterOrEqual(e))&&t.isEqual(e.key)},Qh),Ch=(zh.Gn=function(t,e){return ki.comparator(t.key,e.key)||Zr(t.ns,e.ns)},zh.Hn=function(t,e){return Zr(t.ns,e.ns)||ki.comparator(t.key,e.key)},zh),kh=(Hh.prototype.checkEmpty=function(t){return pu.resolve(0===this._n.length)},Hh.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,0<this._n.length&&this._n[this._n.length-1],n=new Pu(i,e,n,r),this._n.push(n);for(var o=0,s=r;o<s.length;o++){var a=s[o];this.rs=this.rs.add(new Ch(a.key,i)),this.Ut.addToCollectionParentIndex(t,a.key.path.popLast())}return pu.resolve(n)},Hh.prototype.lookupMutationBatch=function(t,e){return pu.resolve(this.os(e))},Hh.prototype.getNextMutationBatchAfterBatchId=function(t,e){return e=(e=this.cs(e+1))<0?0:e,pu.resolve(this._n.length>e?this._n[e]:null)},Hh.prototype.getHighestUnacknowledgedBatchId=function(){return pu.resolve(0===this._n.length?-1:this.ss-1)},Hh.prototype.getAllMutationBatches=function(t){return pu.resolve(this._n.slice())},Hh.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Ch(e,0),i=(e=new Ch(e,Number.POSITIVE_INFINITY),[]);return this.rs.forEachInRange([r,e],(function(t){t=n.os(t.ns),i.push(t)})),pu.resolve(i)},Hh.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Qs(Zr);return e.forEach((function(t){var e=new Ch(t,0);t=new Ch(t,Number.POSITIVE_INFINITY),n.rs.forEachInRange([e,t],(function(t){r=r.add(t.ns)}))})),pu.resolve(this.us(r))},Hh.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1;e=n,ki.isDocumentKey(e)||(e=e.child("")),e=new Ch(new ki(e),0);var i=new Qs(Zr);return this.rs.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(i=i.add(t.ns)),!0)}),e),pu.resolve(this.us(i))},Hh.prototype.us=function(t){var e=this,n=[];return t.forEach((function(t){null!==(t=e.os(t))&&n.push(t)})),n},Hh.prototype.removeMutationBatch=function(t,e){var n=this;Xr(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return pu.forEach(e.mutations,(function(i){var o=new Ch(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((function(){n.rs=r}))},Hh.prototype.Gt=function(t){},Hh.prototype.containsKey=function(t,e){var n=new Ch(e,0);return n=this.rs.firstAfterOrEqual(n),pu.resolve(e.isEqual(n&&n.key))},Hh.prototype.performConsistencyCheck=function(t){return this._n.length,pu.resolve()},Hh.prototype.hs=function(t,e){return this.cs(t)},Hh.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},Hh.prototype.os=function(t){return(t=this.cs(t))<0||t>=this._n.length?null:this._n[t]},Hh),Rh=(Gh.prototype.addEntry=function(t,e,n){var r=e.key,i=(o=this.docs.get(r))?o.size:0,o=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:o,readTime:n}),this.size+=o-i,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},Gh.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Gh.prototype.getEntry=function(t,e){var n=this.docs.get(e);return pu.resolve(n?n.document.clone():Qi.newInvalidDocument(e))},Gh.prototype.getEntries=function(t,e){var n=this,r=Ys;return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():Qi.newInvalidDocument(t))})),pu.resolve(r)},Gh.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Ys,i=new ki(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=(a=o.getNext()).key,a=(u=a.value).document,u=u.readTime;if(!e.path.isPrefixOf(s.path))break;u.compareTo(n)<=0||Ho(e,a)&&(r=r.insert(a.key,a.clone()))}return pu.resolve(r)},Gh.prototype.fs=function(t,e){return pu.forEach(this.docs,(function(t){return e(t)}))},Gh.prototype.newChangeBuffer=function(t){return new xh(this)},Gh.prototype.getSize=function(t){return pu.resolve(this.size)},Gh),xh=(s(Kh,Ah=A),Kh.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)})),pu.waitFor(n)},Kh.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},Kh.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},Kh),Oh=(jh.prototype.forEachTarget=function(t,e){return this.ds.forEach((function(t,n){return e(n)})),pu.resolve()},jh.prototype.getLastRemoteSnapshotVersion=function(t){return pu.resolve(this.lastRemoteSnapshotVersion)},jh.prototype.getHighestSequenceNumber=function(t){return pu.resolve(this.ws)},jh.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),pu.resolve(this.highestTargetId)},jh.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),pu.resolve()},jh.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new bc(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},jh.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,pu.resolve()},jh.prototype.updateTargetData=function(t,e){return this.te(e),pu.resolve()},jh.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),--this.targetCount,pu.resolve()},jh.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)})),pu.waitFor(o).next((function(){return i}))},jh.prototype.getTargetCount=function(t){return pu.resolve(this.targetCount)},jh.prototype.getTargetData=function(t,e){return e=this.ds.get(e)||null,pu.resolve(e)},jh.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),pu.resolve()},jh.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.markPotentiallyOrphaned(t,e))})),pu.waitFor(i)},jh.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),pu.resolve()},jh.prototype.getMatchingKeysForTargetId=function(t,e){return e=this._s.es(e),pu.resolve(e)},jh.prototype.containsKey=function(t,e){return pu.resolve(this._s.containsKey(e))},jh),Lh=(Bh.prototype.start=function(){return Promise.resolve()},Bh.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(Bh.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),Bh.prototype.setDatabaseDeletedListener=function(){},Bh.prototype.setNetworkEnabled=function(){},Bh.prototype.getIndexManager=function(){return this.Ut},Bh.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new kh(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},Bh.prototype.getTargetCache=function(){return this.qe},Bh.prototype.getRemoteDocumentCache=function(){return this.Ue},Bh.prototype.getBundleCache=function(){return this.Qe},Bh.prototype.runTransaction=function(t,e,n){var r=this;Hr("MemoryPersistence","Starting transaction:",t);var i=new Ph(this.Ne.next());return this.referenceDelegate.Es(),n(i).next((function(t){return r.referenceDelegate.Ts(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},Bh.prototype.Is=function(t,e){return pu.or(Object.values(this.gs).map((function(n){return function(){return n.containsKey(t,e)}})))},Bh),Ph=(s(qh,Sh=R),qh),Mh=(Uh.bs=function(t){return new Uh(t)},Object.defineProperty(Uh.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Yr()},enumerable:!1,configurable:!0}),Uh.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),pu.resolve()},Uh.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),pu.resolve()},Uh.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),pu.resolve()},Uh.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach((function(t){return n.vs.add(t.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.vs.add(t.toString())}))})).next((function(){return r.removeTargetData(t,e)}))},Uh.prototype.Es=function(){this.Rs=new Set},Uh.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return pu.forEach(this.vs,(function(r){var i=ki.fromPath(r);return e.Ps(t,i).next((function(t){t||n.removeEntry(i)}))})).next((function(){return e.Rs=null,n.apply(t)}))},Uh.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next((function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())}))},Uh.prototype.ps=function(t){return 0},Uh.prototype.Ps=function(t,e){var n=this;return pu.or([function(){return pu.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},Uh),Fh=(Vh.prototype.isAuthenticated=function(){return null!=this.uid},Vh.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},Vh.prototype.isEqual=function(t){return t.uid===this.uid},Vh);function Vh(t){this.uid=t}function Uh(t){this.persistence=t,this.As=new Nh,this.Rs=null}function qh(t){var e=this;return(e=Sh.call(this)||this).currentSequenceNumber=t,e}function Bh(t,e){var n=this;this.gs={},this.Ne=new Fr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Oh(this),this.Ut=new nc,this.Ue=(t=this.Ut,new Rh(t,(function(t){return n.referenceDelegate.ps(t)}))),this.R=new Vu(e),this.Qe=new Dh(this.R)}function jh(t){this.persistence=t,this.ds=new Uc($i,Ji),this.lastRemoteSnapshotVersion=ri.min(),this.highestTargetId=0,this.ws=0,this._s=new Nh,this.targetCount=0,this.ys=bc.Jt()}function Kh(t){var e=this;return(e=Ah.call(this)||this).Ie=t,e}function Gh(t,e){this.Ut=t,this.ls=e,this.docs=new qs(ki.comparator),this.size=0}function Hh(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Qs(Ch.Gn)}function zh(t,e){this.key=t,this.ns=e}function Qh(){this.Wn=new Qs(Ch.Gn),this.zn=new Qs(Ch.Hn)}function Wh(t){this.R=t,this.Kn=new Map,this.jn=new Map}function Yh(t,e){return"firestore_clients_"+t+"_"+e}function Xh(t,e,n){return n="firestore_mutations_"+t+"_"+n,e.isAuthenticated()&&(n+="_"+e.uid),n}function $h(t,e){return"firestore_targets_"+t+"_"+e}Fh.UNAUTHENTICATED=new Fh(null),Fh.GOOGLE_CREDENTIALS=new Fh("google-credentials-uid"),Fh.FIRST_PARTY=new Fh("first-party-uid");var Jh,Zh=(Tl.Vs=function(t,e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Br(i.error.code,i.error.message)),o?new Tl(t,e,i.state,r):(zr("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},Tl.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Tl),tl=(El.Vs=function(t,e){var n,r=JSON.parse(e),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new Br(r.error.code,r.error.message)),i?new El(t,r.state,n):(zr("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},El.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},El),el=(bl.Vs=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=na,o=0;r&&o<n.activeTargetIds.length;++o)r=Ci(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new bl(t,i):(zr("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},bl),nl=(wl.Vs=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new wl(e.clientId,e.onlineState):(zr("SharedClientState","Failed to parse online state: "+t),null)},wl),rl=(vl.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},vl.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},vl.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},vl),il=(ml.yt=function(t){return!(!t||!t.localStorage)},ml.prototype.start=function(){return u(this,void 0,void 0,(function(){var t,e,n,r,i,o,s,a,u,h,l=this;return c(this,(function(c){switch(c.label){case 0:return[4,this.syncEngine.fn()];case 1:for(o=c.sent(),t=0,e=o;t<e.length;t++)(n=e[t])!==this.Ns&&(r=this.getItem(Yh(this.persistenceKey,n)))&&(i=el.Vs(n,r))&&(this.ks=this.ks.insert(i.clientId,i));for(this.Ks(),(o=this.storage.getItem(this.Us))&&(s=this.js(o))&&this.Ws(s),a=0,u=this.$s;a<u.length;a++)h=u[a],this.Fs(h);return this.$s=[],this.window.addEventListener("pagehide",(function(){return l.shutdown()})),this.started=!0,[2]}}))}))},ml.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},ml.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},ml.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},ml.prototype.addPendingMutation=function(t){this.zs(t,"pending")},ml.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},ml.prototype.addLocalQueryTarget=function(t){var e,n="not-current";return this.isActiveQueryTarget(t)&&(!(e=this.storage.getItem($h(this.persistenceKey,t)))||(e=tl.Vs(t,e))&&(n=e.state)),this.Js.Ds(t),this.Ks(),n},ml.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Ks()},ml.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},ml.prototype.clearQueryState=function(t){this.removeItem($h(this.persistenceKey,t))},ml.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},ml.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.Hs(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},ml.prototype.setOnlineState=function(t){this.Xs(t)},ml.prototype.notifyBundleLoaded=function(){this.Zs()},ml.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},ml.prototype.getItem=function(t){var e=this.storage.getItem(t);return Hr("SharedClientState","READ",t,e),e},ml.prototype.setItem=function(t,e){Hr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},ml.prototype.removeItem=function(t){Hr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},ml.prototype.Fs=function(t){var e=this,n=t;n.storageArea===this.storage&&(Hr("SharedClientState","EVENT",n.key,n.newValue),n.key!==this.Os?this.Se.enqueueRetryable((function(){return u(e,void 0,void 0,(function(){var t,e,r,i;return c(this,(function(o){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(t=this.ni(n.key,n.newValue))return[2,this.ei(t.clientId,t)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(e=this.si(n.key,n.newValue)))return[2,this.ii(e)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(r=this.ri(n.key,n.newValue)))return[2,this.oi(r)]}else if(n.key===this.Us){if(null!==n.newValue&&(i=this.js(n.newValue)))return[2,this.Ws(i)]}else if(n.key===this.Ms)(i=function(t){var e=Fr.o;if(null!=t)try{var n=JSON.parse(t);Xr("number"==typeof n),e=n}catch(t){zr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==Fr.o&&this.sequenceNumberHandler(i);else if(n.key===this.Qs)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]}))}))})):zr("Received WebStorage notification for local change. Another client might have garbage-collected our state"))},Object.defineProperty(ml.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),ml.prototype.Ks=function(){this.setItem(this.Os,this.Js.Ss())},ml.prototype.zs=function(t,e,n){n=new Zh(this.currentUser,t,e,n),t=Xh(this.persistenceKey,this.currentUser,t),this.setItem(t,n.Ss())},ml.prototype.Hs=function(t){t=Xh(this.persistenceKey,this.currentUser,t),this.removeItem(t)},ml.prototype.Xs=function(t){t={clientId:this.Ns,onlineState:t},this.storage.setItem(this.Us,JSON.stringify(t))},ml.prototype.Ys=function(t,e,n){var r=$h(this.persistenceKey,t);n=new tl(t,e,n),this.setItem(r,n.Ss())},ml.prototype.Zs=function(){this.setItem(this.Qs,"value-not-used")},ml.prototype.ti=function(t){return(t=this.Ls.exec(t))?t[1]:null},ml.prototype.ni=function(t,e){return t=this.ti(t),el.Vs(t,e)},ml.prototype.si=function(t,e){var n=this.Bs.exec(t);return t=Number(n[1]),n=void 0!==n[2]?n[2]:null,Zh.Vs(new Fh(n),t,e)},ml.prototype.ri=function(t,e){return t=this.qs.exec(t),t=Number(t[1]),tl.Vs(t,e)},ml.prototype.js=function(t){return nl.Vs(t)},ml.prototype.ii=function(t){return u(this,void 0,void 0,(function(){return c(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(Hr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},ml.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},ml.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||a.push(t)})),this.syncEngine.hi(s,a).then((function(){n.ks=r}))},ml.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},ml.prototype.Gs=function(t){var e=na;return t.forEach((function(t,n){e=e.unionWith(n.activeTargetIds)})),e},ml),ol=(gl.prototype.addPendingMutation=function(t){},gl.prototype.updateMutationState=function(t,e,n){},gl.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},gl.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},gl.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},gl.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},gl.prototype.clearQueryState=function(t){delete this.fi[t]},gl.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},gl.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},gl.prototype.start=function(){return this.li=new rl,Promise.resolve()},gl.prototype.handleUserChange=function(t,e,n){},gl.prototype.setOnlineState=function(t){},gl.prototype.shutdown=function(){},gl.prototype.writeSequenceNumber=function(t){},gl.prototype.notifyBundleLoaded=function(){},gl),sl=(yl.prototype.di=function(t){},yl.prototype.shutdown=function(){},yl),al=(pl.prototype.di=function(t){this.gi.push(t)},pl.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},pl.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},pl.prototype._i=function(){Hr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},pl.prototype.yi=function(){Hr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},pl.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},pl),ul={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},cl=(dl.prototype.Ii=function(t){this.Ai=t},dl.prototype.Ri=function(t){this.bi=t},dl.prototype.onMessage=function(t){this.vi=t},dl.prototype.close=function(){this.Ti()},dl.prototype.send=function(t){this.Ei(t)},dl.prototype.Pi=function(){this.Ai()},dl.prototype.Vi=function(t){this.bi(t)},dl.prototype.Si=function(t){this.vi(t)},dl),hl=(fl.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);return Hr("RestConnection","Sending: ",i,n),e={},this.Fi(e,r),this.ki(t,i,e,n).then((function(t){return Hr("RestConnection","Received: ",t),t}),(function(e){throw Qr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},fl.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},fl.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.6.8",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},fl.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+ul[t]},s(ll,Jh=fl),ll.prototype.ki=function(t,e,n,r){return new Promise((function(i,o){var s=new Mr;s.listenOnce(kr.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case Cr.NO_ERROR:var e=s.getResponseJson();Hr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Cr.TIMEOUT:Hr("Connection",'RPC "'+t+'" timed out'),o(new Br(qr.DEADLINE_EXCEEDED,"Request time out"));break;case Cr.HTTP_ERROR:var n,r,a=s.getStatus();Hr("Connection",'RPC "'+t+'" failed with status:',a,"response text:",s.getResponseText()),0<a?(n=s.getResponseJson().error)&&n.status&&n.message?(u=n.status.toLowerCase().replace(/_/g,"-"),r=0<=Object.values(qr).indexOf(u)?u:qr.UNKNOWN,o(new Br(r,n.message))):o(new Br(qr.UNKNOWN,"Server responded with status "+s.getStatus())):o(new Br(qr.UNAVAILABLE,"Connection failed."));break;default:Yr()}}finally{Hr("Connection",'RPC "'+t+'" completed.')}var u}));var a=JSON.stringify(r);s.send(e,"POST",a,n,15)}))},ll.prototype.Oi=function(t,e){var n,r=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new Ir,o=Nr();t={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},this.useFetchStreams&&(t.xmlHttpFactory=new Lr({})),this.Fi(t.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(f())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=f().indexOf("Electron/")||0<=(n=f()).indexOf("MSIE ")||0<=n.indexOf("Trident/")||0<=f().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(t.httpHeadersOverwriteParam="$httpHeaders"),Hr("Connection","Creating WebChannel: "+(r=r.join("")),t);var s=i.createWebChannel(r,t),a=!1,u=!1,c=new cl({Ei:function(t){u?Hr("Connection","Not sending because WebChannel is closed:",t):(a||(Hr("Connection","Opening WebChannel transport."),s.open(),a=!0),Hr("Connection","WebChannel sending:",t),s.send(t))},Ti:function(){return s.close()}});return(t=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(t){setTimeout((function(){throw t}),0)}}))})(s,Pr.EventType.OPEN,(function(){u||Hr("Connection","WebChannel transport opened.")})),t(s,Pr.EventType.CLOSE,(function(){u||(u=!0,Hr("Connection","WebChannel transport closed"),c.Vi())})),t(s,Pr.EventType.ERROR,(function(t){u||(u=!0,Qr("Connection","WebChannel transport errored:",t),c.Vi(new Br(qr.UNAVAILABLE,"The operation could not be completed")))})),t(s,Pr.EventType.MESSAGE,(function(t){var e,n,r,i;u||(Xr(!!(e=t.data[0])),(n=e.error||(null===(i=e[0])||void 0===i?void 0:i.error))?(Hr("Connection","WebChannel received error:",n),r=n.status,t=function(){var t=Rs[r];if(void 0!==t)return Us(t)}(),i=n.message,void 0===t&&(t=qr.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),u=!0,c.Vi(new Br(t,i)),s.close()):(Hr("Connection","WebChannel received:",e),c.Si(e)))})),t(o,Rr.STAT_EVENT,(function(t){t.stat===xr?Hr("Connection","Detected buffering proxy"):t.stat===Or&&Hr("Connection","Detected no buffering proxy")})),setTimeout((function(){c.Pi()}),0),c},ll);function ll(t){var e=this;return(e=Jh.call(this,t)||this).forceLongPolling=t.forceLongPolling,e.autoDetectLongPolling=t.autoDetectLongPolling,e.useFetchStreams=t.useFetchStreams,e}function fl(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}function dl(t){this.Ei=t.Ei,this.Ti=t.Ti}function pl(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}function yl(){}function gl(){this.li=new rl,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}function ml(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new qs(Zr),this.started=!1,this.$s=[],n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),this.storage=this.window.localStorage,this.currentUser=i,this.Os=Yh(this.persistenceKey,this.Ns),this.Ms="firestore_sequence_number_"+this.persistenceKey,this.ks=this.ks.insert(this.Ns,new rl),this.Ls=new RegExp("^firestore_clients_"+n+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+n+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+n+"_(\\d+)$"),this.Us="firestore_online_state_"+this.persistenceKey,this.Qs="firestore_bundle_loaded_"+this.persistenceKey,this.window.addEventListener("storage",this.xs)}function vl(){this.activeTargetIds=na}function wl(t,e){this.clientId=t,this.onlineState=e}function bl(t,e){this.clientId=t,this.activeTargetIds=e}function El(t,e,n){this.targetId=t,this.state=e,this.error=n}function Tl(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function Il(){return"undefined"!=typeof window?window:null}function _l(){return"undefined"!=typeof document?document:null}function Sl(t){return new va(t,!0)}function Al(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di((function(t){n.enqueueAndForget((function(){return u(o,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return Yl(this)?(Hr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return u(this,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:return(e=t).Or.add(4),[4,jl(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,Bl(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Br=new Ll(n,r)}var Dl,Nl,Cl,kl=(ql.prototype.reset=function(){this.qi=0},ql.prototype.Ki=function(){this.qi=this.Bi},ql.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);0<i&&Hr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,(function(){return e.Qi=Date.now(),t()})),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},ql.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},ql.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},ql.prototype.Wi=function(){return(Math.random()-.5)*this.qi},ql),Rl=(Ul.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},Ul.prototype.er=function(){return 2===this.state},Ul.prototype.start=function(){3!==this.state?this.auth():this.nr()},Ul.prototype.stop=function(){return u(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},Ul.prototype.sr=function(){this.state=0,this.Zi.reset()},Ul.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(function(){return t.rr()})))},Ul.prototype.cr=function(t){this.ur(),this.stream.send(t)},Ul.prototype.rr=function(){return u(this,void 0,void 0,(function(){return c(this,(function(t){return this.er()?[2,this.close(0)]:[2]}))}))},Ul.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},Ul.prototype.close=function(t,e){return u(this,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===qr.RESOURCE_EXHAUSTED?(zr(e.toString()),zr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):e&&e.code===qr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}}))}))},Ul.prototype.ar=function(){},Ul.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then((function(e){t.Yi===n&&t.lr(e)}),(function(n){e((function(){var e=new Br(qr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)}))}))},Ul.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((function(){n((function(){return e.state=2,e.listener.Ii()}))})),this.stream.Ri((function(t){n((function(){return e.dr(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},Ul.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji((function(){return u(t,void 0,void 0,(function(){return c(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},Ul.prototype.dr=function(t){return Hr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Ul.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget((function(){return e.Yi===t?n():(Hr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},s(Vl,Cl=A=Ul),Vl.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},Vl.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){if("targetChange"in e){e.targetChange;var n="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:Yr(),r=e.targetChange.targetIds||[],i=(s=e.targetChange.resumeToken,t.I?(Xr(void 0===s||"string"==typeof s),yi.fromBase64String(s||"")):(Xr(void 0===s||s instanceof Uint8Array),yi.fromUint8Array(s||new Uint8Array))),o=(a=e.targetChange.cause)&&(u=void 0===(c=a).code?qr.UNKNOWN:Us(c.code),new Br(u,c.message||"")),s=new aa(n,r,i,o||null)}else if("documentChange"in e){e.documentChange,(n=e.documentChange).document,n.document.name,n.document.updateTime,r=Sa(t,n.document.name),i=Ea(n.document.updateTime);var a=new Hi({mapValue:{fields:n.document.fields}}),u=(o=Qi.newFoundDocument(r,i,a),n.targetIds||[]),c=n.removedTargetIds||[];s=new oa(u,c,o.key,o)}else if("documentDelete"in e)e.documentDelete,(n=e.documentDelete).document,r=Sa(t,n.document),i=n.readTime?Ea(n.readTime):ri.min(),a=Qi.newNoDocument(r,i),o=n.removedTargetIds||[],s=new oa([],o,a.key,a);else if("documentRemove"in e)e.documentRemove,(n=e.documentRemove).document,r=Sa(t,n.document),i=n.removedTargetIds||[],s=new oa([],i,r,null);else{if(!("filter"in e))return Yr();e.filter,(e=e.filter).targetId,r=new ks(n=e.count||0),i=e.targetId,s=new sa(i,r)}return s}(this.R,t);return t=function(t){return"targetChange"in t?(t=t.targetChange).targetIds&&t.targetIds.length||!t.readTime?ri.min():Ea(t.readTime):ri.min()}(t),this.listener._r(e,t)},Vl.prototype.mr=function(t){var e,n,r,i,o={};o.database=Na(this.R),o.addTarget=(e=this.R,(r=Zi(r=(n=t).target)?{documents:La(e,r)}:{query:Pa(e,r)}).targetId=n.targetId,0<n.resumeToken.approximateByteSize()?r.resumeToken=ba(e,n.resumeToken):0<n.snapshotVersion.compareTo(ri.min())&&(r.readTime=wa(e,n.snapshotVersion.toTimestamp())),r),this.R,i=t,(t=null==(t=function(){switch(i.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Yr()}}())?null:{"goog-listen-tags":t})&&(o.labels=t),this.cr(o)},Vl.prototype.yr=function(t){var e={};e.database=Na(this.R),e.removeTarget=t,this.cr(e)},Vl),xl=(s(Fl,Nl=A),Object.defineProperty(Fl.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),Fl.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,Nl.prototype.start.call(this)},Fl.prototype.ar=function(){this.gr&&this.Er([])},Fl.prototype.wr=function(t){return this.Hi.Oi("Write",t)},Fl.prototype.onMessage=function(t){if(Xr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=(n=t.writeResults,r=t.commitTime,n&&0<n.length?(Xr(void 0!==r),n.map((function(t){return n=r,(t=(e=t).updateTime?Ea(e.updateTime):Ea(n)).isEqual(ri.min())&&(t=Ea(n)),new ds(t,e.transformResults||[]);var e,n}))):[]),n=Ea(t.commitTime);return this.listener.Tr(n,e)}var r;return Xr(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},Fl.prototype.Ar=function(){var t={};t.database=Na(this.R),this.cr(t)},Fl.prototype.Er=function(t){var e=this;t={streamToken:this.lastStreamToken,writes:t.map((function(t){return xa(e.R,t)}))},this.cr(t)},Fl),Ol=(s(Ml,Dl=function(){}),Ml.prototype.br=function(){if(this.Rr)throw new Br(qr.FAILED_PRECONDITION,"The client has already been terminated.")},Ml.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Ni(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===qr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Br(qr.UNKNOWN,t.toString())}))},Ml.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.$i(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===qr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Br(qr.UNKNOWN,t.toString())}))},Ml.prototype.terminate=function(){this.Rr=!0},Ml),Ll=(Pl.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()})))},Pl.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,1<=this.vr&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},Pl.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},Pl.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},Pl.prototype.Cr=function(t){t="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.",this.Vr?(zr(t),this.Vr=!1):Hr("OnlineStateTracker",t)},Pl.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},Pl);function Pl(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}function Ml(t,e,n){var r=this;return(r=Dl.call(this)||this).credentials=t,r.Hi=e,r.R=n,r.Rr=!1,r}function Fl(t,e,n,r,i){var o=this;return(o=Nl.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).R=r,o.gr=!1,o}function Vl(t,e,n,r,i){var o=this;return(o=Cl.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).R=r,o}function Ul(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new kl(t,e)}function ql(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}function Bl(t){return u(this,void 0,void 0,(function(){var e,n;return c(this,(function(r){switch(r.label){case 0:if(!Yl(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function jl(t){return u(this,void 0,void 0,(function(){var e,n;return c(this,(function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Kl(t,e){t.$r.has(e.targetId)||(t.$r.set(e.targetId,e),Wl(t)?Ql(t):of(t).er()&&Hl(t,e))}function Gl(t,e){var n=t;t=of(n),n.$r.delete(e),t.er()&&zl(n,e),0===n.$r.size&&(t.er()?t.ir():Yl(n)&&n.Br.set("Unknown"))}function Hl(t,e){t.qr.U(e.targetId),of(t).mr(e)}function zl(t,e){t.qr.U(e),of(t).yr(e)}function Ql(t){t.qr=new ca({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),of(t).start(),t.Br.Sr()}function Wl(t){return Yl(t)&&!of(t).tr()&&0<t.$r.size}function Yl(t){return 0===t.Or.size}function Xl(t){t.qr=void 0}function $l(t,e,n){return u(this,void 0,void 0,(function(){var r,i;return c(this,(function(o){switch(o.label){case 0:if(t.Br.set("Online"),!(e instanceof aa&&2===e.state&&e.cause))return[3,6];o.label=1;case 1:return o.trys.push([1,3,,5]),[4,function(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o;return c(this,(function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?(o=i[r],t.$r.has(o)?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]):[3,5];case 2:s.sent(),t.$r.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return o.sent(),[3,5];case 3:return r=o.sent(),Hr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,Jl(t,r)];case 4:return o.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof oa?t.qr.X(e):e instanceof sa?t.qr.rt(e):t.qr.et(e),n.isEqual(ri.min()))return[3,13];o.label=7;case 7:return o.trys.push([7,11,,13]),[4,gh(t.localStore)];case 8:return i=o.sent(),0<=n.compareTo(i)?[4,(a=n,(h=(s=t).qr.ut(a)).targetChanges.forEach((function(t,e){var n;0<t.resumeToken.approximateByteSize()&&(n=s.$r.get(e))&&s.$r.set(e,n.withResumeToken(t.resumeToken,a))})),h.targetMismatches.forEach((function(t){var e=s.$r.get(t);e&&(s.$r.set(t,e.withResumeToken(yi.EMPTY_BYTE_STRING,e.snapshotVersion)),zl(s,t),e=new Fu(e.target,t,1,e.sequenceNumber),Hl(s,e))})),s.remoteSyncer.applyRemoteEvent(h))]:[3,10];case 9:o.sent(),o.label=10;case 10:return[3,13];case 11:return Hr("RemoteStore","Failed to raise snapshot:",i=o.sent()),[4,Jl(t,i)];case 12:return o.sent(),[3,13];case 13:return[2]}var s,a,h}))}))}function Jl(t,e,n){return u(this,void 0,void 0,(function(){var r=this;return c(this,(function(i){switch(i.label){case 0:if(!Su(e))throw e;return t.Or.add(1),[4,jl(t)];case 1:return i.sent(),t.Br.set("Offline"),n=n||function(){return gh(t.localStore)},t.asyncQueue.enqueueRetryable((function(){return u(r,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return Hr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,Bl(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Zl(t,e){return e().catch((function(n){return Jl(t,n,e)}))}function tf(t){return u(this,void 0,void 0,(function(){var e,n,r,i;return c(this,(function(o){switch(o.label){case 0:n=sf(e=t),r=0<e.kr.length?e.kr[e.kr.length-1].batchId:-1,o.label=1;case 1:if(!(Yl(e)&&e.kr.length<10))return[3,7];o.label=2;case 2:return o.trys.push([2,4,,6]),[4,(s=e.localStore,a=r,(u=s).persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===a&&(a=-1),u._n.getNextMutationBatchAfterBatchId(t,a)})))];case 3:return null===(i=o.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e),(t=sf(t)).er()&&t.pr&&t.Er(e.mutations)}(e,i),[3,6]);case 4:return i=o.sent(),[4,Jl(e,i)];case 5:return o.sent(),[3,6];case 6:return[3,1];case 7:return ef(e)&&nf(e),[2]}var s,a,u}))}))}function ef(t){return Yl(t)&&!sf(t).tr()&&0<t.kr.length}function nf(t){sf(t).start()}function rf(t,e){return u(this,void 0,void 0,(function(){var n;return c(this,(function(r){switch(r.label){case 0:return n=t,e?(n.Or.delete(2),[4,Bl(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,jl(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function of(t){var e,n,r,i=this;return t.Ur||(t.Ur=(e=t.datastore,n=t.asyncQueue,r={Ii:function(t){return u(this,void 0,void 0,(function(){return c(this,(function(e){return t.$r.forEach((function(e,n){Hl(t,e)})),[2]}))}))}.bind(null,t),Ri:function(t,e){return u(this,void 0,void 0,(function(){return c(this,(function(n){return Xl(t),Wl(t)?(t.Br.Nr(e),Ql(t)):t.Br.set("Unknown"),[2]}))}))}.bind(null,t),_r:$l.bind(null,t)},e.br(),new Rl(n,e.Hi,e.credentials,e.R,r)),t.Mr.push((function(e){return u(i,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return e?(t.Ur.sr(),Wl(t)?Ql(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:n.sent(),Xl(t),n.label=3;case 3:return[2]}}))}))}))),t.Ur}function sf(t){var e,n,r,i=this;return t.Qr||(t.Qr=(e=t.datastore,n=t.asyncQueue,r={Ii:function(t){return u(this,void 0,void 0,(function(){return c(this,(function(e){return sf(t).Ar(),[2]}))}))}.bind(null,t),Ri:function(t,e){return u(this,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return e&&sf(t).pr?[4,function(t,e){return u(this,void 0,void 0,(function(){var n,r;return c(this,(function(i){switch(i.label){case 0:return Vs(r=e.code)&&r!==qr.ABORTED?(n=t.kr.shift(),sf(t).sr(),[4,Zl(t,(function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,tf(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return ef(t)&&nf(t),[2]}}))}))}.bind(null,t),Ir:function(t){return u(this,void 0,void 0,(function(){var e,n,r,i;return c(this,(function(o){for(e=sf(t),n=0,r=t.kr;n<r.length;n++)i=r[n],e.Er(i.mutations);return[2]}))}))}.bind(null,t),Tr:function(t,e,n){return u(this,void 0,void 0,(function(){var r,i;return c(this,(function(o){switch(o.label){case 0:return r=t.kr.shift(),i=Mu.from(r,e,n),[4,Zl(t,(function(){return t.remoteSyncer.applySuccessfulWrite(i)}))];case 1:return o.sent(),[4,tf(t)];case 2:return o.sent(),[2]}}))}))}.bind(null,t)},e.br(),new xl(n,e.Hi,e.credentials,e.R,r)),t.Mr.push((function(e){return u(i,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return e?(t.Qr.sr(),[4,tf(t)]):[3,2];case 1:return n.sent(),[3,4];case 2:return[4,t.Qr.stop()];case 3:n.sent(),0<t.kr.length&&(Hr("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),n.label=4;case 4:return[2]}}))}))}))),t.Qr}var af=(uf.createAndSchedule=function(t,e,n,r,i){return(i=new uf(t,e,Date.now()+n,r,i)).start(n),i},uf.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},uf.prototype.skipDelay=function(){return this.handleDelayElapsed()},uf.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Br(qr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},uf.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},uf.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},uf);function uf(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new du,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}function cf(t,e){if(zr("AsyncQueue",e+": "+t),Su(t))return new Br(qr.UNAVAILABLE,e+": "+t);throw t}function hf(){this.queries=new Uc(Ko,jo),this.onlineState="Unknown",this.Gr=new Set}var lf=(mf.emptySet=function(t){return new mf(t.comparator)},mf.prototype.has=function(t){return null!=this.keyedMap.get(t)},mf.prototype.get=function(t){return this.keyedMap.get(t)},mf.prototype.first=function(){return this.sortedSet.minKey()},mf.prototype.last=function(){return this.sortedSet.maxKey()},mf.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},mf.prototype.indexOf=function(t){return(t=this.keyedMap.get(t))?this.sortedSet.indexOf(t):-1},Object.defineProperty(mf.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),mf.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},mf.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},mf.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},mf.prototype.isEqual=function(t){if(!(t instanceof mf))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},mf.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},mf.prototype.copy=function(t,e){var n=new mf;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},mf),ff=(gf.prototype.track=function(t){var e=t.doc.key,n=this.Kr.get(e);!n||0!==t.type&&3===n.type?this.Kr=this.Kr.insert(e,t):3===t.type&&1!==n.type?this.Kr=this.Kr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Kr=this.Kr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Kr=this.Kr.remove(e):1===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):Yr()},gf.prototype.jr=function(){var t=[];return this.Kr.inorderTraversal((function(e,n){t.push(n)})),t},gf),df=(yf.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach((function(t){i.push({type:0,doc:t})})),new yf(t,e,lf.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(yf.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),yf.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&jo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},yf),pf=function(){this.Wr=void 0,this.listeners=[]};function yf(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}function gf(){this.Kr=new qs(ki.comparator)}function mf(t){this.comparator=t?function(e,n){return t(e,n)||ki.comparator(e.key,n.key)}:function(t,e){return ki.comparator(t.key,e.key)},this.keyedMap=Js,this.sortedSet=new qs(this.comparator)}function vf(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,s;return c(this,(function(a){switch(a.label){case 0:if(n=t,r=e.query,i=!1,(o=n.queries.get(r))||(i=!0,o=new pf),!i)return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=a.sent(),[3,4];case 3:return s=cf(s=a.sent(),"Initialization of query '"+Go(e.query)+"' failed"),[2,void e.onError(s)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&bf(n),[2]}}))}))}function wf(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,s;return c(this,(function(a){return n=t,r=e.query,i=!1,(o=n.queries.get(r))&&0<=(s=o.listeners.indexOf(e))&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]}))}))}function bf(t){t.Gr.forEach((function(t){t.next()}))}var Ef=(Nf.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new df(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},Nf.prototype.onError=function(t){this.Jr.error(t)},Nf.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},Nf.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},Nf.prototype.Zr=function(t){if(0<t.docChanges.length)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},Nf.prototype.no=function(t){t=df.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},Nf),Tf=(Df.prototype.io=function(){return"metadata"in this.payload},Df),If=(Af.prototype.qn=function(t){return Sa(this.R,t)},Af.prototype.Un=function(t){return t.metadata.exists?Ra(this.R,t.document,!1):Qi.newNoDocument(this.qn(t.metadata.name),this.Qn(t.metadata.readTime))},Af.prototype.Qn=Ea,Af),_f=(Sf.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},Sf.prototype.co=function(t){for(var e=new Map,n=new If(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||ea()).add(s);e.set(c,h)}}return e},Sf.prototype.complete=function(){return u(this,void 0,void 0,(function(){var t,e,n,r;return c(this,(function(i){switch(i.label){case 0:return[4,function(t,e,n,r){return u(this,void 0,void 0,(function(){var i,o,s,a,u,h,l,f,d,p;return c(this,(function(c){switch(c.label){case 0:for(i=t,o=ea(),s=Ys,a=Zs,u=0,h=n;u<h.length;u++)l=h[u],f=e.qn(l.metadata.name),l.document&&(o=o.add(f)),s=s.insert(f,e.Un(l)),a=a.insert(f,e.Qn(l.metadata.readTime));return d=i.On.newChangeBuffer({trackRemovals:!0}),[4,wh(i,qo(Oo(li.fromString("__bundle__/docs/"+r))))];case 1:return p=c.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",(function(t){return vh(t,d,s,ri.min(),a).next((function(e){return d.apply(t),e})).next((function(e){return i.qe.removeMatchingKeysForTargetId(t,p.targetId).next((function(){return i.qe.addMatchingKeys(t,o,p.targetId)})).next((function(){return i.Mn.En(t,e)})).next((function(){return e}))}))}))]}}))}))}(this.localStore,new If(this.R),this.documents,this.ro.id)];case 1:t=i.sent(),e=this.co(this.documents),n=0,r=this.queries,i.label=2;case 2:return n<r.length?(r=r[n],[4,function(t,e,n){return void 0===n&&(n=ea()),u(this,void 0,void 0,(function(){var r,i;return c(this,(function(o){switch(o.label){case 0:return[4,wh(t,qo($u(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=t).persistence.runTransaction("Save named query","readwrite",(function(t){var o=Ea(e.readTime);return 0<=r.snapshotVersion.compareTo(o)?i.Qe.saveNamedQuery(t,e):(o=r.withResumeToken(yi.EMPTY_BYTE_STRING,o),i.Fn=i.Fn.insert(o.targetId,o),i.qe.updateTargetData(t,o).next((function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)})).next((function(){return i.qe.addMatchingKeys(t,n,r.targetId)})).next((function(){return i.Qe.saveNamedQuery(t,e)})))}))]}}))}))}(this.localStore,r,e.get(r.name))]):[3,5];case 3:i.sent(),i.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new ih(Object.assign({},this.progress),t))]}}))}))},Sf);function Sf(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=Cf(t)}function Af(t){this.R=t}function Df(t,e){this.payload=t,this.byteLength=e}function Nf(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}function Cf(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var kf=function(t){this.key=t},Rf=function(t){this.key=t},xf=(Object.defineProperty(Ff.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),Ff.prototype._o=function(t,e){var n=this,r=e?e.mo:new ff,i=(e||this).fo,o=(e||this).mutatedKeys,s=i,a=!1,u=Lo(this.query)&&i.size===this.query.limit?i.last():null,c=Po(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),l=Ho(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations);e=!1,h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),e=!0):n.yo(h,l)||(r.track({type:2,doc:l}),e=!0,(u&&0<n.lo(l,u)||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),e=!0):h&&!l&&(r.track({type:1,doc:h}),e=!0,(u||c)&&(a=!0)),e&&(o=l?(s=s.add(l),d?o.add(t):o.delete(t)):(s=s.delete(t),o.delete(t)))})),Lo(this.query)||Po(this.query))for(;s.size>this.query.limit;){var h=Lo(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},Ff.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},Ff.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort((function(t,e){return i=t.type,o=e.type,n(i)-n(o)||r.lo(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Yr()}}var i,o})),this.po(n);var s=e?this.Eo():[];return e=(n=0===this.ho.size&&this.current?1:0)!==this.ao,this.ao=n,0!==o.length||e?{snapshot:new df(this.query,t.fo,i,o,t.mutatedKeys,0==n,e,!1),To:s}:{To:s}},Ff.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new ff,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},Ff.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},Ff.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e.uo=e.uo.add(t)})),t.modifiedDocuments.forEach((function(t){})),t.removedDocuments.forEach((function(t){return e.uo=e.uo.delete(t)})),this.current=t.current)},Ff.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=ea(),this.fo.forEach((function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))}));var n=[];return e.forEach((function(e){t.ho.has(e)||n.push(new Rf(e))})),this.ho.forEach((function(t){e.has(t)||n.push(new kf(t))})),n},Ff.prototype.Ao=function(t){return this.uo=t.Bn,this.ho=ea(),t=this._o(t.documents),this.applyChanges(t,!0)},Ff.prototype.Ro=function(){return df.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},Ff),Of=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Lf=function(t){this.key=t,this.bo=!1},Pf=(Object.defineProperty(Mf.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),Mf);function Mf(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new Uc(Ko,jo),this.Vo=new Map,this.So=new Set,this.Do=new qs(ki.comparator),this.Co=new Map,this.No=new Nh,this.xo={},this.Fo=new Map,this.ko=bc.Yt(),this.onlineState="Unknown",this.$o=void 0}function Ff(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=ea(),this.mutatedKeys=ea(),this.lo=zo(t),this.fo=new lf(this.lo)}function Vf(t,e,n,r){return u(this,void 0,void 0,(function(){var i,o,s;return c(this,(function(a){switch(a.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return u(this,void 0,void 0,(function(){var i,o;return c(this,(function(s){switch(s.label){case 0:return(i=e.view._o(n)).Nn?[4,Eh(t.localStore,e.query,!1).then((function(t){return t=t.documents,e.view._o(t,i)}))]:[3,2];case 1:i=s.sent(),s.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),o=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(Wf(t,e.targetId,o.To),o.snapshot)]}}))}))}(t,e,n,r)},[4,Eh(t.localStore,e,!0)];case 1:return o=a.sent(),s=new xf(e,o.Bn),i=s._o(o.documents),o=ia.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),o=s.applyChanges(i,t.isPrimaryClient,o),Wf(t,n,o.To),s=new Of(e,n,s),[2,(t.Po.set(e,s),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),o.snapshot)]}}))}))}function Uf(t,e,n){return u(this,void 0,void 0,(function(){var r,i;return c(this,(function(o){switch(o.label){case 0:i=rd(t),o.label=1;case 1:return o.trys.push([1,5,,6]),[4,(c=i.localStore,h=e,f=c,d=ni.now(),p=h.reduce((function(t,e){return t.add(e.key)}),ea()),f.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return f.Mn.pn(t,p).next((function(e){l=e;for(var n=[],r=0,i=h;r<i.length;r++){var o=i[r],s=function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field);null!=(s=Xo(o.transform,s||null))&&(n=null==n?Hi.empty():n).set(o.field,s)}return n||null}(o,l.get(o.key));null!=s&&n.push(new _s(o.key,s,function t(e){var n=[];return ai(e.fields,(function(e,r){var i=new di([e]);if(Ki(r))if(0===(r=t(r.mapValue).fields).length)n.push(i);else for(var o=0,s=r;o<s.length;o++){var a=s[o];n.push(i.child(a))}else n.push(i)})),new pi(n)}(s.value.mapValue),ys.exists(!0)))}return f._n.addMutationBatch(t,d,n,h)}))})).then((function(t){return t.applyToLocalDocumentSet(l),{batchId:t.batchId,changes:l}})))];case 2:return r=o.sent(),i.sharedClientState.addPendingMutation(r.batchId),s=i,a=r.batchId,u=n,c=(c=(c=s.xo[s.currentUser.toKey()])||new qs(Zr)).insert(a,u),s.xo[s.currentUser.toKey()]=c,[4,Xf(i,r.changes)];case 3:return o.sent(),[4,tf(i.remoteStore)];case 4:return o.sent(),[3,6];case 5:return i=cf(i=o.sent(),"Failed to persist write"),n.reject(i),[3,6];case 6:return[2]}var s,a,u,c,h,l,f,d,p}))}))}function qf(t,e){return u(this,void 0,void 0,(function(){var n,r;return c(this,(function(i){switch(i.label){case 0:n=t,i.label=1;case 1:return i.trys.push([1,4,,6]),[4,mh(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach((function(t,e){(e=n.Co.get(e))&&(Xr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),0<t.addedDocuments.size?e.bo=!0:0<t.modifiedDocuments.size?Xr(e.bo):0<t.removedDocuments.size&&(Xr(e.bo),e.bo=!1))})),[4,Xf(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,Dc(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function Bf(t,e,n){var r;((t=t).isPrimaryClient&&0===n||!t.isPrimaryClient&&1===n)&&(r=[],t.Po.forEach((function(t,n){(n=n.view.zr(e)).snapshot&&r.push(n.snapshot)})),function(t,e){t.onlineState=e;var n=!1;t.queries.forEach((function(t,r){for(var i=0,o=r.listeners;i<o.length;i++)o[i].zr(e)&&(n=!0)})),n&&bf(t)}(t.eventManager,e),r.length&&t.vo._r(r),t.onlineState=e,t.isPrimaryClient&&t.sharedClientState.setOnlineState(e))}function jf(t,e,n){return u(this,void 0,void 0,(function(){var r,i;return c(this,(function(o){switch(o.label){case 0:r=t,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,(s=r.localStore,a=e,(u=s).persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var e;return u._n.lookupMutationBatch(t,a).next((function(n){return Xr(null!==n),e=n.keys(),u._n.removeMutationBatch(t,n)})).next((function(){return u._n.performConsistencyCheck(t)})).next((function(){return u.Mn.pn(t,e)}))})))];case 2:return i=o.sent(),Hf(r,e,n),Gf(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Xf(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,Dc(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}var s,a,u}))}))}function Kf(t,e){return u(this,void 0,void 0,(function(){var n,r,i;return c(this,(function(o){switch(o.label){case 0:Yl((n=t).remoteStore)||Hr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,(s=n.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return s._n.getHighestUnacknowledgedBatchId(t)}))];case 2:return-1===(r=o.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return i=cf(i=o.sent(),"Initialization of waitForPendingWrites() operation failed"),e.reject(i),[3,4];case 4:return[2]}var s}))}))}function Gf(t,e){(t.Fo.get(e)||[]).forEach((function(t){t.resolve()})),t.Fo.delete(e)}function Hf(t,e,n){var r=t,i=r.xo[r.currentUser.toKey()];i&&((t=i.get(e))&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i)}function zf(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach((function(e){t.No.containsKey(e)||Qf(t,e)}))}function Qf(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Gl(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Yf(t))}function Wf(t,e,n){for(var r,i,o,s=0,a=n;s<a.length;s++){var u=a[s];u instanceof kf?(t.No.addReference(u.key,e),r=t,o=void 0,i=(o=(i=u).key).path.canonicalString(),r.Do.get(o)||r.So.has(i)||(Hr("SyncEngine","New document in limbo: "+o),r.So.add(i),Yf(r))):u instanceof Rf?(Hr("SyncEngine","Document no longer in limbo: "+u.key),t.No.removeReference(u.key,e),t.No.containsKey(u.key)||Qf(t,u.key)):Yr()}}function Yf(t){for(;0<t.So.size&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new ki(li.fromString(e));e=t.ko.next(),t.Co.set(e,new Lf(n)),t.Do=t.Do.insert(n,e),Kl(t.remoteStore,new Fu(qo(Oo(n.path)),e,2,Fr.o))}}function Xf(t,e,n){return u(this,void 0,void 0,(function(){var r,i,o,s;return c(this,(function(a){switch(a.label){case 0:return i=[],o=[],s=[],(r=t).Po.isEmpty()?[3,3]:(r.Po.forEach((function(t,a){s.push(r.Oo(a,e,n).then((function(t){t&&(r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t),t=sh.Pn(a.targetId,t),o.push(t))})))})),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,s,a,u;return c(this,(function(c){switch(c.label){case 0:n=t,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return pu.forEach(e,(function(e){return pu.forEach(e.bn,(function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)})).next((function(){return pu.forEach(e.vn,(function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)}))}))}))}))];case 2:return c.sent(),[3,4];case 3:if(!Su(r=c.sent()))throw r;return Hr("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)u=o[i],s=u.targetId,u.fromCache||(a=n.Fn.get(s),u=a.snapshotVersion,u=a.withLastLimboFreeSnapshotVersion(u),n.Fn=n.Fn.insert(s,u));return[2]}}))}))}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}}))}))}function $f(t,e){return u(this,void 0,void 0,(function(){var n,r;return c(this,(function(i){switch(i.label){case 0:return(n=t).currentUser.isEqual(e)?[3,3]:(Hr("SyncEngine","User change. New user:",e.toKey()),[4,ph(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,(o=n).Fo.forEach((function(t){t.forEach((function(t){t.reject(new Br(qr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),o.Fo.clear(),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Xf(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}var o}))}))}function Jf(t,e,n,r){return u(this,void 0,void 0,(function(){var i,o;return c(this,(function(s){switch(s.label){case 0:return[4,(a=(i=t).localStore,u=e,h=(c=a)._n,c.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return h.jt(t,u).next((function(e){return e?c.Mn.pn(t,e):pu.resolve(null)}))})))];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,tf(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Hf(i,e,r||null),Gf(i,e),i.localStore._n.Gt(e)):Yr(),s.label=4;case 4:return[4,Xf(i,o)];case 5:return s.sent(),[3,7];case 6:Hr("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}var a,u,c,h}))}))}function Zf(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,h;return c(this,(function(c){switch(c.label){case 0:return nd(n=t),rd(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,td(n,r.toArray())]);case 1:return i=c.sent(),n.$o=!0,[4,rf(n.remoteStore,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)a=s[o],Kl(n.remoteStore,a);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(u=[],h=Promise.resolve(),n.Vo.forEach((function(t,e){n.sharedClientState.isLocalQueryTarget(e)?u.push(e):h=h.then((function(){return zf(n,e),bh(n.localStore,e,!0)})),Gl(n.remoteStore,e)})),[4,h]);case 4:return c.sent(),[4,td(n,u)];case 5:return c.sent(),(l=n).Co.forEach((function(t,e){Gl(l.remoteStore,e)})),l.No.ts(),l.Co=new Map,l.Do=new qs(ki.comparator),n.$o=!1,[4,rf(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}var l}))}))}function td(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,s,a,h,l,f,d,p,y;return c(this,(function(g){switch(g.label){case 0:n=t,r=[],i=[],o=0,s=e,g.label=1;case 1:return o<s.length?(a=s[o],h=void 0,(l=n.Vo.get(a))&&0!==l.length?[4,wh(n.localStore,qo(l[0]))]:[3,7]):[3,13];case 2:h=g.sent(),f=0,d=l,g.label=3;case 3:return f<d.length?(p=d[f],p=n.Po.get(p),[4,function(t,e){return u(this,void 0,void 0,(function(){var n,r;return c(this,(function(i){switch(i.label){case 0:return[4,Eh((n=t).localStore,e.query,!0)];case 1:return r=i.sent(),r=e.view.Ao(r),[2,(n.isPrimaryClient&&Wf(n,e.targetId,r.To),r)]}}))}))}(n,p)]):[3,6];case 4:(p=g.sent()).snapshot&&i.push(p.snapshot),g.label=5;case 5:return f++,[3,3];case 6:return[3,11];case 7:return[4,Th(n.localStore,a)];case 8:return y=g.sent(),[4,wh(n.localStore,y)];case 9:return h=g.sent(),[4,Vf(n,ed(y),a,!1)];case 10:g.sent(),g.label=11;case 11:r.push(h),g.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}}))}))}function ed(t){return xo(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function nd(t){return t.remoteStore.remoteSyncer.applyRemoteEvent=qf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(t,e){var n=t;if((t=n.Co.get(e))&&t.bo)return ea().add(t.key);var r=ea();if(!(e=n.Vo.get(e)))return r;for(var i=0,o=e;i<o.length;i++){var s=o[i];s=n.Po.get(s),r=r.unionWith(s.view.wo)}return r}.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=function(t,e,n){return u(this,void 0,void 0,(function(){var r,i,o,s;return c(this,(function(a){switch(a.label){case 0:return(r=t).sharedClientState.updateQueryState(e,"rejected",n),s=r.Co.get(e),(i=s&&s.key)?(o=(o=new qs(ki.comparator)).insert(i,Qi.newNoDocument(i,ri.min())),s=ea().add(i),s=new ra(ri.min(),new Map,new Qs(Zr),o,s),[4,qf(r,s)]):[3,2];case 1:return a.sent(),r.Do=r.Do.remove(i),r.Co.delete(e),Yf(r),[3,4];case 2:return[4,bh(r.localStore,e,!1).then((function(){return zf(r,e,n)})).catch(Dc)];case 3:a.sent(),a.label=4;case 4:return[2]}}))}))}.bind(null,t),t.vo._r=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query;if(a=n.queries.get(a)){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&bf(n)}.bind(null,t.eventManager),t.vo.Mo=function(t,e,n){var r=t;if(t=r.queries.get(e))for(var i=0,o=t.listeners;i<o.length;i++)o[i].onError(n);r.queries.delete(e)}.bind(null,t.eventManager),t}function rd(t){return t.remoteStore.remoteSyncer.applySuccessfulWrite=function(t,e){return u(this,void 0,void 0,(function(){var n,r,i;return c(this,(function(o){switch(o.label){case 0:n=t,r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,yh(n.localStore,e)];case 2:return i=o.sent(),Hf(n,r,null),Gf(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Xf(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,Dc(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=jf.bind(null,t),t}function id(t,e,n){var r=t;(function(t,e,n){return u(this,void 0,void 0,(function(){var r,i,o,s,a;return c(this,(function(u){switch(u.label){case 0:return u.trys.push([0,14,,15]),[4,e.getMetadata()];case 1:return r=u.sent(),[4,(l=t.localStore,d=l,p=Ea((f=r).createTime),d.persistence.runTransaction("hasNewerBundle","readonly",(function(t){return d.Qe.getBundleMetadata(t,f.id)})).then((function(t){return!!t&&0<=t.createTime.compareTo(p)})))];case 2:return u.sent()?[4,e.close()]:[3,4];case 3:return[2,(u.sent(),void n._completeWith({taskState:"Success",documentsLoaded:r.totalDocuments,bytesLoaded:r.totalBytes,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}))];case 4:return n._updateProgress(Cf(r)),i=new _f(r,t.localStore,e.R),[4,e.Lo()];case 5:o=u.sent(),u.label=6;case 6:return o?[4,i.oo(o)]:[3,10];case 7:return(s=u.sent())&&n._updateProgress(s),[4,e.Lo()];case 8:o=u.sent(),u.label=9;case 9:return[3,6];case 10:return[4,i.complete()];case 11:return a=u.sent(),[4,Xf(t,a.wn,void 0)];case 12:return u.sent(),[4,(l=t.localStore,c=r,(h=l).persistence.runTransaction("Save bundle","readwrite",(function(t){return h.Qe.saveBundleMetadata(t,c)})))];case 13:return u.sent(),n._completeWith(a.progress),[3,15];case 14:return Qr("SyncEngine","Loading bundle failed with "+(a=u.sent())),n._failWith(a),[3,15];case 15:return[2]}var c,h,l,f,d,p}))}))})(r,e,n).then((function(){r.sharedClientState.notifyBundleLoaded()}))}var od,sd,ad=(pd.prototype.initialize=function(t){return u(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return this.R=Sl(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Qo(t),[2]}}))}))},pd.prototype.Uo=function(t){return null},pd.prototype.Qo=function(t){return dh(this.persistence,new ah,t.initialUser,this.R)},pd.prototype.qo=function(t){return new Lh(Mh.bs,this.R)},pd.prototype.Bo=function(t){return new ol},pd.prototype.terminate=function(){return u(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},pd),ud=(s(dd,sd=ad),dd.prototype.initialize=function(t){return u(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,sd.prototype.initialize.call(this,t)];case 1:return e.sent(),[4,_h(this.localStore)];case 2:return e.sent(),[4,this.Ko.initialize(this,t)];case 3:return e.sent(),[4,rd(this.Ko.syncEngine)];case 4:return e.sent(),[4,tf(this.Ko.remoteStore)];case 5:return e.sent(),[2]}}))}))},dd.prototype.Qo=function(t){return dh(this.persistence,new ah,t.initialUser,this.R)},dd.prototype.Uo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new kc(e,t.asyncQueue)},dd.prototype.qo=function(t){var e=rh(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?hc.withCacheSize(this.cacheSizeBytes):hc.DEFAULT;return new Zc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Il(),_l(),this.R,this.sharedClientState,!!this.forceOwnership)},dd.prototype.Bo=function(t){return new ol},dd),cd=(s(fd,od=ud),fd.prototype.initialize=function(t){return u(this,void 0,void 0,(function(){var e,n=this;return c(this,(function(r){switch(r.label){case 0:return[4,od.prototype.initialize.call(this,t)];case 1:return r.sent(),e=this.Ko.syncEngine,this.sharedClientState instanceof il?(this.sharedClientState.syncEngine={ui:Jf.bind(null,e),ai:function(t,e,n,r){return u(this,void 0,void 0,(function(){var i,o,s;return c(this,(function(a){switch(a.label){case 0:return(i=t).$o?(Hr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Ih(i.localStore)];case 3:return o=a.sent(),s=ra.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Xf(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,bh(i.localStore,e,!0)];case 6:return a.sent(),zf(i,e,r),[3,8];case 7:Yr(),a.label=8;case 8:return[2]}}))}))}.bind(null,e),hi:function(t,e,n){return u(this,void 0,void 0,(function(){var r,i,o,s,a,u,h,l;return c(this,(function(f){switch(f.label){case 0:if(!(r=nd(t)).$o)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?(o=o[i],r.Vo.has(o)?(Hr("SyncEngine","Adding an already active target "+o),[3,5]):[4,Th(r.localStore,o)]):[3,6];case 2:return s=f.sent(),[4,wh(r.localStore,s)];case 3:return a=f.sent(),[4,Vf(r,ed(s),a.targetId,!1)];case 4:f.sent(),Kl(r.remoteStore,a),f.label=5;case 5:return i++,[3,1];case 6:u=function(t){return c(this,(function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,bh(r.localStore,t,!1).then((function(){Gl(r.remoteStore,t),zf(r,t)})).catch(Dc)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},h=0,l=n,f.label=7;case 7:return h<l.length?(l=l[h],[5,u(l)]):[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}}))}))}.bind(null,e),fn:function(t){return t.localStore.persistence.fn()}.bind(null,e),ci:function(t){return u(this,void 0,void 0,(function(){var e;return c(this,(function(n){return[2,Ih((e=t).localStore).then((function(t){return Xf(e,t)}))]}))}))}.bind(null,e)},[4,this.sharedClientState.start()]):[3,3];case 2:r.sent(),r.label=3;case 3:return[4,this.persistence.He((function(t){return u(n,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,Zf(this.Ko.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return r.sent(),[2]}}))}))},fd.prototype.Bo=function(t){var e=Il();if(!il.yt(e))throw new Br(qr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=rh(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new il(e,t.asyncQueue,n,t.clientId,t.initialUser)},fd),hd=(ld.prototype.initialize=function(t,e){return u(this,void 0,void 0,(function(){var n=this;return c(this,(function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Bf(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=$f.bind(null,this.syncEngine),[4,rf(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},ld.prototype.createEventManager=function(t){return new hf},ld.prototype.createDatastore=function(t){var e=Sl(t.databaseInfo.databaseId),n=(n=t.databaseInfo,new hl(n));return t=t.credentials,new Ol(t,n,e)},ld.prototype.createRemoteStore=function(t){var e=this;return new Al(this.localStore,this.datastore,t.asyncQueue,(function(t){return Bf(e.syncEngine,t,0)}),t=new(al.yt()?al:sl))},ld.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){return o=new Pf(t,e,n,r,i,o),s&&(o.$o=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},ld.prototype.terminate=function(){return function(t){return u(this,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:return e=t,Hr("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,jl(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}}))}))}(this.remoteStore)},ld);function ld(){}function fd(t,e){var n=this;return(n=od.call(this,t,e,!1)||this).Ko=t,n.cacheSizeBytes=e,n.synchronizeTabs=!0,n}function dd(t,e,n){var r=this;return(r=sd.call(this)||this).Ko=t,r.cacheSizeBytes=e,r.forceOwnership=n,r.synchronizeTabs=!1,r}function pd(){this.synchronizeTabs=!1}function yd(t,e){void 0===e&&(e=10240);var n=0;return{read:function(){return u(this,void 0,void 0,(function(){var r;return c(this,(function(i){return n<t.byteLength?(r={value:t.slice(n,n+e),done:!1},[2,(n+=e,r)]):[2,{done:!0}]}))}))},cancel:function(){return u(this,void 0,void 0,(function(){return c(this,(function(t){return[2]}))}))},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var gd=(Sd.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},Sd.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},Sd.prototype.Wo=function(){this.muted=!0},Sd.prototype.jo=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},Sd),md=(_d.prototype.close=function(){return this.Go.cancel()},_d.prototype.getMetadata=function(){return u(this,void 0,void 0,(function(){return c(this,(function(t){return[2,this.metadata.promise]}))}))},_d.prototype.Lo=function(){return u(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}}))}))},_d.prototype.Ho=function(){return u(this,void 0,void 0,(function(){var t,e,n;return c(this,(function(r){switch(r.label){case 0:return[4,this.Jo()];case 1:return null===(t=r.sent())?[2,null]:(n=this.zo.decode(t),e=Number(n),isNaN(e)&&this.Yo("length string ("+n+") is not valid number"),[4,this.Xo(e)]);case 2:return n=r.sent(),[2,new Tf(JSON.parse(n),t.length+e)]}}))}))},_d.prototype.Zo=function(){return this.buffer.findIndex((function(t){return t==="{".charCodeAt(0)}))},_d.prototype.Jo=function(){return u(this,void 0,void 0,(function(){var t,e;return c(this,(function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}}))}))},_d.prototype.Xo=function(t){return u(this,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}}))}))},_d.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},_d.prototype.tc=function(){return u(this,void 0,void 0,(function(){var t,e;return c(this,(function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}}))}))},_d),vd=(Id.prototype.lookup=function(t){return u(this,void 0,void 0,(function(){var e,n=this;return c(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Br(qr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,s;return c(this,(function(a){switch(a.label){case 0:return r=Na((n=t).R)+"/documents",i={documents:e.map((function(t){return _a(n.R,t)}))},[4,n.$i("BatchGetDocuments",r,i)];case 1:return i=a.sent(),o=new Map,i.forEach((function(t){var e;e=n.R,t="found"in(t=t)?function(t,e){Xr(!!e.found),e.found.name,e.found.updateTime;var n=Sa(t,e.found.name);return t=Ea(e.found.updateTime),e=new Hi({mapValue:{fields:e.found.fields}}),Qi.newFoundDocument(n,t,e)}(e,t):"missing"in t?function(t,e){return Xr(!!e.missing),Xr(!!e.readTime),t=Sa(t,e.missing),e=Ea(e.readTime),Qi.newNoDocument(t,e)}(e,t):Yr(),o.set(t.key.toString(),t)})),s=[],[2,(e.forEach((function(t){Xr(!!(t=o.get(t.toString()))),s.push(t)})),s)]}}))}))}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach((function(t){return n.recordVersion(t)})),e)]}}))}))},Id.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},Id.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},Id.prototype.delete=function(t){this.write(new Ls(t,this.precondition(t))),this.writtenDocs.add(t.toString())},Id.prototype.commit=function(){return u(this,void 0,void 0,(function(){var t,e=this;return c(this,(function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){n=ki.fromPath(n),e.mutations.push(new Ps(n,e.precondition(n)))})),[4,function(t,e){return u(this,void 0,void 0,(function(){var n,r,i;return c(this,(function(o){switch(o.label){case 0:return r=Na((n=t).R)+"/documents",i={writes:e.map((function(t){return xa(n.R,t)}))},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}}))}))}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}}))}))},Id.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Yr();e=ri.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Br(qr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},Id.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?ys.updateTime(e):ys.none()},Id.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(this.writtenDocs.has(t.toString())||!e)return ys.exists(!0);if(e.isEqual(ri.min()))throw new Br(qr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ys.updateTime(e)},Id.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},Id.prototype.ensureCommitNotCalled=function(){},Id),wd=(Td.prototype.run=function(){this.nc()},Td.prototype.nc=function(){var t=this;this.Zi.ji((function(){return u(t,void 0,void 0,(function(){var t,e,n=this;return c(this,(function(r){return t=new vd(this.datastore),(e=this.sc(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.ic(t)}))}))})).catch((function(t){n.ic(t)})),[2]}))}))}))},Td.prototype.sc=function(t){try{var e=this.updateFunction(t);return!Di(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},Td.prototype.ic=function(t){var e=this;0<this.ec&&this.rc(t)?(--this.ec,this.asyncQueue.enqueueAndForget((function(){return e.nc(),Promise.resolve()}))):this.deferred.reject(t)},Td.prototype.rc=function(t){return"FirebaseError"===t.name&&("aborted"===(t=t.code)||"failed-precondition"===t||!Vs(t))},Td),bd=(Ed.prototype.getConfiguration=function(){return u(this,void 0,void 0,(function(){return c(this,(function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]}))}))},Ed.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},Ed.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Br(qr.FAILED_PRECONDITION,"The client has already been terminated.")},Ed.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new du;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return u(t,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:return n.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:n.sent(),n.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=cf(t=n.sent(),"Failed to shutdown persistence"),e.reject(t),[3,6];case 6:return[2]}}))}))})),e.promise},Ed);function Ed(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Fh.UNAUTHENTICATED,this.clientId=$r.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,(function(t){return u(r,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return Hr("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}}))}))}))}function Td(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new kl(this.asyncQueue,"transaction_retry")}function Id(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}function _d(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new du,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then((function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))}),(function(t){return n.metadata.reject(t)}))}function Sd(t){this.observer=t,this.muted=!1}function Ad(t,e){return u(this,void 0,void 0,(function(){var n,r,i=this;return c(this,(function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),Hr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener((function(t){return u(i,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,ph(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}}))}))})),e.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=e,[2]}}))}))}function Dd(t,e){return u(this,void 0,void 0,(function(){var n,r;return c(this,(function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,Nd(t)];case 1:return n=i.sent(),Hr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener((function(t){return function(t,e){return u(this,void 0,void 0,(function(){var n,r;return c(this,(function(i){switch(i.label){case 0:return(n=t).asyncQueue.verifyOperationInProgress(),Hr("RemoteStore","RemoteStore received new credentials"),r=Yl(n),n.Or.add(3),[4,jl(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,Bl(n)];case 3:return i.sent(),[2]}}))}))}(e.remoteStore,t)})),t.onlineComponents=e,[2]}}))}))}function Nd(t){return u(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(Hr("FirestoreClient","Using default OfflineComponentProvider"),[4,Ad(t,new ad)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}}))}))}function Cd(t){return u(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(Hr("FirestoreClient","Using default OnlineComponentProvider"),[4,Dd(t,new hd)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}}))}))}function kd(t){return Nd(t).then((function(t){return t.persistence}))}function Rd(t){return Nd(t).then((function(t){return t.localStore}))}function xd(t){return Cd(t).then((function(t){return t.remoteStore}))}function Od(t){return Cd(t).then((function(t){return t.syncEngine}))}function Ld(t){return u(this,void 0,void 0,(function(){var e,n;return c(this,(function(r){switch(r.label){case 0:return[4,Cd(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=function(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,s;return c(this,(function(a){switch(a.label){case 0:return n=nd(t),(s=n.Po.get(e))?(r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Ro(),[3,4]):[3,1];case 1:return[4,wh(n.localStore,qo(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),r=o.targetId,[4,Vf(n,e,r,"current"===s)];case 3:i=a.sent(),n.isPrimaryClient&&Kl(n.remoteStore,o),a.label=4;case 4:return[2,i]}}))}))}.bind(null,e.syncEngine),n.onUnlisten=function(t,e){return u(this,void 0,void 0,(function(){var n,r,i;return c(this,(function(o){switch(o.label){case 0:return r=(n=t).Po.get(e),1<(i=n.Vo.get(r.targetId)).length?[2,(n.Vo.set(r.targetId,i.filter((function(t){return!jo(t,e)}))),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,bh(n.localStore,r.targetId,!1).then((function(){n.sharedClientState.clearQueryState(r.targetId),Gl(n.remoteStore,r.targetId),zf(n,r.targetId)})).catch(Dc)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return zf(n,r.targetId),[4,bh(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}.bind(null,e.syncEngine),n)]}}))}))}function Pd(t,e,n){var r=this;void 0===n&&(n={});var i=new du;return t.asyncQueue.enqueueAndForget((function(){return u(r,void 0,void 0,(function(){var r;return c(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new gd({next:function(o){e.enqueueAndForget((function(){return wf(t,s)}));var a=o.docs.has(n);!a&&o.fromCache?i.reject(new Br(qr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new Br(qr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new Ef(Oo(n.path),o,{includeMetadataChanges:!0,so:!0});return vf(t,s)},[4,Ld(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}function Md(t,e,n){var r=this;void 0===n&&(n={});var i=new du;return t.asyncQueue.enqueueAndForget((function(){return u(r,void 0,void 0,(function(){var r;return c(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new gd({next:function(n){e.enqueueAndForget((function(){return wf(t,s)})),n.fromCache&&"server"===r.source?i.reject(new Br(qr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new Ef(n,o,{includeMetadataChanges:!0,so:!0});return vf(t,s)},[4,Ld(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}function Fd(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t}var Vd=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},Ud=(Object.defineProperty($d.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),$d.prototype.isEqual=function(t){return t instanceof $d&&t.projectId===this.projectId&&t.database===this.database},$d),qd=new Map,Bd=(Xd.prototype.getToken=function(){return Promise.resolve(null)},Xd.prototype.invalidateToken=function(){},Xd.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable((function(){return e(Fh.UNAUTHENTICATED)}))},Xd.prototype.removeChangeListener=function(){this.changeListener=null},Xd),jd=(Yd.prototype.getToken=function(){return Promise.resolve(this.token)},Yd.prototype.invalidateToken=function(){},Yd.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable((function(){return e(n.token.user)}))},Yd.prototype.removeChangeListener=function(){this.changeListener=null},Yd),Kd=(Wd.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.cc!==e?(Hr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Xr("string"==typeof n.accessToken),new Fd(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},Wd.prototype.invalidateToken=function(){this.forceRefresh=!0},Wd.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable((function(){return u(n,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}}))}))}))},Wd.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},Wd.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return Xr(null===t||"string"==typeof t),new Fh(t)},Wd),Gd=(Object.defineProperty(Qd.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),Qd),Hd=(zd.prototype.getToken=function(){return Promise.resolve(new Gd(this.hc,this.lc,this.fc))},zd.prototype.setChangeListener=function(t,e){t.enqueueRetryable((function(){return e(Fh.FIRST_PARTY)}))},zd.prototype.removeChangeListener=function(){},zd.prototype.invalidateToken=function(){},zd);function zd(t,e,n){this.hc=t,this.lc=e,this.fc=n}function Qd(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=Fh.FIRST_PARTY}function Wd(t){var e=this;function n(t){Hr("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)}this.currentUser=Fh.UNAUTHENTICATED,this.oc=new du,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable((function(){return e.changeListener(e.currentUser)}))},t.onInit(n),setTimeout((function(){var r;e.auth||((r=t.getImmediate({optional:!0}))?n(r):(Hr("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve()))}),0)}function Yd(t){this.token=t,this.changeListener=null}function Xd(){this.changeListener=null}function $d(t,e){this.projectId=t,this.database=e||"(default)"}function Jd(t,e,n){if(!n)throw new Br(qr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Zd(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Br(qr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function tp(t,e,n,r){if(!0===e&&!0===r)throw new Br(qr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function ep(t){if(!ki.isDocumentKey(t))throw new Br(qr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function np(t){if(ki.isDocumentKey(t))throw new Br(qr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function rp(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Yr();if(t instanceof Array)return"an array";var e=function(){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}();return e?"a custom "+e+" object":"an object"}function ip(t,e){if((t="_delegate"in t?t._delegate:t)instanceof e)return t;if(e.name===t.constructor.name)throw new Br(qr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");throw t=rp(t),new Br(qr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+t)}function op(t,e){if(e<=0)throw new Br(qr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var sp,ap=(gp.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},gp),up=(Object.defineProperty(yp.prototype,"app",{get:function(){if(!this._app)throw new Br(qr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(yp.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(yp.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),yp.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Br(qr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ap(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Bd;switch(t.type){case"gapi":var e=t.client;return Xr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Hd(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Br(qr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},yp.prototype._getSettings=function(){return this._settings},yp.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},yp.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},yp.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},yp.prototype._terminate=function(){return(t=qd.get(this))&&(Hr("ComponentProvider","Removing Datastore"),qd.delete(this),t.terminate()),Promise.resolve();var t},yp),cp=(Object.defineProperty(pp.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(pp.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(pp.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(pp.prototype,"parent",{get:function(){return new lp(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),pp.prototype.withConverter=function(t){return new pp(this.firestore,t,this._key)},pp),hp=(dp.prototype.withConverter=function(t){return new dp(this.firestore,t,this._query)},dp),lp=(s(fp,sp=hp),Object.defineProperty(fp.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(fp.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(fp.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new cp(this.firestore,null,new ki(t))},enumerable:!1,configurable:!0}),fp.prototype.withConverter=function(t){return new fp(this.firestore,t,this._path)},fp);function fp(t,e,n){var r=this;return(r=sp.call(this,t,e,Oo(n))||this)._path=n,r.type="collection",r}function dp(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}function pp(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}function yp(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ap({}),this._settingsFrozen=!1,t instanceof Ud?(this._databaseId=t,this._credentials=new Bd):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Br(qr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ud(t.options.projectId)}(t),this._credentials=new Kd(e))}function gp(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Br(qr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Br(qr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,tp("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}function mp(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=E(t),Jd("collection","path",e),t instanceof up)return np(n=li.fromString.apply(li,h([e],r))),new lp(t,null,n);if(!(t instanceof cp||t instanceof lp))throw new Br(qr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return np(n=li.fromString.apply(li,h([t.path],r)).child(li.fromString(e))),new lp(t.firestore,null,n)}function vp(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=E(t),Jd("doc","path",e=1===arguments.length?$r.u():e),t instanceof up)return ep(n=li.fromString.apply(li,h([e],r))),new cp(t,null,new ki(n));if(!(t instanceof cp||t instanceof lp))throw new Br(qr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return ep(n=t._path.child(li.fromString.apply(li,h([e],r)))),new cp(t.firestore,t instanceof lp?t.converter:null,new ki(n))}function wp(t,e){return t=E(t),e=E(e),(t instanceof cp||t instanceof lp)&&(e instanceof cp||e instanceof lp)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function bp(t,e){return t=E(t),e=E(e),t instanceof hp&&e instanceof hp&&t.firestore===e.firestore&&jo(t._query,e._query)&&t.converter===e.converter}var Ep=(Object.defineProperty(Tp.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),Tp.prototype.enqueueAndForget=function(t){this.enqueue(t)},Tp.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ic(),this.Ac(t)},Tp.prototype.enterRestrictedMode=function(){var t;this._c||(this._c=!0,(t=_l())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Tc))},Tp.prototype.enqueue=function(t){return this.Ic(),this._c?new Promise((function(t){})):this.Ac(t)},Tp.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget((function(){return e.wc.push(t),e.Rc()}))},Tp.prototype.Rc=function(){return u(this,void 0,void 0,(function(){var t,e=this;return c(this,(function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!Su(t=n.sent()))throw t;return Hr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:0<this.wc.length&&this.Zi.ji((function(){return e.Rc()})),n.label=5;case 5:return[2]}}))}))},Tp.prototype.Ac=function(t){var e=this,n=this.dc.then((function(){return e.gc=!0,t().catch((function(t){throw e.yc=t,e.gc=!1,zr("INTERNAL UNHANDLED ERROR: ",(r=(n=t).message||"",r=n.stack?n.stack.includes(n.message)?n.stack:n.message+"\n"+n.stack:r)),t;var n,r})).then((function(t){return e.gc=!1,t}))}));return this.dc=n},Tp.prototype.enqueueAfterDelay=function(t,e,n){var r=this;return this.Ic(),-1<this.Ec.indexOf(t)&&(e=0),n=af.createAndSchedule(this,t,e,n,(function(t){return r.bc(t)})),this.mc.push(n),n},Tp.prototype.Ic=function(){this.yc&&Yr()},Tp.prototype.verifyOperationInProgress=function(){},Tp.prototype.vc=function(){return u(this,void 0,void 0,(function(){var t;return c(this,(function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}}))}))},Tp.prototype.Pc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},Tp.prototype.Vc=function(t){var e=this;return this.vc().then((function(){e.mc.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.vc()}))},Tp.prototype.Sc=function(t){this.Ec.push(t)},Tp.prototype.bc=function(t){t=this.mc.indexOf(t),this.mc.splice(t,1)},Tp);function Tp(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=[],this.Zi=new kl(this,"async_queue_retry"),this.Tc=function(){var e=_l();e&&Hr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=_l();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Tc)}function Ip(t){return function(){if("object"==typeof t&&null!==t)for(var e=t,n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return 1}}()}var _p,Sp=(Np.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},Np.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},Np.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},Np.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},Np.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},Np.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)},Np),Ap=(s(Dp,_p=up),Dp.prototype._terminate=function(){return this._firestoreClient||kp(this),this._firestoreClient.terminate()},Dp);function Dp(t,e){var n=this;return(n=_p.call(this,t,e)||this).type="firestore",n._queue=new Ep,n._persistenceKey="name"in t?t.name:"[DEFAULT]",n}function Np(){this._progressObserver={},this._taskCompletionResolver=new du,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}function Cp(t){return t._firestoreClient||kp(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function kp(t){var e,n,r,i=t._freezeSettings();e=t._databaseId,n=(null===(r=t._app)||void 0===r?void 0:r.options.appId)||"",r=t._persistenceKey,i=new Vd(e,n,r,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams),t._firestoreClient=new bd(t._credentials,t._queue,i)}function Rp(t,e,n){var r=this,i=new du;return t.asyncQueue.enqueue((function(){return u(r,void 0,void 0,(function(){var r;return c(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,Ad(t,n)];case 1:return o.sent(),[4,Dd(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!("FirebaseError"===(r=o.sent()).name?r.code===qr.FAILED_PRECONDITION||r.code===qr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&r instanceof DOMException)||22===r.code||20===r.code||11===r.code))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}}))}))})).then((function(){return i.promise}))}function xp(t){if(t._initialized||t._terminated)throw new Br(qr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Op=(Gp.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},Gp),Lp=(Kp.fromBase64String=function(t){try{return new Kp(yi.fromBase64String(t))}catch(t){throw new Br(qr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}},Kp.fromUint8Array=function(t){return new Kp(yi.fromUint8Array(t))},Kp.prototype.toBase64=function(){return this._byteString.toBase64()},Kp.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},Kp.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},Kp.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},Kp),Pp=function(t){this._methodName=t},Mp=(Object.defineProperty(jp.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(jp.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),jp.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},jp.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},jp.prototype._compareTo=function(t){return Zr(this._lat,t._lat)||Zr(this._long,t._long)},jp),Fp=/^__.*__$/,Vp=(Bp.prototype.toMutation=function(t,e){return null!==this.fieldMask?new _s(t,this.data,this.fieldMask,e,this.fieldTransforms):new Is(t,this.data,e,this.fieldTransforms)},Bp),Up=(qp.prototype.toMutation=function(t,e){return new _s(t,this.data,this.fieldMask,e,this.fieldTransforms)},qp);function qp(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function Bp(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function jp(t,e){if(!isFinite(t)||t<-90||90<t)throw new Br(qr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Br(qr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}function Kp(t){this._byteString=t}function Gp(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Br(qr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new di(t)}function Hp(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Yr()}}var zp=(Object.defineProperty(Yp.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(Yp.prototype,"Cc",{get:function(){return this.settings.Cc},enumerable:!1,configurable:!0}),Yp.prototype.Nc=function(t){return new Yp(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},Yp.prototype.xc=function(t){var e=null===(e=this.path)||void 0===e?void 0:e.child(t);return(e=this.Nc({path:e,Fc:!1})).kc(t),e},Yp.prototype.$c=function(t){var e;return t=null===(e=this.path)||void 0===e?void 0:e.child(t),(t=this.Nc({path:t,Fc:!1})).Dc(),t},Yp.prototype.Oc=function(t){return this.Nc({path:void 0,Fc:!0})},Yp.prototype.Mc=function(t){return _y(t,this.settings.methodName,this.settings.Lc||!1,this.path,this.settings.Bc)},Yp.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},Yp.prototype.Dc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.kc(this.path.get(t))},Yp.prototype.kc=function(t){if(0===t.length)throw this.Mc("Document fields must not be empty");if(Hp(this.Cc)&&Fp.test(t))throw this.Mc('Document fields cannot begin and end with "__"')},Yp),Qp=(Wp.prototype.qc=function(t,e,n,r){return void 0===r&&(r=!1),new zp({Cc:t,methodName:e,Bc:n,path:di.emptyPath(),Fc:!1,Lc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},Wp);function Wp(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Sl(t)}function Yp(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Dc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}function Xp(t){var e=t._freezeSettings(),n=Sl(t._databaseId);return new Qp(t._databaseId,!!e.ignoreUndefinedProperties,n)}function $p(t,e,n,r,i,o){var s,a,u=t.qc((o=void 0===o?{}:o).merge||o.mergeFields?2:0,e,n,i);if(by("Data must be an object, but it was:",u,r),r=vy(r,u),o.merge)s=new pi(u.fieldMask),a=u.fieldTransforms;else if(o.mergeFields){for(var c=[],h=0,l=o.mergeFields;h<l.length;h++){var f=Ey(e,l[h],n);if(!u.contains(f))throw new Br(qr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");Sy(c,f)||c.push(f)}s=new pi(c),a=u.fieldTransforms.filter((function(t){return s.covers(t.field)}))}else s=null,a=u.fieldTransforms;return new Vp(new Hi(r),s,a)}var Jp,Zp=(s(ty,Jp=Pp),ty.prototype._toFieldTransform=function(t){if(2!==t.Cc)throw 1===t.Cc?t.Mc(this._methodName+"() can only appear at the top level of your update data"):t.Mc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},ty.prototype.isEqual=function(t){return t instanceof ty},ty);function ty(){return null!==Jp&&Jp.apply(this,arguments)||this}function ey(t,e,n){return new zp({Cc:3,Bc:e.settings.Bc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var ny,ry,iy,oy,sy=(s(dy,oy=Pp),dy.prototype._toFieldTransform=function(t){return new ps(t.path,new Zo)},dy.prototype.isEqual=function(t){return t instanceof dy},dy),ay=(s(fy,iy=Pp),fy.prototype._toFieldTransform=function(t){var e=ey(this,t,!0),n=this.Uc.map((function(t){return my(t,e)}));return n=new ts(n),new ps(t.path,n)},fy.prototype.isEqual=function(t){return this===t},fy),uy=(s(ly,ry=Pp),ly.prototype._toFieldTransform=function(t){var e=ey(this,t,!0),n=this.Uc.map((function(t){return my(t,e)}));return n=new os(n),new ps(t.path,n)},ly.prototype.isEqual=function(t){return this===t},ly),cy=(s(hy,ny=Pp),hy.prototype._toFieldTransform=function(t){var e=new cs(t.R,Yo(t.R,this.Qc));return new ps(t.path,e)},hy.prototype.isEqual=function(t){return this===t},hy);function hy(t,e){var n=this;return(n=ny.call(this,t)||this).Qc=e,n}function ly(t,e){var n=this;return(n=ry.call(this,t)||this).Uc=e,n}function fy(t,e){var n=this;return(n=iy.call(this,t)||this).Uc=e,n}function dy(){return null!==oy&&oy.apply(this,arguments)||this}function py(t,e,n,r){var i=t.qc(1,e,n);by("Data must be an object, but it was:",i,r);var o=[],s=Hi.empty();return ai(r,(function(t,r){var a=Iy(e,t,n);r=E(r),t=i.$c(a),r instanceof Zp?o.push(a):null!=(t=my(r,t))&&(o.push(a),s.set(a,t))})),r=new pi(o),new Up(s,r,i.fieldTransforms)}function yy(t,e,n,r,i,o){var s=t.qc(1,e,n),a=[Ey(e,r,n)],u=[i];if(o.length%2!=0)throw new Br(qr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(Ey(e,o[c])),u.push(o[c+1]);for(var h,l,f,d=[],p=Hi.empty(),y=a.length-1;0<=y;--y)Sy(d,a[y])||(h=a[y],l=E(l=u[y]),f=s.$c(h),l instanceof Zp?d.push(h):null!=(f=my(l,f))&&(d.push(h),p.set(h,f)));return i=new pi(d),new Up(p,i,s.fieldTransforms)}function gy(t,e,n,r){return my(n,t.qc((r=void 0!==r&&r)?4:3,e))}function my(t,e){if(wy(t=E(t)))return by("Unsupported field value:",e,t),vy(t,e);if(t instanceof Pp)return function(t,e){if(!Hp(e.Cc))throw e.Mc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Mc(t._methodName+"() is not currently supported inside arrays");(t=t._toFieldTransform(e))&&e.fieldTransforms.push(t)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.Cc)throw e.Mc("Nested arrays are not supported");return function(e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=my(o[i],e.Oc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(e)}return function(e,n){if(null===(e=E(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Yo(n.R,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var r=ni.fromDate(e);return{timestampValue:wa(n.R,r)}}if(e instanceof ni)return r=new ni(e.seconds,1e3*Math.floor(e.nanoseconds/1e3)),{timestampValue:wa(n.R,r)};if(e instanceof Mp)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Lp)return{bytesValue:ba(n.R,e._byteString)};if(e instanceof cp){r=n.databaseId;var i=e.firestore._databaseId;if(!i.isEqual(r))throw n.Mc("Document reference is for database "+i.projectId+"/"+i.database+" but should be for database "+r.projectId+"/"+r.database);return{referenceValue:Ta(e.firestore._databaseId||n.databaseId,e._key.path)}}throw n.Mc("Unsupported field value: "+rp(e))}(0,e)}function vy(t,e){var n={};return ui(t)?e.path&&0<e.path.length&&e.fieldMask.push(e.path):ai(t,(function(t,r){null!=(r=my(r,e.xc(t)))&&(n[t]=r)})),{mapValue:{fields:n}}}function wy(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ni||t instanceof Mp||t instanceof Lp||t instanceof cp||t instanceof Pp)}function by(t,e,n){if(!wy(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))throw"an object"===(n=rp(n))?e.Mc(t+" a custom object"):e.Mc(t+" "+n);var r}function Ey(t,e,n){if((e=E(e))instanceof Op)return e._internalPath;if("string"==typeof e)return Iy(t,e);throw _y("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Ty=new RegExp("[~\\*/\\[\\]]");function Iy(t,n,r){if(0<=n.search(Ty))throw _y("Invalid field path ("+n+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,r);try{return(new(Op.bind.apply(Op,h([void 0],n.split(".")))))._internalPath}catch(e){throw _y("Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,r)}}function _y(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i;return e="Function "+e+"() called with invalid data",n&&(e+=" (via `toFirestore()`)"),n="",(o||s)&&(n+=" (found",o&&(n+=" in field "+r),s&&(n+=" in document "+i),n+=")"),new Br(qr.INVALID_ARGUMENT,(e+=". ")+t+n)}function Sy(t,e){return t.some((function(t){return t.isEqual(e)}))}var Ay,Dy=(Object.defineProperty(ky.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(ky.prototype,"ref",{get:function(){return new cp(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),ky.prototype.exists=function(){return null!==this._document},ky.prototype.data=function(){if(this._document){if(this._converter){var t=new Ny(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},ky.prototype.get=function(t){if(this._document&&null!==(t=this._document.data.field(Ry("DocumentSnapshot.get",t))))return this._userDataWriter.convertValue(t)},ky),Ny=(s(Cy,Ay=Dy),Cy.prototype.data=function(){return Ay.prototype.data.call(this)},Cy);function Cy(){return null!==Ay&&Ay.apply(this,arguments)||this}function ky(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}function Ry(t,e){return"string"==typeof e?Iy(t,e):(e instanceof Op?e:e._delegate)._internalPath}var xy,Oy,Ly=(By.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},By),Py=(s(qy,Oy=Dy),qy.prototype.exists=function(){return Oy.prototype.exists.call(this)},qy.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new My(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},qy.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document&&null!==(t=this._document.data.field(Ry("DocumentSnapshot.get",t))))return this._userDataWriter.convertValue(t,e.serverTimestamps)},qy),My=(s(Uy,xy=Py),Uy.prototype.data=function(t){return xy.prototype.data.call(this,t=void 0===t?{}:t)},Uy),Fy=(Object.defineProperty(Vy.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(Vy.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(Vy.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),Vy.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach((function(r){t.call(e,new My(n._firestore,n._userDataWriter,r.key,r,new Ly(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))},Vy.prototype.docChanges=function(t){if((t=!!(t=void 0===t?{}:t).includeMetadataChanges)&&this._snapshot.excludesMetadataChanges)throw new Br(qr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map((function(e){var r=new My(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Ly(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);return e.doc,{type:"added",doc:r,oldIndex:-1,newIndex:n++}}))}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new My(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Ly(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Yr()}}(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges},Vy);function Vy(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Ly(r.hasPendingWrites,r.fromCache),this.query=n}function Uy(){return null!==xy&&xy.apply(this,arguments)||this}function qy(t,e,n,r,i,o){var s=this;return(s=Oy.call(this,t,e,n,r,o)||this)._firestore=t,s._firestoreImpl=t,s.metadata=i,s}function By(t,e){this.hasPendingWrites=t,this.fromCache=e}function jy(t,e){return t instanceof Py&&e instanceof Py?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Fy&&e instanceof Fy&&t._firestore===e._firestore&&bp(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Ky(t){if(Po(t)&&0===t.explicitOrderBy.length)throw new Br(qr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function Gy(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++)t=i[r]._apply(t);return t}var Hy,zy,Qy,Wy,Yy,Xy=(s(og,Yy=R=function(){}),og.prototype._apply=function(t){var e=Xp(t.firestore);return e=function(t,e,n,r,i,o){if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Br(qr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){ug(o,i);for(var s=[],a=0,u=o;a<u.length;a++){var c=u[a];s.push(ag(n,t,c))}h={arrayValue:{values:s}}}else h=ag(n,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||ug(o,i),h=gy(e,"where",o,"in"===i||"not-in"===i);var h=eo.create(r,i,h);return function(t,e){if(e.g()){var n=Fo(t);if(null!==n&&!n.isEqual(e.field))throw new Br(qr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");null!==(n=Mo(t))&&cg(0,e.field,n)}if(null!==(t=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}())))throw t===e.op?new Br(qr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Br(qr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+t.toString()+"' filters.")}(t,h),h}(t._query,e,t.firestore._databaseId,this.Kc,this.jc,this.Wc),new hp(t.firestore,t.converter,(e=(t=t._query).filters.concat([e]),new Ro(t.path,t.collectionGroup,t.explicitOrderBy.slice(),e,t.limit,t.limitType,t.startAt,t.endAt)))},og),$y=(s(ig,Wy=R),ig.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Br(qr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Br(qr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new No(e,n);return e=r,null!==Mo(n=t)||null!==(t=Fo(n))&&cg(0,t,e.field),r}(t._query,this.Kc,this.Gc);return new hp(t.firestore,t.converter,(e=(t=t._query).explicitOrderBy.concat([e]),new Ro(t.path,t.collectionGroup,e,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))},ig),Jy=(s(rg,Qy=R),rg.prototype._apply=function(t){return new hp(t.firestore,t.converter,Bo(t._query,this.zc,this.Hc))},rg),Zy=(s(ng,zy=R),ng.prototype._apply=function(t){var e=sg(t,this.type,this.Jc,this.Yc);return new hp(t.firestore,t.converter,(t=t._query,e=e,new Ro(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))},ng),tg=(s(eg,Hy=R),eg.prototype._apply=function(t){var e=sg(t,this.type,this.Jc,this.Yc);return new hp(t.firestore,t.converter,(t=t._query,e=e,new Ro(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))},eg);function eg(t,e,n){var r=this;return(r=Hy.call(this)||this).type=t,r.Jc=e,r.Yc=n,r}function ng(t,e,n){var r=this;return(r=zy.call(this)||this).type=t,r.Jc=e,r.Yc=n,r}function rg(t,e,n){var r=this;return(r=Qy.call(this)||this).type=t,r.zc=e,r.Hc=n,r}function ig(t,e){var n=this;return(n=Wy.call(this)||this).Kc=t,n.Gc=e,n.type="orderBy",n}function og(t,e,n){var r=this;return(r=Yy.call(this)||this).Kc=t,r.jc=e,r.Wc=n,r.type="where",r}function sg(t,e,n,r){if(n[0]=E(n[0]),n[0]instanceof Dy)return function(t,n,r,i){if(!r)throw new Br(qr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+e+"().");for(var o=[],s=0,a=Uo(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(Vi(n,r.key));else{var c=r.data.field(u.field);if(Si(c))throw new Br(qr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c)throw u=u.field.canonicalString(),new Br(qr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.");o.push(c)}}return new To(o,i)}(t._query,t.firestore._databaseId,n[0]._document,r);var i=Xp(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Br(qr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Br(qr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Vo(t)&&-1!==c.indexOf("/"))throw new Br(qr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(li.fromString(c));if(!ki.isDocumentKey(h))throw new Br(qr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");h=new ki(h),a.push(Vi(e,h))}else c=gy(n,r,c),a.push(c)}return new To(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function ag(t,e,n){if("string"==typeof(n=E(n))){if(""===n)throw new Br(qr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Vo(e)&&-1!==n.indexOf("/"))throw new Br(qr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");if(e=e.path.child(li.fromString(n)),!ki.isDocumentKey(e))throw new Br(qr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return Vi(t,new ki(e))}if(n instanceof cp)return Vi(t,n._key);throw new Br(qr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+rp(n)+".")}function ug(t,e){if(!Array.isArray(t)||0===t.length)throw new Br(qr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Br(qr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function cg(t,e,n){if(!n.isEqual(e))throw new Br(qr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function hg(){}function lg(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}hg.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),xi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ii(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(_i(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Yr()}},hg.prototype.convertObject=function(t,e){var n=this,r={};return ai(t.fields,(function(t,i){r[t]=n.convertValue(i,e)})),r},hg.prototype.convertGeoPoint=function(t){return new Mp(Ii(t.latitude),Ii(t.longitude))},hg.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.convertValue(t,e)}))},hg.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=function t(e){return Si(e=e.mapValue.fields.__previous_value__)?t(e):e}(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Ai(t));default:return null}},hg.prototype.convertTimestamp=function(t){return t=Ti(t),new ni(t.seconds,t.nanos)},hg.prototype.convertDocumentKey=function(t,e){var n=li.fromString(t);return Xr(Ka(n)),t=new Ud(n.get(1),n.get(3)),n=new ki(n.popFirst(5)),t.isEqual(e)||zr("Document "+n+" contains a document reference within a different database ("+t.projectId+"/"+t.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),n};var fg,dg=(s(gg,fg=A=hg),gg.prototype.convertBytes=function(t){return new Lp(t)},gg.prototype.convertReference=function(t){return t=this.convertDocumentKey(t,this.firestore._databaseId),new cp(this.firestore,null,t)},gg),pg=(yg.prototype.set=function(t,e,n){return this._verifyNotCommitted(),e=lg((t=mg(t,this._firestore)).converter,e,n),n=$p(this._dataReader,"WriteBatch.set",t._key,e,null!==t.converter,n),this._mutations.push(n.toMutation(t._key,ys.none())),this},yg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return this._verifyNotCommitted(),t=mg(t,this._firestore),e="string"==typeof(e=E(e))||e instanceof Op?yy(this._dataReader,"WriteBatch.update",t._key,e,n,r):py(this._dataReader,"WriteBatch.update",t._key,e),this._mutations.push(e.toMutation(t._key,ys.exists(!0))),this},yg.prototype.delete=function(t){return this._verifyNotCommitted(),t=mg(t,this._firestore),this._mutations=this._mutations.concat(new Ls(t._key,ys.none())),this},yg.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()},yg.prototype._verifyNotCommitted=function(){if(this._committed)throw new Br(qr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},yg);function yg(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Xp(t)}function gg(t){var e=this;return(e=fg.call(this)||this).firestore=t,e}function mg(t,e){if((t=E(t)).firestore!==e)throw new Br(qr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var vg,wg=(s(bg,vg=A),bg.prototype.convertBytes=function(t){return new Lp(t)},bg.prototype.convertReference=function(t){return t=this.convertDocumentKey(t,this.firestore._databaseId),new cp(this.firestore,null,t)},bg);function bg(t){var e=this;return(e=vg.call(this)||this).firestore=t,e}function Eg(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=ip(t,cp);var o=ip(t.firestore,Ap),s=Xp(o);return Ig(o,[("string"==typeof(e=E(e))||e instanceof Op?yy(s,"updateDoc",t._key,e,n,r):py(s,"updateDoc",t._key,e)).toMutation(t._key,ys.exists(!0))])}function Tg(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t=E(t);var r={includeMetadataChanges:!1},i=0;"object"!=typeof e[i]||Ip(e[i])||(r=e[i],i++);var o,s,a,h,l,f,d={includeMetadataChanges:r.includeMetadataChanges};return Ip(e[i])&&(o=e[i],e[i]=null===(r=o.next)||void 0===r?void 0:r.bind(o),e[i+1]=null===(r=o.error)||void 0===r?void 0:r.bind(o),e[i+2]=null===(r=o.complete)||void 0===r?void 0:r.bind(o)),t instanceof cp?(a=ip(t.firestore,Ap),h=Oo(t._key.path),f={next:function(n){e[i]&&e[i](_g(a,t,n))},error:e[i+1],complete:e[i+2]}):(s=ip(t,hp),a=ip(s.firestore,Ap),h=s._query,l=new wg(a),f={next:function(t){e[i]&&e[i](new Fy(a,l,s,t))},error:e[i+1],complete:e[i+2]},Ky(t._query)),function(t,e,n){var r=this,i=new gd(f),o=new Ef(e,i,n);return t.asyncQueue.enqueueAndForget((function(){return u(r,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:return e=vf,[4,Ld(t)];case 1:return[2,e.apply(void 0,[n.sent(),o])]}}))}))})),function(){i.Wo(),t.asyncQueue.enqueueAndForget((function(){return u(r,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:return e=wf,[4,Ld(t)];case 1:return[2,e.apply(void 0,[n.sent(),o])]}}))}))}))}}(Cp(a),h,d)}function Ig(t,e){return function(t,e){var n=this,r=new du;return t.asyncQueue.enqueueAndForget((function(){return u(n,void 0,void 0,(function(){var n;return c(this,(function(i){switch(i.label){case 0:return n=Uf,[4,Od(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(Cp(t),e)}function _g(t,e,n){var r=n.docs.get(e._key),i=new wg(t);return new Py(t,i,e._key,r,new Ly(n.hasPendingWrites,n.fromCache),e.converter)}var Sg,Ag=(Ng.prototype.get=function(t){var e=this,n=mg(t,this._firestore),r=new dg(this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return Yr();if((t=t[0]).isFoundDocument())return new Dy(e._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new Dy(e._firestore,r,n._key,null,n.converter);throw Yr()}))},Ng.prototype.set=function(t,e,n){return e=lg((t=mg(t,this._firestore)).converter,e,n),n=$p(this._dataReader,"Transaction.set",t._key,e,null!==t.converter,n),this._transaction.set(t._key,n),this},Ng.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return t=mg(t,this._firestore),e="string"==typeof(e=E(e))||e instanceof Op?yy(this._dataReader,"Transaction.update",t._key,e,n,r):py(this._dataReader,"Transaction.update",t._key,e),this._transaction.update(t._key,e),this},Ng.prototype.delete=function(t){return t=mg(t,this._firestore),this._transaction.delete(t._key),this},s(Dg,Sg=Ng),Dg.prototype.get=function(t){var e=this,n=mg(t,this._firestore),r=new wg(this._firestore);return Sg.prototype.get.call(this,t).then((function(t){return new Py(e._firestore,r,n._key,t._document,new Ly(!1,!1),n.converter)}))},Dg);function Dg(t,e){var n=this;return(n=Sg.call(this,t,e)||this)._firestore=t,n}function Ng(t,e){this._firestore=t,this._transaction=e,this._dataReader=Xp(t)}function Cg(){if("undefined"==typeof Uint8Array)throw new Br(qr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function kg(){if("undefined"==typeof atob)throw new Br(qr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Rg,xg=(Ug.fromBase64String=function(t){return kg(),new Ug(Lp.fromBase64String(t))},Ug.fromUint8Array=function(t){return Cg(),new Ug(Lp.fromUint8Array(t))},Ug.prototype.toBase64=function(){return kg(),this._delegate.toBase64()},Ug.prototype.toUint8Array=function(){return Cg(),this._delegate.toUint8Array()},Ug.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},Ug.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Ug),Og=(Vg.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){xp(t=ip(t,Ap));var n=Cp(t),r=t._freezeSettings();return Rp(n,t=new hd,new ud(t,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},Vg.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){xp(t=ip(t,Ap));var e=Cp(t),n=t._freezeSettings();return Rp(e,t=new hd,new cd(t,n.cacheSizeBytes))}(t._delegate)},Vg.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new Br(qr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new du;return t._queue.enqueueAndForgetEvenWhileRestricted((function(){return u(e,void 0,void 0,(function(){var e;return c(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return u(this,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:return gu.yt()?(e=t+"main",[4,gu.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(rh(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t._delegate)},Vg),Lg=(Object.defineProperty(Fg.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),Fg.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||Qr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},Fg.prototype.useEmulator=function(t,e,n){!function(t,e,n,r){void 0===r&&(r={});var i=(t=ip(t,up))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Qr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:e+":"+n,ssl:!1})),r.mockUserToken){if(n=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=e||"demo-project",r=t.iat||0;if(!(e=t.sub||t.user_id))throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");return t=a({iss:"https://securetoken.google.com/"+n,aud:n,iat:r,exp:r+3600,auth_time:r,sub:e,user_id:e,firebase:{sign_in_provider:"custom",identities:{}}},t),[l.encodeString(JSON.stringify({alg:"none",type:"JWT"}),!1),l.encodeString(JSON.stringify(t),!1),""].join(".")}(r.mockUserToken),!(r=r.mockUserToken.sub||r.mockUserToken.user_id))throw new Br(qr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new jd(new Fd(n,new Fh(r)))}}(this._delegate,t,e,n=void 0===n?{}:n)},Fg.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return u(e,void 0,void 0,(function(){var e,n;return c(this,(function(r){switch(r.label){case 0:return[4,kd(t)];case 1:return e=r.sent(),[4,xd(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),(i=n).Or.delete(0),Bl(i))]}var i}))}))}))}(Cp(ip(this._delegate,Ap)))},Fg.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return u(e,void 0,void 0,(function(){var e,n;return c(this,(function(r){switch(r.label){case 0:return[4,kd(t)];case 1:return e=r.sent(),[4,xd(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return u(this,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:return(e=t).Or.add(0),[4,jl(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(Cp(ip(this._delegate,Ap)))},Fg.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&tp("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Xc.enableMultiTabIndexedDbPersistence(this):this.Xc.enableIndexedDbPersistence(this,n)},Fg.prototype.clearPersistence=function(){return this.Xc.clearIndexedDbPersistence(this)},Fg.prototype.terminate=function(){return this.Zc&&(this.Zc._removeServiceInstance("firestore"),this.Zc._removeServiceInstance("firestore-exp")),this._delegate._delete()},Fg.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new du;return t.asyncQueue.enqueueAndForget((function(){return u(e,void 0,void 0,(function(){var e;return c(this,(function(r){switch(r.label){case 0:return e=Kf,[4,Od(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(Cp(ip(this._delegate,Ap)))},Fg.prototype.onSnapshotsInSync=function(t){return t=t,function(t,e){var n=this,r=new gd(e);return t.asyncQueue.enqueueAndForget((function(){return u(n,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:return e=function(t,e){t.Gr.add(e),e.next()},[4,Ld(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))})),function(){r.Wo(),t.asyncQueue.enqueueAndForget((function(){return u(n,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:return e=function(t,e){t.Gr.delete(e)},[4,Ld(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))}))}}(Cp(ip(this._delegate,Ap)),Ip(t)?t:{next:t})},Object.defineProperty(Fg.prototype,"app",{get:function(){if(!this.Zc)throw new Br(qr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Zc},enumerable:!1,configurable:!0}),Fg.prototype.collection=function(t){try{return new im(this,mp(this._delegate,t))}catch(t){throw Wg(t,"collection()","Firestore.collection()")}},Fg.prototype.doc=function(t){try{return new zg(this,vp(this._delegate,t))}catch(t){throw Wg(t,"doc()","Firestore.doc()")}},Fg.prototype.collectionGroup=function(t){try{return new em(this,function(t,e){if(t=ip(t,up),Jd("collectionGroup","collection id",e),0<=e.indexOf("/"))throw new Br(qr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new hp(t,null,(e=e,new Ro(li.emptyPath(),e)))}(this._delegate,t))}catch(t){throw Wg(t,"collectionGroup()","Firestore.collectionGroup()")}},Fg.prototype.runTransaction=function(t){var e,n=this;return function(t,e){var n=this,r=new du;return t.asyncQueue.enqueueAndForget((function(){return u(n,void 0,void 0,(function(){var n;return c(this,(function(i){switch(i.label){case 0:return[4,Cd(t).then((function(t){return t.datastore}))];case 1:return n=i.sent(),new wd(t.asyncQueue,n,e,r).run(),[2]}}))}))})),r.promise}(Cp(e=this._delegate),(function(r){return r=new Ag(e,r),t(new qg(n,r))}))},Fg.prototype.batch=function(){var t=this;return Cp(this._delegate),new Bg(new pg(this._delegate,(function(e){return Ig(t._delegate,e)})))},Fg.prototype.loadBundle=function(t){throw new Br(qr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},Fg.prototype.namedQuery=function(t){throw new Br(qr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},Fg),Pg=(s(Mg,Rg=A),Mg.prototype.convertBytes=function(t){return new xg(new Lp(t))},Mg.prototype.convertReference=function(t){return t=this.convertDocumentKey(t,this.firestore._databaseId),zg.tu(t,this.firestore,null)},Mg);function Mg(t){var e=this;return(e=Rg.call(this)||this).firestore=t,e}function Fg(t,e,n){var r=this;this._delegate=e,this.Xc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof Ud||(this.Zc=t)}function Vg(){}function Ug(t){this._delegate=t}var qg=(Hg.prototype.get=function(t){var e=this,n=lm(t);return this._delegate.get(n).then((function(t){return new Zg(e._firestore,new Py(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))}))},Hg.prototype.set=function(t,e,n){return t=lm(t),n?(Zd("Transaction.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},Hg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=lm(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,h([o,e,n],r)),this},Hg.prototype.delete=function(t){return t=lm(t),this._delegate.delete(t),this},Hg),Bg=(Gg.prototype.set=function(t,e,n){return t=lm(t),n?(Zd("WriteBatch.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},Gg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=lm(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,h([o,e,n],r)),this},Gg.prototype.delete=function(t){return t=lm(t),this._delegate.delete(t),this},Gg.prototype.commit=function(){return this._delegate.commit()},Gg),jg=(Kg.prototype.fromFirestore=function(t,e){return t=new My(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null),this._delegate.fromFirestore(new tm(this._firestore,t),null!=e?e:{})},Kg.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},Kg.eu=function(t,e){var n=Kg.nu,r=n.get(t);return r||(r=new WeakMap,n.set(t,r)),(n=r.get(e))||(n=new Kg(t,new Pg(t),e),r.set(e,n)),n},Kg);function Kg(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}function Gg(t){this._delegate=t}function Hg(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Pg(t)}jg.nu=new WeakMap;var zg=(Qg.su=function(t,e,n){if(t.length%2!=0)throw new Br(qr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new Qg(e,new cp(e._delegate,n,new ki(t)))},Qg.tu=function(t,e,n){return new Qg(e,new cp(e._delegate,n,t))},Object.defineProperty(Qg.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(Qg.prototype,"parent",{get:function(){return new im(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(Qg.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Qg.prototype.collection=function(t){try{return new im(this.firestore,mp(this._delegate,t))}catch(t){throw Wg(t,"collection()","DocumentReference.collection()")}},Qg.prototype.isEqual=function(t){return(t=E(t))instanceof cp&&wp(this._delegate,t)},Qg.prototype.set=function(t,e){e=Zd("DocumentReference.set",e);try{return function(t,e,n){t=ip(t,cp);var r=ip(t.firestore,Ap);return e=lg(t.converter,e,n),Ig(r,[$p(Xp(r),"setDoc",t._key,e,null!==t.converter,n).toMutation(t._key,ys.none())])}(this._delegate,t,e)}catch(t){throw Wg(t,"setDoc()","DocumentReference.set()")}},Qg.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Eg(this._delegate,t):Eg.apply(void 0,h([this._delegate,t,e],n))}catch(t){throw Wg(t,"updateDoc()","DocumentReference.update()")}},Qg.prototype.delete=function(){return Ig(ip((t=this._delegate).firestore,Ap),[new Ls(t._key,ys.none())]);var t},Qg.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Yg(e),i=Xg(e,(function(e){return new Zg(t.firestore,new Py(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))}));return Tg(this._delegate,r,i)},Qg.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=ip(t,cp);var e=ip(t.firestore,Ap),n=Cp(e),r=new wg(e);return function(t,e){var n=this,r=new du;return t.asyncQueue.enqueueAndForget((function(){return u(n,void 0,void 0,(function(){var n;return c(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return u(this,void 0,void 0,(function(){var r,i;return c(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,(s=e,(a=t).persistence.runTransaction("read document","readonly",(function(t){return a.Mn.mn(t,s)})))];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new Br(qr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=cf(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}var s,a}))}))},[4,Rd(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._key).then((function(n){return new Py(e,r,t._key,n,new Ly(null!==n&&n.hasLocalMutations,!0),t.converter)}))}:"server"===(null==t?void 0:t.source)?function(t){t=ip(t,cp);var e=ip(t.firestore,Ap);return Pd(Cp(e),t._key,{source:"server"}).then((function(n){return _g(e,t,n)}))}:function(t){t=ip(t,cp);var e=ip(t.firestore,Ap);return Pd(Cp(e),t._key).then((function(n){return _g(e,t,n)}))})(this._delegate).then((function(t){return new Zg(e.firestore,new Py(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))}))},Qg.prototype.withConverter=function(t){return new Qg(this.firestore,t?this._delegate.withConverter(jg.eu(this.firestore,t)):this._delegate.withConverter(null))},Qg);function Qg(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Pg(t)}function Wg(t,e,n){return t.message=t.message.replace(e,n),t}function Yg(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!Ip(r))return r}return{}}function Xg(t,e){var n;return{next:function(t){n.next&&n.next(e(t))},error:null===(t=(n=Ip(t[0])?t[0]:Ip(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===t?void 0:t.bind(n),complete:null===(t=n.complete)||void 0===t?void 0:t.bind(n)}}var $g,Jg,Zg=(Object.defineProperty(hm.prototype,"ref",{get:function(){return new zg(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(hm.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(hm.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(hm.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),hm.prototype.data=function(t){return this._delegate.data(t)},hm.prototype.get=function(t,e){return this._delegate.get(t,e)},hm.prototype.isEqual=function(t){return jy(this._delegate,t._delegate)},hm),tm=(s(cm,Jg=Zg),cm.prototype.data=function(t){return this._delegate.data(t)},cm),em=(um.prototype.where=function(t,e,n){try{return new um(this.firestore,Gy(this._delegate,(r=n,i=e,o=Ry("where",t),new Xy(o,i,r))))}catch(t){throw Wg(t,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,o},um.prototype.orderBy=function(t,e){try{return new um(this.firestore,Gy(this._delegate,(n=void 0===e?"asc":e,r=Ry("orderBy",t),new $y(r,n))))}catch(t){throw Wg(t,/(orderBy|where)\(\)/,"Query.$1()")}var n,r},um.prototype.limit=function(t){try{return new um(this.firestore,Gy(this._delegate,(op("limit",e=t),new Jy("limit",e,"F"))))}catch(t){throw Wg(t,"limit()","Query.limit()")}var e},um.prototype.limitToLast=function(t){try{return new um(this.firestore,Gy(this._delegate,(op("limitToLast",e=t),new Jy("limitToLast",e,"L"))))}catch(t){throw Wg(t,"limitToLast()","Query.limitToLast()")}var e},um.prototype.startAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new um(this.firestore,Gy(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Zy("startAt",t,!0)}.apply(void 0,t)))}catch(t){throw Wg(t,"startAt()","Query.startAt()")}},um.prototype.startAfter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new um(this.firestore,Gy(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Zy("startAfter",t,!1)}.apply(void 0,t)))}catch(t){throw Wg(t,"startAfter()","Query.startAfter()")}},um.prototype.endBefore=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new um(this.firestore,Gy(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new tg("endBefore",t,!0)}.apply(void 0,t)))}catch(t){throw Wg(t,"endBefore()","Query.endBefore()")}},um.prototype.endAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new um(this.firestore,Gy(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new tg("endAt",t,!1)}.apply(void 0,t)))}catch(t){throw Wg(t,"endAt()","Query.endAt()")}},um.prototype.isEqual=function(t){return bp(this._delegate,t._delegate)},um.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=ip(t,hp);var e=ip(t.firestore,Ap),n=Cp(e),r=new wg(e);return function(t,e){var n=this,r=new du;return t.asyncQueue.enqueueAndForget((function(){return u(n,void 0,void 0,(function(){var n;return c(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return u(this,void 0,void 0,(function(){var r,i,o;return c(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,Eh(t,e,!0)];case 1:return o=s.sent(),r=new xf(e,o.Bn),i=r._o(o.documents),i=r.applyChanges(i,!1),n.resolve(i.snapshot),[3,3];case 2:return i=s.sent(),o=cf(i,"Failed to execute query '"+e+" against cache"),n.reject(o),[3,3];case 3:return[2]}}))}))},[4,Rd(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._query).then((function(n){return new Fy(e,r,t,n)}))}:"server"===(null==t?void 0:t.source)?function(t){t=ip(t,hp);var e=ip(t.firestore,Ap),n=Cp(e),r=new wg(e);return Md(n,t._query,{source:"server"}).then((function(n){return new Fy(e,r,t,n)}))}:function(t){t=ip(t,hp);var e=ip(t.firestore,Ap),n=Cp(e),r=new wg(e);return Ky(t._query),Md(n,t._query).then((function(n){return new Fy(e,r,t,n)}))})(this._delegate).then((function(t){return new rm(e.firestore,new Fy(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}))},um.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Yg(e),i=Xg(e,(function(e){return new rm(t.firestore,new Fy(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}));return Tg(this._delegate,r,i)},um.prototype.withConverter=function(t){return new um(this.firestore,t?this._delegate.withConverter(jg.eu(this.firestore,t)):this._delegate.withConverter(null))},um),nm=(Object.defineProperty(am.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(am.prototype,"doc",{get:function(){return new tm(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(am.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(am.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),am),rm=(Object.defineProperty(sm.prototype,"query",{get:function(){return new em(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(sm.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(sm.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(sm.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(sm.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(e){return new tm(t._firestore,e)}))},enumerable:!1,configurable:!0}),sm.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map((function(t){return new nm(e._firestore,t)}))},sm.prototype.forEach=function(t,e){var n=this;this._delegate.forEach((function(r){t.call(e,new tm(n._firestore,r))}))},sm.prototype.isEqual=function(t){return jy(this._delegate,t._delegate)},sm),im=(s(om,$g=em),Object.defineProperty(om.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(om.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(om.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new zg(this.firestore,t):null},enumerable:!1,configurable:!0}),om.prototype.doc=function(t){try{return new zg(this.firestore,void 0===t?vp(this._delegate):vp(this._delegate,t))}catch(t){throw Wg(t,"doc()","CollectionReference.doc()")}},om.prototype.add=function(t){var e,n,r,i=this;return n=t,t=ip((e=this._delegate).firestore,Ap),r=vp(e),n=lg(e.converter,n),Ig(t,[$p(Xp(e.firestore),"addDoc",r._key,n,null!==e.converter,{}).toMutation(r._key,ys.exists(!1))]).then((function(){return r})).then((function(t){return new zg(i.firestore,t)}))},om.prototype.isEqual=function(t){return wp(this._delegate,t._delegate)},om.prototype.withConverter=function(t){return new om(this.firestore,t?this._delegate.withConverter(jg.eu(this.firestore,t)):this._delegate.withConverter(null))},om);function om(t,e){var n=this;return(n=$g.call(this,t,e)||this).firestore=t,n._delegate=e,n}function sm(t,e){this._firestore=t,this._delegate=e}function am(t,e){this._firestore=t,this._delegate=e}function um(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Pg(t)}function cm(){return null!==Jg&&Jg.apply(this,arguments)||this}function hm(t,e){this._firestore=t,this._delegate=e}function lm(t){return ip(t,cp)}function fm(t){this._delegate=t}function dm(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(Op.bind.apply(Op,h([void 0],t)))}function pm(t){return e=this._delegate,n=t,r=Cp(e=ip(e,Ap)),t=new Sp,function(t,e,r){var i,o=this,s=(i=n,e=Sl(e),i=function(t){if(t instanceof Uint8Array)return yd(t,void 0);if(t instanceof ArrayBuffer)return yd(new Uint8Array(t),void 0);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof i?(new TextEncoder).encode(i):i),new md(i,e));t.asyncQueue.enqueueAndForget((function(){return u(o,void 0,void 0,(function(){var e;return c(this,(function(n){switch(n.label){case 0:return e=id,[4,Od(t)];case 1:return e.apply(void 0,[n.sent(),s,r]),[2]}}))}))}))}(r,e._databaseId,t),t;var e,n,r}function ym(t){var e=this,n=this._delegate;return t=t,function(t,e){var n=this;return t.asyncQueue.enqueue((function(){return u(n,void 0,void 0,(function(){var n;return c(this,(function(r){switch(r.label){case 0:return n=function(t,e){var n=t;return n.persistence.runTransaction("Get named query","readonly",(function(t){return n.Qe.getNamedQuery(t,e)}))},[4,Rd(t)];case 1:return[2,n.apply(void 0,[r.sent(),e])]}}))}))}))}(Cp(n=ip(n,Ap)),t).then((function(t){return t?new hp(n,null,t.query):null})).then((function(t){return t?new em(e,t):null}))}dm.documentId=function(){return new dm(di.keyField().canonicalString())},dm.prototype.isEqual=function(t){return(t=E(t))instanceof Op&&this._delegate._internalPath.isEqual(t._internalPath)},R=dm,fm.serverTimestamp=function(){var t=new sy("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new fm(t)},fm.delete=function(){var t=new Zp("deleteField");return t._methodName="FieldValue.delete",new fm(t)},fm.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ay("arrayUnion",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayUnion",new fm(n)},fm.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new uy("arrayRemove",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayRemove",new fm(n)},fm.increment=function(t){return(t=new cy("increment",t))._methodName="FieldValue.increment",new fm(t)},fm.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},A=fm;var gm=(mm.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},mm.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},mm.prototype.setServiceProps=function(t){return this.serviceProps=t,this},mm.prototype.setInstanceCreatedCallback=function(t){return this.onInstanceCreated=t,this},mm);function mm(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}var vm,wm,bm={Firestore:Lg,GeoPoint:Mp,Timestamp:ni,Blob:xg,Transaction:qg,WriteBatch:Bg,DocumentReference:zg,DocumentSnapshot:Zg,Query:em,QueryDocumentSnapshot:tm,QuerySnapshot:rm,CollectionReference:im,FieldPath:R,FieldValue:A,setLogLevel:function(t){jr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(vm=i.default).INTERNAL.registerComponent(new gm("firestore",(function(t){var e=t.getProvider("app").getImmediate();return e=e,t=t.getProvider("auth-internal"),new Lg(e,new Ap(e,t),new Og)}),"PUBLIC").setServiceProps(Object.assign({},bm))),vm.registerVersion("@firebase/firestore","2.3.7"),(wm=Lg).prototype.loadBundle=pm,wm.prototype.namedQuery=ym}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}}(n(6099))}}]);